<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora OS • MysticSoft</title>
    <style>
        :root {
            --vinho: #3e0a29;
            --verde: #b2d1b1;
            --azul: #0b1836;
            --dourado: #f0aa53;
            --pergaminho: #f2eaff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--azul);
            color: var(--pergaminho);
            height: 100vh;
            overflow: hidden;
        }

        /* === TELA DE BOOT === */
        .boot-screen {
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%),
                linear-gradient(135deg, var(--azul) 0%, #1a2a4a 50%, #2a1a4a 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            cursor: pointer;
            overflow: hidden;
            animation: bootGlow 4s ease-in-out infinite alternate, tvStatic 0.1s infinite;
        }

        @keyframes bootGlow {
            0% { filter: brightness(1) saturate(1); }
            100% { filter: brightness(1.1) saturate(1.2); }
        }

        @keyframes tvStatic {
            0% { filter: brightness(1) contrast(1); }
            25% { filter: brightness(1.02) contrast(1.01); }
            50% { filter: brightness(0.98) contrast(0.99); }
            75% { filter: brightness(1.01) contrast(1.02); }
            100% { filter: brightness(1) contrast(1); }
        }

        .boot-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 70%, rgba(255, 215, 0, 0.1) 0%, transparent 30%),
                radial-gradient(circle at 70% 30%, rgba(138, 43, 226, 0.1) 0%, transparent 30%);
            animation: mysticalAura 6s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes mysticalAura {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.05); }
        }

        .boot-screen::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, rgba(255, 215, 0, 0.4), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255, 255, 255, 0.3), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(138, 43, 226, 0.4), transparent),
                radial-gradient(1px 1px at 130px 80px, rgba(255, 215, 0, 0.3), transparent),
                radial-gradient(2px 2px at 160px 30px, rgba(255, 255, 255, 0.2), transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: sparkle 8s linear infinite, tvScanlines 0.05s infinite;
            pointer-events: none;
        }

        @keyframes sparkle {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-100px); }
        }

        @keyframes tvScanlines {
            0% { opacity: 0.8; }
            50% { opacity: 0.9; }
            100% { opacity: 0.8; }
        }

        .boot-logo {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .boot-title {
            font-size: 48px;
            color: var(--dourado);
            margin-bottom: 5px;
            text-shadow: 
                2px 2px 4px rgba(0, 0, 0, 0.8),
                0 0 10px var(--dourado);
            font-weight: bold;
            letter-spacing: 3px;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .boot-version {
            font-size: 24px;
            color: #c0c0c0;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            font-weight: normal;
            letter-spacing: 1px;
            font-family: 'MS Sans Serif', sans-serif;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .boot-subtitle {
            font-size: 18px;
            color: #c0c0c0;
            margin-bottom: 40px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            font-family: 'MS Sans Serif', sans-serif;
        }

        .boot-progress-container {
            margin-bottom: 30px;
        }

        .boot-progress {
            width: 400px;
            height: 20px;
            background: #000080;
            border: 2px inset #c0c0c0;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

        .boot-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0000ff 0%, #4040ff 50%, #8080ff 100%);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }

        .boot-status {
            font-size: 14px;
            color: #c0c0c0;
            text-align: left;
            margin: 0;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .boot-hint {
            font-size: 14px;
            color: #c0c0c0;
            margin-bottom: 20px;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .boot-copyright {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .boot-copyright p {
            font-size: 12px;
            color: #808080;
            margin: 2px 0;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .boot-orbs {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        .boot-orb {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.8) 0%, transparent 70%);
            border-radius: 50%;
            animation: orbFloat 8s linear infinite;
        }

        @keyframes orbFloat {
            0% { transform: translateY(100vh) translateX(0px); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-10vh) translateX(50px); opacity: 0; }
        }

        /* === DESKTOP === */
        .desktop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
            z-index: 1;
        }

        .desktop.active {
            display: block;
        }

        /* === ÍCONES DO DESKTOP === */
        .desktop-icons {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 2;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background 0.2s;
            width: 70px;
            height: 70px;
            background: transparent;
        }

        .desktop-icon:hover {
            background: rgba(0, 0, 255, 0.2);
        }

        .icon-image {
            width: 32px;
            height: 32px;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            image-rendering: pixelated;
        }

        .icon-image img {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
        }

        .icon-label {
            color: white;
            font-size: 10px;
            text-align: center;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.8);
            font-weight: normal;
            line-height: 1.1;
            max-width: 65px;
            word-wrap: break-word;
        }

        /* === MENU DE CONTEXTO DO DESKTOP === */
        .desktop-context-menu {
            display: none;
            position: absolute;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            z-index: 1000;
            min-width: 180px;
        }

        .context-menu-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 11px;
            border-bottom: 1px solid #808080;
        }

        .context-menu-item:hover {
            background: #0078d4;
            color: white;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }        /* === RITUAIS DIGITAIS AFÁST! === */
        .ritual-window {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 300px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #ffd700;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            z-index: 10000;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .ritual-header {
            background: linear-gradient(90deg, #4a4a8a, #6a6aaa);
            color: white;
            padding: 8px 12px;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        .ritual-header button {
            background: #ff4444;
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .ritual-content {
            padding: 20px;
            text-align: center;
            color: #ffd700;
        }

        .ritual-circle {
            width: 80px;
            height: 80px;
            border: 3px solid #ffd700;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: ritualGlow 2s infinite alternate;
        }

        .ritual-symbol {
            font-size: 30px;
            color: #ffd700;
            animation: ritualSpin 4s linear infinite;
        }

        @keyframes ritualGlow {
            from { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            to { box-shadow: 0 0 20px rgba(255, 215, 0, 1); }
        }

        @keyframes ritualSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .ritual-steps {
            margin: 20px 0;
        }

        .ritual-step {
            padding: 5px;
            margin: 5px 0;
            opacity: 0.5;
            transition: all 0.5s ease;
        }

        .ritual-step.active {
            opacity: 1;
            color: #ffffff;
            text-shadow: 0 0 10px #ffd700;
        }

        .ritual-progress {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 20px;
        }

        .ritual-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            width: 0%;
            animation: ritualProgress 5s linear forwards;
        }

        /* === ALTAR DIGITAL - MENU INICIAR MÍSTICO === */
        .mystic-start-menu {
            position: fixed;
            bottom: 50px;
            left: 10px;
            width: 350px;
            height: 500px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 2px solid #ffd700;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            z-index: 9999;
            font-family: 'MS Sans Serif', sans-serif;
            overflow: hidden;
        }

        .mystic-menu-header {
            background: linear-gradient(90deg, #4a4a8a, #6a6aaa);
            color: #ffd700;
            padding: 10px;
            text-align: center;
            font-style: italic;
            border-bottom: 1px solid #ffd700;
        }

        .oracle-phrase {
            font-size: 11px;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .mystic-menu-content {
            padding: 15px;
            height: calc(100% - 60px);
            overflow-y: auto;
            color: #ffffff;
        }

        .panel-title {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 8px;
            font-size: 12px;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
        }

        .afast-alerts-panel {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff4444;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .alert-item {
            font-size: 10px;
            margin: 3px 0;
            color: #ffcccc;
        }

        .defense-button {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            margin-top: 5px;
            width: 100%;
        }

        .defense-button:hover {
            background: linear-gradient(135deg, #ff6666, #ff0000);
        }

        .pentacle {
            animation: pentacleGlow 2s infinite alternate;
        }

        @keyframes pentacleGlow {
            from { text-shadow: 0 0 5px #ffd700; }
            to { text-shadow: 0 0 15px #ffd700, 0 0 25px #ffd700; }
        }

        .spell-box {
            background: rgba(0, 100, 0, 0.1);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }

        #spell-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 5px;
            border-radius: 3px;
            font-size: 10px;
            font-family: 'Courier New', monospace;
        }

        .spell-hints {
            font-size: 8px;
            color: #88ff88;
            margin-top: 5px;
            text-align: center;
        }

        .astro-agenda {
            background: rgba(0, 0, 100, 0.1);
            border: 1px solid #4444ff;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .agenda-item {
            font-size: 10px;
            margin: 3px 0;
            color: #ccccff;
        }

        .mystic-shortcuts {
            background: rgba(100, 0, 100, 0.1);
            border: 1px solid #ff44ff;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .shortcuts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }

        .mystic-shortcut {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 5px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mystic-shortcut:hover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
            transform: scale(1.05);
        }

        .shortcut-icon {
            font-size: 16px;
            margin-bottom: 3px;
        }

        .shortcut-label {
            font-size: 9px;
            color: #ffffff;
        }

        .quick-map {
            text-align: center;
        }

        .map-button {
            background: linear-gradient(135deg, #4a4a8a, #6a6aaa);
            color: #ffd700;
            border: 1px solid #ffd700;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 10px;
            width: 100%;
        }

        .map-button:hover {
            background: linear-gradient(135deg, #6a6aaa, #8a8acc);
        }

        .cosmic-radar {
            font-size: 14px;
            animation: cosmicSpin 4s linear infinite;
        }

        @keyframes cosmicSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* === JANELAS MÍSTICAS === */
        .ms-window {
            position: fixed;
            top: 12vh;
            left: 10vw;
            width: 70vw;
            height: 70vh;
            background: rgba(14, 10, 22, 0.95);
            border: 2px solid #ffd700;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
            border-radius: 12px;
            overflow: hidden;
            backdrop-filter: blur(6px);
            z-index: 8000;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .ms-titlebar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: linear-gradient(180deg, #4a4a8a, #2a2a5a);
            color: #ffd700;
            cursor: move;
            user-select: none;
            border-bottom: 1px solid #ffd700;
        }

        .ms-titlebar .ms-actions {
            margin-left: auto;
            display: flex;
            gap: 0.5rem;
        }

        .ms-btn {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid #ffd700;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            cursor: pointer;
            font-size: 10px;
            color: white;
        }

        .ms-btn:hover {
            background: linear-gradient(135deg, #ff6666, #ff0000);
        }

        .ms-content {
            position: relative;
            width: 100%;
            height: calc(100% - 38px);
            background: #0b1836;
        }

        .ms-iframe {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        .ms-fallback {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            color: #ffd700;
            padding: 2rem;
            text-align: center;
            background: repeating-linear-gradient(
                45deg,
                rgba(62, 10, 41, 0.25),
                rgba(62, 10, 41, 0.25) 8px,
                rgba(11, 24, 54, 0.25) 8px,
                rgba(11, 24, 54, 0.25) 16px
            );
        }

        .ms-link {
            padding: 0.6rem 1rem;
            border: 1px solid #ffd700;
            color: #ffd700;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .ms-link:hover {
            background: rgba(255, 215, 0, 0.1);
        }

        /* === ANIMAÇÕES ESPECIAIS === */
        @keyframes starFall {
            from {
                transform: translateY(-50px) rotate(0deg);
                opacity: 1;
            }
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes spellCast {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.3);
            z-index: 1001;
            width: 400px;
            max-height: 500px;
        }

        .wallpaper-header {
            background: linear-gradient(90deg, #0078d4, #106ebe);
            color: white;
            padding: 8px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 12px;
        }

        .wallpaper-header button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
        }

        .wallpaper-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .wallpaper-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border: 2px inset #c0c0c0;
            transition: all 0.2s;
        }

        .wallpaper-option:hover {
            border: 2px outset #c0c0c0;
            background: #e0e0e0;
        }

        .wallpaper-preview {
            width: 120px;
            height: 80px;
            border: 1px solid #808080;
            margin-bottom: 5px;
        }

        .wallpaper-option span {
            font-size: 10px;
            text-align: center;
        }

         /* === SISTEMA DE WALLPAPERS EXPANDIDO === */
        .wallpaper-azul-mistico {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
        }

        .wallpaper-roxo-cosmico {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%);
        }

        .wallpaper-aurora-verde {
            background: linear-gradient(135deg, #134e5e 0%, #71b280 50%, #134e5e 100%);
        }

        .wallpaper-por-do-sol {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 50%, #fa709a 100%);
        }

        .wallpaper-espaco-profundo {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
        }

        .wallpaper-prata-lunar {
            background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 50%, #bdc3c7 100%);
        }

        .wallpaper-fogo-mistico {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 50%, #ff6b6b 100%);
        }

        .wallpaper-oceano-profundo {
            background: linear-gradient(135deg, #0077be 0%, #00a8cc 50%, #0077be 100%);
        }

        .wallpaper-floresta-encantada {
            background: linear-gradient(135deg, #2d5016 0%, #3e7b27 50%, #2d5016 100%);
        }

        .wallpaper-ametista {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 50%, #8e44ad 100%);
        }

        .wallpaper-ouro-alquimico {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 50%, #f39c12 100%);
        }

        .wallpaper-cristal-azul {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 50%, #3498db 100%);
        }

        .wallpaper-nebulosa-rosa {
            background: linear-gradient(135deg, #e91e63 0%, #ad1457 50%, #e91e63 100%);
        }

        .wallpaper-terra-mistica {
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 50%, #8b4513 100%);
        }

        .wallpaper-aurora-boreal {
            background: linear-gradient(135deg, #00c9ff 0%, #92fe9d 50%, #00c9ff 100%);
        }

        .wallpaper-vinho-gotico {
            background: linear-gradient(135deg, #3e0a29 0%, #5d1a3a 50%, #3e0a29 100%);
        }    }

        /* === BARRA DE TAREFAS === */
           /* === NOVA BARRA DE TAREFAS WHIMSIGOTH === */
        :root {
            --vinho: #3e0a29;
            --salvia: #b2d1b1;
            --azul: #0b1836;
            --dourado: #f0aa53;
            --vidro: rgba(43, 25, 63, 0.7);
            --borda: rgba(240, 170, 83, 0.35);
            --bg: #0b0a12;
            --txt: #e6e2ef;
            --muted: #b2d1b1cc;
        }

        .taskbar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            height: 46px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            background: linear-gradient(180deg, rgba(62, 10, 41, 0.9), rgba(11, 24, 54, 0.9));
            border-top: 1px solid var(--borda);
            backdrop-filter: blur(6px);
            z-index: 9999;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: 1px solid var(--borda);
            border-radius: 10px;
            color: var(--salvia);
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.01));
            cursor: pointer;
            user-select: none;
            font-size: 12px;
        }

        .btn:hover {
            border-color: var(--dourado);
            color: #ffe9c2;
        }

        .start {
            font-weight: 700;
            letter-spacing: 0.3px;
        }

        .dock {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            overflow: auto;
        }

        .dock .icon {
            width: 36px;
            height: 36px;
            border: 1px solid var(--borda);
            border-radius: 8px;
            display: grid;
            place-items: center;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.03);
            font-size: 16px;
        }

        .dock .icon:hover {
            border-color: var(--dourado);
        }

        .tray {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tray .sep {
            width: 1px;
            height: 24px;
            background: var(--borda);
            opacity: 0.6;
        }

        .clock {
            min-width: 88px;
            text-align: center;
            font-variant-numeric: tabular-nums;
            color: var(--salvia);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .clock:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--dourado);
        }

        /* Controles de Volume */
        .vol {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .vol label {
            font-size: 0.85rem;
            color: var(--muted);
            min-width: 50px;
        }

        input[type=range] {
            accent-color: var(--dourado);
            width: 60px;
            height: 4px;
        }

        /* PAINÉIS DO INICIAR E CALENDÁRIO */
        .panel {
            position: fixed;
            bottom: 52px;
            border: 1px solid var(--borda);
            border-radius: 14px;
            background: rgba(18, 14, 26, 0.9);
            backdrop-filter: blur(8px);
            padding: 12px;
            display: none;
            box-shadow: 0 12px 40px rgba(0,0,0,0.5);
            z-index: 10000;
        }

        .panel.show {
            display: block;
        }

        .panel.start {
            left: 10px;
            width: 420px;
        }

        .panel.calendar {
            right: 10px;
            width: 360px;
        }

        .panel h3 {
            margin: 6px 0 10px;
            font-family: "Cinzel Decorative", serif;
            color: #ffe9c2;
            font-size: 16px;
        }

        /* CALENDÁRIO ASTROLÓGICO */
        .cal-head {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .cal-head button {
            background: none;
            border: 1px solid var(--borda);
            color: var(--salvia);
            border-radius: 8px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
        }

        .cal-head button:hover {
            border-color: var(--dourado);
        }

        .cal-meta {
            display: grid;
            gap: 6px;
            font-size: 0.92rem;
            color: var(--muted);
        }

        .cal-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-top: 10px;
        }

        .cal-days div {
            aspect-ratio: 1;
            border: 1px dashed rgba(240, 170, 83, 0.25);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .cal-days div.today {
            border-style: solid;
            color: #ffe9c2;
        }

        /* === MODO XL E DENSIDADE AJUSTÁVEL === */
        body.size-xl { 
            --tb-h: 80px; 
            --icon: 60px; 
            --pad: 16px; 
            --font-ui: 17px; 
        }
        
        body.density-compact { --gap: 4px; --pad: 8px; }
        body.density-standard { --gap: 8px; --pad: 12px; }
        body.density-spacious { --gap: 12px; --pad: 16px; }
        
        .panel.start.xl { width: 600px !important; }
        
        /* === CENTRO RÁPIDO === */
        .quick-center {
            position: fixed;
            bottom: calc(var(--tb-h, 46px) + 10px);
            left: 50%;
            transform: translateX(-50%);
            width: 480px;
            background: rgba(18,14,26,.95);
            border: 1px solid var(--borda);
            border-radius: 16px;
            padding: 16px;
            backdrop-filter: blur(8px);
            display: none;
            z-index: 10000;
        }
        
        .quick-center.show { display: block; }
        
        .quick-toggles {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .quick-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--borda);
            border-radius: 12px;
            background: rgba(255,255,255,.03);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-toggle:hover {
            border-color: var(--dourado);
            background: rgba(240,170,83,.1);
        }
        
        .quick-toggle.active {
            border-color: var(--dourado);
            background: rgba(240,170,83,.2);
        }
        
        .quick-toggle-icon {
            font-size: 24px;
            width: 32px;
            text-align: center;
        }
        
        .quick-toggle-info h4 {
            margin: 0 0 4px 0;
            font-size: 14px;
            color: var(--txt);
        }
        
        .quick-toggle-info p {
            margin: 0;
            font-size: 12px;
            color: var(--muted);
        }
        
        /* === MIXER 4 CANAIS === */
        .mixer-panel {
            border-top: 1px solid var(--borda);
            padding-top: 16px;
        }
        
        .mixer-title {
            font-family: "Cinzel Decorative", serif;
            color: #ffe9c2;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .mixer-channels {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .mixer-channel {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .mixer-channel-label {
            font-size: 12px;
            color: var(--muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .mixer-channel input[type="range"] {
            width: 100%;
            accent-color: var(--dourado);
        }
        
        /* === ANEL DO DIA === */
        .day-ring {
            position: relative;
            width: 48px;
            height: 48px;
            margin-right: 8px;
        }
        
        .day-ring-bg {
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                var(--dourado) 0deg,
                var(--dourado) calc(var(--pct, 0) * 360deg),
                rgba(240,170,83,.2) calc(var(--pct, 0) * 360deg),
                rgba(240,170,83,.2) 360deg
            );
            padding: 2px;
        }
        
        .day-ring-inner {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .risk-indicator {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid var(--bg);
        }
        
        .risk-low { background: #25d366; }
        .risk-medium { background: var(--dourado); }
        .risk-high { background: #b33434; }
        
        /* === CHIPS VIVOS === */
        .astro-chips {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .astro-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border: 1px solid var(--borda);
            border-radius: 8px;
            background: rgba(255,255,255,.03);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .astro-chip:hover {
            border-color: var(--dourado);
            background: rgba(240,170,83,.1);
        }
        
        .astro-chip.critical {
            border-color: #b33434;
            background: rgba(179,52,52,.1);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* === POPOVER === */
        .popover {
            position: fixed;
            background: rgba(18,14,26,.95);
            border: 1px solid var(--borda);
            border-radius: 12px;
            padding: 12px;
            backdrop-filter: blur(8px);
            box-shadow: 0 10px 30px rgba(0,0,0,.5);
            z-index: 10001;
            display: none;
            min-width: 200px;
            max-width: 320px;
        }
        
        .popover.show { display: block; }
        
        .popover-title {
            font-family: "Cinzel Decorative", serif;
            color: #ffe9c2;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .popover-content {
            font-size: 13px;
            line-height: 1.4;
        }
        
        .popover-events {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .popover-event {
            padding: 6px 0;
            border-bottom: 1px solid rgba(240,170,83,.1);
        }
        
        .popover-event:last-child {
            border-bottom: none;
        }
        
        .popover-event-time {
            font-size: 11px;
            color: var(--muted);
        }
        
        .popover-event-desc {
            margin-top: 2px;
        }
        
        .export-ics-btn {
            margin-top: 8px;
            padding: 6px 12px;
            border: 1px solid var(--borda);
            border-radius: 8px;
            background: rgba(240,170,83,.1);
            color: var(--txt);
            cursor: pointer;
            font-size: 12px;
            width: 100%;
        }
        
        .export-ics-btn:hover {
            background: rgba(240,170,83,.2);
        }
        
        /* === PALETA DE COMANDOS === */
        .command-palette {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            background: rgba(18,14,26,.95);
            border: 1px solid var(--borda);
            border-radius: 16px;
            backdrop-filter: blur(8px);
            box-shadow: 0 20px 60px rgba(0,0,0,.7);
            z-index: 10002;
            display: none;
        }
        
        .command-palette.show { display: block; }
        
        .command-input {
            width: 100%;
            padding: 16px;
            border: none;
            background: transparent;
            color: var(--txt);
            font-size: 16px;
            outline: none;
            border-bottom: 1px solid var(--borda);
        }
        
        .command-results {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .command-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(240,170,83,.05);
        }
        
        .command-item:hover,
        .command-item.selected {
            background: rgba(240,170,83,.1);
        }
        
        .command-item-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .command-item-info h4 {
            margin: 0 0 2px 0;
            font-size: 14px;
        }
        
        /* === ÍCONE DE VOLUME ESTILO WINDOWS ME === */
        .volume-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 16px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .volume-icon:hover {
            background: rgba(240,170,83,.1);
        }
        
        /* === POPUP DE VOLUME === */
        .volume-popup {
            position: fixed;
            bottom: calc(var(--tb-h, 46px) + 10px);
            right: 120px;
            width: 200px;
            background: rgba(18,14,26,.95);
            border: 1px solid var(--borda);
            border-radius: 8px;
            padding: 12px;
            backdrop-filter: blur(8px);
            box-shadow: 0 8px 24px rgba(0,0,0,.5);
            display: none;
            z-index: 10001;
        }
        
        .volume-popup.show {
            display: block;
        }
        
        .volume-popup-title {
            font-family: "Cinzel Decorative", serif;
            color: #ffe9c2;
            font-size: 14px;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .volume-control {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .volume-control:last-child {
            margin-bottom: 0;
        }
        
        .volume-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: var(--muted);
        }
        
        .volume-slider {
            width: 100%;
            accent-color: var(--dourado);
            height: 4px;
        }
        
        .volume-value {
            font-size: 11px;
            color: var(--dourado);
            min-width: 30px;
            text-align: right;
        }
        
        .volume-test-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 8px;
            border-top: 1px solid var(--borda);
        }
        
        .volume-test-btn {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid var(--borda);
            border-radius: 4px;
            background: rgba(255,255,255,.03);
            color: var(--txt);
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        /* === MODO XL + DENSIDADES === */
        body.size-xl {
            --tb-h: 80px;
            --icon: 60px;
            --pad: 16px;
            --font-ui: 17px;
            --gap: 12px;
        }
        
        body.density-compact {
            --pad: 4px;
            --gap: 4px;
        }
        
        body.density-standard {
            --pad: 8px;
            --gap: 8px;
        }
        
        body.density-spacious {
            --pad: 16px;
            --gap: 12px;
        }
        
        /* Aplicar modo XL aos elementos */
        body.size-xl .taskbar {
            height: var(--tb-h);
            padding: 0 var(--pad);
            gap: var(--gap);
        }
        
        body.size-xl .desktop-icon {
            width: var(--icon);
            height: var(--icon);
            font-size: calc(var(--icon) * 0.4);
        }
        
        body.size-xl .desktop-icon span {
            font-size: calc(var(--font-ui) - 2px);
            margin-top: var(--gap);
        }
        
        body.size-xl .start-btn {
            height: calc(var(--tb-h) - 16px);
            padding: 0 var(--pad);
            font-size: var(--font-ui);
        }
        
        body.size-xl .panel.start {
            width: 600px !important;
            font-size: var(--font-ui);
        }
        
        body.size-xl .astro-chip {
            height: calc(var(--tb-h) - 20px);
            padding: 0 var(--pad);
            font-size: calc(var(--font-ui) - 2px);
        }
        
        body.size-xl .volume-icon {
            width: calc(var(--tb-h) - 16px);
            height: calc(var(--tb-h) - 16px);
            font-size: calc(var(--font-ui) + 2px);
        }
        
        /* === CENTRO RÁPIDO AVANÇADO === */
        .quick-center {
            position: fixed;
            bottom: calc(var(--tb-h, 46px) + 10px);
            right: 20px;
            width: 320px;
            background: rgba(18,14,26,.95);
            border: 1px solid var(--borda);
            border-radius: 12px;
            padding: 16px;
            backdrop-filter: blur(12px);
            box-shadow: 0 12px 32px rgba(0,0,0,.6);
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10002;
        }
        
        .quick-center.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .quick-center-title {
            font-family: "Cinzel Decorative", serif;
            color: #ffe9c2;
            font-size: 16px;
            margin-bottom: 16px;
            text-align: center;
            border-bottom: 1px solid var(--borda);
            padding-bottom: 8px;
        }
        
        /* === TOGGLES GRANDES === */
        .quick-toggles {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .quick-toggle {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 16px 12px;
            border: 1px solid var(--borda);
            border-radius: 8px;
            background: rgba(255,255,255,.03);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .quick-toggle:hover {
            border-color: var(--dourado);
            background: rgba(240,170,83,.1);
            transform: translateY(-2px);
        }
        
        .quick-toggle.active {
            border-color: var(--dourado);
            background: rgba(240,170,83,.15);
            box-shadow: 0 0 12px rgba(240,170,83,.3);
        }
        
        .quick-toggle-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .quick-toggle-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--txt);
            margin-bottom: 2px;
        }
        
        .quick-toggle-subtitle {
            font-size: 10px;
            color: var(--muted);
            line-height: 1.2;
        }
        
        /* === MIXER 4 CANAIS === */
        .advanced-mixer {
            border-top: 1px solid var(--borda);
            padding-top: 16px;
        }
        
        .mixer-title {
            font-size: 14px;
            color: var(--txt);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .mixer-channels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .mixer-channel {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .mixer-channel-label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 11px;
            color: var(--muted);
        }
        
        .mixer-channel-icon {
            font-size: 14px;
        }
        
        .mixer-channel-value {
            font-size: 10px;
            color: var(--dourado);
            min-width: 25px;
            text-align: right;
        }
        
        .mixer-channel-slider {
            width: 100%;
            height: 4px;
            accent-color: var(--dourado);
            background: rgba(255,255,255,.1);
            border-radius: 2px;
        }
        
        .mixer-channel-slider::-webkit-slider-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--dourado);
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,.3);
        }
        
        /* === DUCKING INDICATOR === */
        .ducking-indicator {
            margin-top: 12px;
            padding: 8px;
            border-radius: 6px;
            background: rgba(240,170,83,.1);
            border: 1px solid rgba(240,170,83,.3);
            font-size: 10px;
            color: var(--dourado);
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .ducking-indicator.active {
            opacity: 1;
        }
        
        /* === MODO XL PARA CENTRO RÁPIDO === */
        body.size-xl .quick-center {
            width: 380px;
            padding: 20px;
        }
        
        body.size-xl .quick-toggle {
            padding: 20px 16px;
        }
        
        body.size-xl .quick-toggle-icon {
            font-size: 28px;
        }
        
        body.size-xl .quick-toggle-title {
            font-size: 14px;
        }
        
        /* === CHIPS ASTROLÓGICOS INTEGRADOS COM MODO XL === */
        body.size-xl .astro-chip {
            height: calc(var(--tb-h) - 20px);
            padding: 0 var(--pad);
            font-size: calc(var(--font-ui) - 1px);
            min-width: 80px;
            gap: var(--gap);
        }
        
        body.size-xl .astro-chip.critical {
            animation: pulse-xl 2s infinite;
            box-shadow: 0 0 16px rgba(240,170,83,.4);
        }
        
        @keyframes pulse-xl {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 16px rgba(240,170,83,.4);
            }
            50% { 
                transform: scale(1.05); 
                box-shadow: 0 0 24px rgba(240,170,83,.6);
            }
        }
        
        /* === POPOVERS APRIMORADOS PARA XL === */
        body.size-xl .astro-popover {
            width: 350px;
            padding: 20px;
            font-size: calc(var(--font-ui) - 1px);
            border-radius: 12px;
            box-shadow: 0 16px 48px rgba(0,0,0,.7);
        }
        
        body.size-xl .astro-popover h3 {
            font-size: calc(var(--font-ui) + 2px);
            margin-bottom: 16px;
        }
        
        body.size-xl .astro-popover .event-item {
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 8px;
        }
        
        body.size-xl .astro-popover .event-time {
            font-size: calc(var(--font-ui) - 2px);
            margin-bottom: 6px;
        }
        
        body.size-xl .astro-popover .event-description {
            font-size: calc(var(--font-ui) - 1px);
            line-height: 1.4;
        }
        
        body.size-xl .export-ics-btn {
            padding: 12px 20px;
            font-size: calc(var(--font-ui) - 1px);
            border-radius: 8px;
            margin-top: 16px;
        }
        
        /* === ANEL DO DIA APRIMORADO PARA XL === */
        body.size-xl .day-ring {
            width: calc(var(--tb-h) - 16px);
            height: calc(var(--tb-h) - 16px);
            border-width: 4px;
        }
        
        body.size-xl .day-ring::before {
            font-size: calc(var(--font-ui) + 4px);
        }
        
        body.size-xl .planetary-hour-info {
            font-size: calc(var(--font-ui) - 2px);
        }
        
        /* === TOOLTIPS APRIMORADOS === */
        body.size-xl .astro-chip::after {
            font-size: calc(var(--font-ui) - 2px);
            padding: 10px 14px;
            border-radius: 8px;
            max-width: 280px;
            line-height: 1.3;
        }
        
        /* === RESPONSIVIDADE DOS CHIPS === */
        body.size-xl .taskbar-center {
            gap: calc(var(--gap) + 4px);
        }
        
        body.size-xl .astro-chips-container {
            gap: calc(var(--gap) + 2px);
        }
        
        /* === INDICADORES VISUAIS APRIMORADOS === */
        body.size-xl .chip-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: absolute;
            top: 6px;
            right: 6px;
            background: var(--dourado);
            box-shadow: 0 0 8px rgba(240,170,83,.6);
        }
        
        body.size-xl .chip-indicator.critical {
            background: #ff4757;
            box-shadow: 0 0 12px rgba(255,71,87,.8);
            animation: blink-xl 1s infinite;
        }
        
        @keyframes blink-xl {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        /* === INTEGRAÇÃO COM DENSIDADE ESPAÇOSA === */
        body.size-xl.density-spacious .astro-chip {
            margin: 0 calc(var(--gap) / 2);
            padding: 0 calc(var(--pad) + 4px);
        }
        
        body.size-xl.density-spacious .day-ring {
            margin: 0 calc(var(--gap) + 2px);
        }
        
        /* === ESTADOS HOVER APRIMORADOS === */
        body.size-xl .astro-chip:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 24px rgba(240,170,83,.3);
            border-color: rgba(240,170,83,.8);
        }
        
        /* === POPOVERS ASTROLÓGICOS AVANÇADOS === */
        .astro-popover-advanced {
            position: fixed;
            background: rgba(18,14,26,.98);
            border: 1px solid var(--borda);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0,0,0,.8);
            z-index: 10003;
            width: 420px;
            max-height: 600px;
            overflow-y: auto;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .astro-popover-advanced.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .popover-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--borda);
        }
        
        .popover-title {
            font-family: "Cinzel Decorative", serif;
            font-size: 18px;
            color: var(--dourado);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .popover-close {
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255,255,255,.1);
            color: var(--txt);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .popover-close:hover {
            background: rgba(240,170,83,.2);
            color: var(--dourado);
        }
        
        /* === TIMELINE INTERATIVA === */
        .astro-timeline {
            margin: 20px 0;
        }
        
        .timeline-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .timeline-title {
            font-size: 14px;
            color: var(--txt);
            font-weight: 600;
        }
        
        .timeline-nav {
            display: flex;
            gap: 8px;
        }
        
        .timeline-nav-btn {
            width: 24px;
            height: 24px;
            border: 1px solid var(--borda);
            background: rgba(255,255,255,.05);
            color: var(--txt);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .timeline-nav-btn:hover {
            border-color: var(--dourado);
            background: rgba(240,170,83,.1);
        }
        
        .timeline-container {
            position: relative;
            overflow-x: auto;
            padding: 16px 0;
        }
        
        .timeline-track {
            display: flex;
            gap: 24px;
            min-width: 100%;
            position: relative;
        }
        
        .timeline-track::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--borda), var(--dourado), var(--borda));
            z-index: 1;
        }
        
        .timeline-event {
            position: relative;
            min-width: 120px;
            text-align: center;
            z-index: 2;
        }
        
        .timeline-marker {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--dourado);
            margin: 0 auto 8px;
            position: relative;
            box-shadow: 0 0 12px rgba(240,170,83,.6);
        }
        
        .timeline-marker.critical {
            background: #ff4757;
            box-shadow: 0 0 12px rgba(255,71,87,.6);
            animation: pulse-timeline 2s infinite;
        }
        
        @keyframes pulse-timeline {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .timeline-date {
            font-size: 11px;
            color: var(--muted);
            margin-bottom: 4px;
        }
        
        .timeline-description {
            font-size: 12px;
            color: var(--txt);
            line-height: 1.3;
        }
        
        /* === AÇÕES RÁPIDAS === */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }
        
        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border: 1px solid var(--borda);
            background: rgba(255,255,255,.03);
            color: var(--txt);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
            text-decoration: none;
        }
        
        .quick-action-btn:hover {
            border-color: var(--dourado);
            background: rgba(240,170,83,.1);
            transform: translateY(-1px);
        }
        
        .quick-action-icon {
            font-size: 16px;
        }
        
        /* === VISUALIZAÇÕES AVANÇADAS === */
        .astro-visualization {
            margin: 20px 0;
            padding: 16px;
            background: rgba(255,255,255,.02);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,.05);
        }
        
        .viz-title {
            font-size: 14px;
            color: var(--txt);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .intensity-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .intensity-label {
            font-size: 12px;
            color: var(--muted);
            min-width: 80px;
        }
        
        .intensity-track {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .intensity-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.8s ease;
        }
        
        .intensity-fill.low {
            background: linear-gradient(90deg, #2ed573, #7bed9f);
            width: 30%;
        }
        
        .intensity-fill.medium {
            background: linear-gradient(90deg, #ffa502, #ff6348);
            width: 65%;
        }
        
        .intensity-fill.high {
            background: linear-gradient(90deg, #ff4757, #c44569);
            width: 90%;
        }
        
        .intensity-value {
            font-size: 12px;
            color: var(--dourado);
            min-width: 40px;
            text-align: right;
        }
        
        /* === SISTEMA DE NOTIFICAÇÕES === */
        .notification-settings {
            margin: 20px 0;
            padding: 16px;
            background: rgba(240,170,83,.05);
            border: 1px solid rgba(240,170,83,.2);
            border-radius: 12px;
        }
        
        .notification-title {
            font-size: 14px;
            color: var(--dourado);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .notification-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .notification-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .notification-option:hover {
            background: rgba(240,170,83,.1);
        }
        
        .notification-checkbox {
            width: 16px;
            height: 16px;
            border: 1px solid var(--borda);
            border-radius: 3px;
            background: rgba(255,255,255,.05);
            position: relative;
            cursor: pointer;
        }
        
        .notification-checkbox.checked {
            background: var(--dourado);
            border-color: var(--dourado);
        }
        
        .notification-checkbox.checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-size: 10px;
            font-weight: bold;
        }
        
        .notification-label {
            font-size: 12px;
            color: var(--txt);
        }

        .cal-days div:hover {
            background: rgba(240, 170, 83, 0.05);
        }

        /* Ícone Planetário */
        .planetary-icon {
            font-size: 18px;
            color: var(--dourado);
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: all 0.3s ease;
            animation: planetaryGlow 3s infinite alternate;
        }

        .planetary-icon:hover {
            background: rgba(240, 170, 83, 0.2);
            transform: scale(1.1);
        }

        /* === SISTEMA DE NOTIFICAÇÕES CONTROLADO === */
        .toast {
            position: fixed;
            right: 16px;
            bottom: 64px;
            min-width: 260px;
            max-width: 360px;
            padding: 12px 14px;
            border: 1px solid var(--borda);
            border-radius: 12px;
            background: rgba(18, 14, 26, 0.95);
            color: var(--txt);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.55);
            opacity: 0;
            transform: translateY(10px);
            transition: 0.25s ease;
            z-index: 10000;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast .title {
            font-family: "Cinzel Decorative", serif;
            color: #ffe9c2;
            margin-bottom: 6px;
            font-weight: bold;
        }

        .toast .meta {
            font-size: 0.9rem;
            color: var(--muted);
        }

        .badge-dot {
            display: inline-flex;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 1px solid var(--borda);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.25) inset;
        }

        .badge-green {
            background: #25d366;
        }

        .badge-red {
            background: #dc3545;
        }

        /* Controles AFÁST! */
        .afast-controls {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .afast-btn {
            padding: 4px 8px;
            border: 1px solid var(--borda);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: var(--salvia);
            cursor: pointer;
            font-size: 10px;
            transition: all 0.3s ease;
        }

        .afast-btn:hover {
            border-color: var(--dourado);
            color: #ffe9c2;
        }

        .afast-btn.active {
            background: var(--dourado);
            color: #000;
        }

        .connection-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: var(--muted);
        }
        }

        /* === CALENDÁRIO ASTROLÓGICO === */
        .astro-calendar {
            position: fixed;
            bottom: 50px;
            right: 10px;
            width: 350px;
            height: 400px;
            background: linear-gradient(180deg, #c0c0c0 0%, #808080 100%);
            border: 2px outset #c0c0c0;
            display: none;
            z-index: 9999;
            font-family: 'MS Sans Serif', sans-serif;
        }

        .calendar-header {
            background: linear-gradient(180deg, #4169e1 0%, #0000cd 100%);
            color: white;
            padding: 8px;
            font-weight: bold;
            text-align: center;
            font-size: 14px;
        }

        .calendar-content {
            padding: 10px;
            height: calc(100% - 40px);
            overflow-y: auto;
        }

        .planetary-hour-info {
            background: #f0f0f0;
            border: 1px inset #c0c0c0;
            padding: 8px;
            margin-bottom: 10px;
            font-size: 11px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-bottom: 10px;
        }

        .calendar-day {
            background: #f0f0f0;
            border: 1px outset #c0c0c0;
            padding: 4px;
            text-align: center;
            font-size: 10px;
            cursor: pointer;
            min-height: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .calendar-day:hover {
            background: #e0e0e0;
        }

        .calendar-day.today {
            background: #4169e1;
            color: white;
        }

        .astro-indicator {
            font-size: 8px;
            margin-top: 1px;
        }

        /* === ÍCONES DO DESKTOP === */
        .desktop-icons {
            position: absolute;
            top: 10px;
            left: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, 64px);
            gap: 10px;
            z-index: 10;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 2px;
            border-radius: 2px;
            transition: background 0.2s;
            width: 64px;
            height: 64px;
        }

        .desktop-icon:hover {
            background: rgba(0, 0, 255, 0.2);
        }

        .icon-image {
            width: 32px;
            height: 32px;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            image-rendering: pixelated;
            object-fit: contain;
        }

        .icon-label {
            color: white;
            font-size: 10px;
            text-align: center;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.8);
            font-weight: normal;
            line-height: 1.1;
            max-width: 60px;
            word-wrap: break-word;
        }

        .icon-image img {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            object-fit: contain;
        }

        .icon-label {
            font-size: 12px;
            text-align: center;
            color: var(--pergaminho);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        /* === JANELAS === */
        .window {
            position: absolute;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            min-width: 300px;
            min-height: 200px;
            display: none;
            z-index: 1000;
        }

        .window.active {
            display: block;
        }

        .window-header {
            background: linear-gradient(90deg, #0000ff, #000080);
            color: white;
            padding: 4px 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .window-title {
            font-weight: bold;
            font-size: 12px;
        }

        .window-controls {
            display: flex;
            gap: 2px;
        }

        .window-btn {
            width: 16px;
            height: 14px;
            background: #c0c0c0;
            border: 1px outset #c0c0c0;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .window-btn:active {
            border: 1px inset #c0c0c0;
        }

        .window-content {
            padding: 15px;
            background: #c0c0c0;
            color: #000;
        }

        /* === WIDGET ASTROMÁGICK === */
        .astromagick-widget {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            background: rgba(11, 24, 54, 0.9);
            border: 2px solid var(--dourado);
            border-radius: 12px;
            padding: 15px;
            color: var(--pergaminho);
            backdrop-filter: blur(10px);
        }

        .widget-header {
            text-align: center;
            margin-bottom: 15px;
            color: var(--dourado);
            font-weight: bold;
        }

        .astro-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 12px;
        }

        .astro-item {
            background: rgba(240, 170, 83, 0.1);
            padding: 8px;
            border-radius: 6px;
            border: 1px solid rgba(240, 170, 83, 0.3);
        }

        .astro-label {
            color: var(--verde);
            font-weight: bold;
            margin-bottom: 4px;
        }

        .astro-value {
            color: var(--pergaminho);
        }

        /* === AURORA PLAYER === */
        .aurora-player {
            width: 500px;
            height: 400px;
        }

        .player-header {
            background: linear-gradient(135deg, var(--vinho), var(--azul));
            color: var(--pergaminho);
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        .player-content {
            background: #c0c0c0;
            padding: 0;
            height: calc(100% - 40px);
            display: flex;
            flex-direction: column;
        }

        .player-display {
            background: #000;
            color: var(--dourado);
            padding: 15px;
            text-align: center;
            font-family: 'Courier New', monospace;
            border-bottom: 2px inset #c0c0c0;
        }

        .track-info {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .time-info {
            font-size: 12px;
            opacity: 0.8;
        }

        .player-controls {
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            border-bottom: 2px inset #c0c0c0;
        }

        .control-btn {
            width: 40px;
            height: 30px;
            background: linear-gradient(180deg, #c0c0c0 0%, #808080 100%);
            border: 2px outset #c0c0c0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .control-btn:active {
            border: 2px inset #c0c0c0;
        }

        .volume-section {
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px inset #c0c0c0;
        }

        .volume-slider {
            flex: 1;
            height: 20px;
        }

        .playlist-section {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
        }

        .playlist-item {
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            margin-bottom: 2px;
            font-size: 12px;
        }

        .playlist-item:hover {
            background: #e0e0e0;
        }

        .playlist-item.active {
            background: var(--azul);
            color: white;
        }

        .admin-section {
            padding: 10px;
            border-top: 2px inset #c0c0c0;
        }

        .admin-btn {
            background: linear-gradient(180deg, #c0c0c0 0%, #808080 100%);
            border: 2px outset #c0c0c0;
            padding: 5px 10px;
            cursor: pointer;
            margin-right: 5px;
            font-size: 11px;
        }

        .admin-btn:active {
            border: 2px inset #c0c0c0;
        }

        /* === WITCH.TV === */
        .witch-tv {
            width: 600px;
            height: 450px;
        }

        .tv-screen {
            background: #000;
            height: 250px;
            border: 3px inset #c0c0c0;
            margin: 10px;
            position: relative;
            overflow: hidden;
        }

        .tv-static {
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(255,255,255,0.1) 2px,
                rgba(255,255,255,0.1) 4px
            );
            animation: static 0.1s infinite;
        }

        @keyframes static {
            0% { opacity: 0.8; }
            50% { opacity: 0.4; }
            100% { opacity: 0.8; }
        }

        .tv-content {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--pergaminho);
            font-size: 18px;
            text-align: center;
        }

        .channel-list {
            padding: 10px;
            max-height: 120px;
            overflow-y: auto;
        }

        .channel-item {
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 3px;
            margin-bottom: 2px;
            font-size: 12px;
            display: flex;
            justify-content: space-between;
        }

        .channel-item:hover {
            background: #e0e0e0;
        }

        .channel-item.active {
            background: var(--vinho);
            color: white;
        }

        /* === TARÔ === */
        .tarot-app {
            width: 500px;
            height: 400px;
        }

        .tarot-spread {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 20px;
            height: 200px;
        }

        .tarot-card {
            background: linear-gradient(135deg, var(--vinho), var(--azul));
            border: 2px solid var(--dourado);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--pergaminho);
            font-size: 24px;
            transition: transform 0.3s;
        }

        .tarot-card:hover {
            transform: scale(1.05);
        }

        .tarot-card.revealed {
            background: linear-gradient(135deg, var(--dourado), #ffd700);
            color: var(--azul);
        }

        .tarot-reading {
            padding: 15px;
            background: rgba(11, 24, 54, 0.1);
            border-radius: 8px;
            margin: 10px;
            font-size: 12px;
        }

        /* === LIVROS INTERATIVOS === */
        .books-app {
            width: 550px;
            height: 450px;
        }

        .book-shelf {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 15px;
            height: 200px;
        }

        .book-spine {
            background: linear-gradient(180deg, var(--vinho), var(--azul));
            border: 1px solid var(--dourado);
            border-radius: 4px;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            padding: 10px 5px;
            cursor: pointer;
            color: var(--pergaminho);
            font-size: 10px;
            text-align: center;
            transition: transform 0.2s;
        }

        .book-spine:hover {
            transform: translateY(-5px);
        }

        .book-content {
            padding: 15px;
            background: var(--pergaminho);
            color: var(--azul);
            border-radius: 8px;
            margin: 10px;
            height: 150px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.4;
        }

        /* === AFAST! === */
        .afast-app {
            width: 450px;
            height: 350px;
        }

        .speech-area {
            background: #000;
            color: var(--verde);
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            height: 150px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-y: auto;
        }

        .speech-controls {
            padding: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .speech-btn {
            background: linear-gradient(180deg, #c0c0c0 0%, #808080 100%);
            border: 2px outset #c0c0c0;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 12px;
        }

        .speech-btn:active {
            border: 2px inset #c0c0c0;
        }

        .speech-btn.recording {
            background: linear-gradient(180deg, #ff4444 0%, #cc0000 100%);
            color: white;
        }

        /* Estilos AstroMágick Expandido */
        .astro-tabs {
            display: flex;
            border-bottom: 2px solid var(--dourado);
            margin-bottom: 15px;
            background: linear-gradient(180deg, #f0f0f0 0%, #d0d0d0 100%);
            border-radius: 5px 5px 0 0;
        }

        .astro-tab {
            flex: 1;
            padding: 10px 15px;
            border: none;
            background: linear-gradient(180deg, #e0e0e0 0%, #c0c0c0 100%);
            border-right: 1px solid #999;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .astro-tab:last-child {
            border-right: none;
        }

        .astro-tab:hover {
            background: linear-gradient(180deg, #f0f0f0 0%, #d0d0d0 100%);
        }

        .astro-tab.active {
            background: linear-gradient(180deg, var(--dourado) 0%, #e6a000 100%);
            color: white;
            border-bottom: 2px solid var(--verde-salvia);
        }

        .astro-tab-content {
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
        }

        .astro-tab-panel {
            display: none;
            padding: 15px;
            background: rgba(255,255,255,0.9);
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .astro-tab-panel.active {
            display: block;
        }

        .planets-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .planet-item {
            padding: 8px;
            background: linear-gradient(180deg, #f8f8f8 0%, #e8e8e8 100%);
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }

        .lunar-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }

        .lunar-phase, .lunar-calendar, .lunar-energy {
            padding: 10px;
            background: linear-gradient(180deg, #f0f8ff 0%, #e0f0ff 100%);
            border: 1px solid var(--azul-marinho);
            border-radius: 5px;
        }

        .phase-display {
            font-size: 18px;
            text-align: center;
            margin: 10px 0;
        }

        .illumination {
            text-align: center;
            font-weight: bold;
            color: var(--dourado);
        }

        .phase-item {
            margin: 5px 0;
            padding: 5px;
            background: rgba(255,255,255,0.5);
            border-radius: 3px;
        }

        .transits-list, .aspects-list, .alerts-section {
            margin-top: 10px;
        }

        .transit-item, .aspect-item, .alert-item {
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }

        .transit-item.favorable, .aspect-item.harmonious, .alert-item.favorable {
            background: linear-gradient(180deg, #f0fff0 0%, #e0ffe0 100%);
            border-left-color: #00aa00;
        }

        .transit-item.attention, .aspect-item.neutral {
            background: linear-gradient(180deg, #fffaf0 0%, #fff0e0 100%);
            border-left-color: #ffaa00;
        }

        .aspect-item.tense, .alert-item.attention {
            background: linear-gradient(180deg, #fff8f0 0%, #ffe8e0 100%);
            border-left-color: #ff6600;
        }

        .alert-item.critical {
            background: linear-gradient(180deg, #fff0f0 0%, #ffe0e0 100%);
            border-left-color: #ff0000;
        }

        .alert-settings {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(180deg, #f8f8f8 0%, #e8e8e8 100%);
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .setting-item {
            margin: 8px 0;
            padding: 5px;
        }

        .setting-item label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .setting-item input[type="checkbox"] {
            margin-right: 8px;
        }

        .astro-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ccc;
        }

        .astro-btn {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .astro-btn.primary {
            background: linear-gradient(180deg, var(--dourado) 0%, #e6a000 100%);
            color: white;
        }

        .astro-btn.secondary {
            background: linear-gradient(180deg, var(--verde-salvia) 0%, #a0c0a0 100%);
            color: white;
        }

        .astro-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* === NOTIFICAÇÕES ESTILO MSN === */
        .msn-notification {
            position: fixed;
            bottom: 50px;
            right: 20px;
            width: 300px;
            background: linear-gradient(180deg, #e6e6fa 0%, #d8bfd8 100%);
            border: 2px outset #c0c0c0;
            border-radius: 8px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            font-family: 'MS Sans Serif', sans-serif;
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.5s ease-out;
        }

        .msn-notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .msn-notification.hide {
            transform: translateY(100%);
            opacity: 0;
        }

        .msn-header {
            background: linear-gradient(180deg, #4169e1 0%, #0000cd 100%);
            color: white;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: bold;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .msn-close {
            background: none;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            padding: 0;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .msn-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .msn-content {
            padding: 12px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .msn-icon {
            width: 32px;
            height: 32px;
            background: var(--azul);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .msn-text {
            flex: 1;
        }

        .msn-title {
            font-weight: bold;
            font-size: 12px;
            color: #000080;
            margin-bottom: 4px;
        }

        .msn-message {
            font-size: 11px;
            color: #000;
            line-height: 1.3;
        }

        .msn-time {
            font-size: 10px;
            color: #666;
            margin-top: 4px;
        }
        /* === INDICADORES DE INTEGRAÇÃO AFÁST! === */
        #duckingIndicator.active {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }
        
        #voiceControlPanel.show {
            display: block !important;
        }
        
        /* Animação para indicador de comando de voz */
        @keyframes voicePulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
        }
        
        .voice-listening {
            animation: voicePulse 2s infinite;
        }

    </style>
</head>
<body>
    <!-- Container de Notificações MSN -->
    <div id="msn-notifications-container"></div>
    <!-- Tela de Boot -->
    <div class="boot-screen" id="boot-screen">
        <div class="boot-orbs" id="boot-orbs"></div>
        <div class="boot-content">
            <div class="boot-logo">
                <img src="icons/MysticSoft-new.png" alt="MysticSoft" style="width: 120px; height: 120px; image-rendering: pixelated;">
            </div>
            <h1 class="boot-title">MysticSoft</h1>
            <h2 class="boot-version">Millennium Edition</h2>
            <p class="boot-subtitle">Sistema Operacional Místico</p>
            <div class="boot-progress-container">
                <div class="boot-progress">
                    <div class="boot-progress-fill" id="boot-progress"></div>
                </div>
                <p class="boot-status" id="boot-status">Inicializando sistema...</p>
            </div>
            <p class="boot-hint">Clique para iniciar</p>
            <div class="boot-copyright">
                <p>Copyright © 2025 MysticSoft Corporation</p>
                <p>Todos os direitos reservados</p>
            </div>
        </div>
    </div>

    <!-- Desktop -->
    <div class="desktop" id="desktop" oncontextmenu="showDesktopMenu(event)">
        <!-- Ícone            <div class="desktop-icons">
                <div class="desktop-icon" ondblclick="openApp('astromagick')">
                    <div class="icon-image">🔮</div>
                    <div class="icon-label">AstroMágick</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('aurora-player')">
                    <div class="icon-image">🎵</div>
                    <div class="icon-label">Aurora Player</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('witch-tv')">
                    <div class="icon-image">📺</div>
                    <div class="icon-label">Witch.TV</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('afast')">
                    <div class="icon-image">🛡️</div>
                    <div class="icon-label">AFÁST!</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('tarot')">
                    <div class="icon-image">🃏</div>
                    <div class="icon-label">Tarô</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('livros')">
                    <div class="icon-image">📚</div>
                    <div class="icon-label">Livros Interativos</div>
                </div>
                
                <!-- NOVAS APLICAÇÕES MÍSTICAS -->
                <div class="desktop-icon" ondblclick="openApp('numerologia')">
                    <div class="icon-image">🔢</div>
                    <div class="icon-label">Numerologia</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('iching')">
                    <div class="icon-image">☯️</div>
                    <div class="icon-label">I Ching</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('runas')">
                    <div class="icon-image">ᚱ</div>
                    <div class="icon-label">Runas</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('cristais')">
                    <div class="icon-image">💎</div>
                    <div class="icon-label">Cristaloterapia</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('carta-natal')">
                    <div class="icon-image">🌟</div>
                    <div class="icon-label">Carta Natal</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('ar-constelacoes')">
                    <div class="icon-image">🌌</div>
                    <div class="icon-label">AR Constelações</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('sincronizacao')">
                    <div class="icon-image">☁️</div>
                    <div class="icon-label">Sincronização</div>
                </div>
                
                <div class="desktop-icon" ondblclick="openApp('temas')">
                    <div class="icon-image">🎨</div>
                    <div class="icon-label">Temas</div>
                </div>
            </div>o Desktop -->
        <div class="desktop-context-menu" id="desktop-context-menu">
            <div class="context-menu-item" onclick="showWallpaperMenu()">
                <span>🖼️ Alterar Plano de Fundo</span>
            </div>
            <div class="context-menu-item" onclick="showDesktopProperties()">
                <span>⚙️ Propriedades</span>
            </div>
            <div class="context-menu-item" onclick="refreshDesktop()">
                <span>🔄 Atualizar</span>
            </div>
        </div>

        <!-- Menu de Wallpapers         <div class="wallpaper-modal" id="wallpaper-modal">
            <div class="wallpaper-content">
                <h3>🖼️ Alterar Plano de Fundo</h3>
                <div class="wallpaper-grid">
                    <div class="wallpaper-option" onclick="changeWallpaper('azul-mistico')" data-bg="azul-mistico">
                        <div class="wallpaper-preview wallpaper-azul-mistico"></div>
                        <span>🔵 Azul Místico</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('roxo-cosmico')" data-bg="roxo-cosmico">
                        <div class="wallpaper-preview wallpaper-roxo-cosmico"></div>
                        <span>🟣 Roxo Cósmico</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('aurora-verde')" data-bg="aurora-verde">
                        <div class="wallpaper-preview wallpaper-aurora-verde"></div>
                        <span>🟢 Aurora Verde</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('por-do-sol')" data-bg="por-do-sol">
                        <div class="wallpaper-preview wallpaper-por-do-sol"></div>
                        <span>🟠 Pôr do Sol</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('espaco-profundo')" data-bg="espaco-profundo">
                        <div class="wallpaper-preview wallpaper-espaco-profundo"></div>
                        <span>⚫ Espaço Profundo</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('prata-lunar')" data-bg="prata-lunar">
                        <div class="wallpaper-preview wallpaper-prata-lunar"></div>
                        <span>⚪ Prata Lunar</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('fogo-mistico')" data-bg="fogo-mistico">
                        <div class="wallpaper-preview wallpaper-fogo-mistico"></div>
                        <span>🔥 Fogo Místico</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('oceano-profundo')" data-bg="oceano-profundo">
                        <div class="wallpaper-preview wallpaper-oceano-profundo"></div>
                        <span>🌊 Oceano Profundo</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('floresta-encantada')" data-bg="floresta-encantada">
                        <div class="wallpaper-preview wallpaper-floresta-encantada"></div>
                        <span>🌲 Floresta Encantada</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('ametista')" data-bg="ametista">
                        <div class="wallpaper-preview wallpaper-ametista"></div>
                        <span>💜 Ametista</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('ouro-alquimico')" data-bg="ouro-alquimico">
                        <div class="wallpaper-preview wallpaper-ouro-alquimico"></div>
                        <span>🟡 Ouro Alquímico</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('cristal-azul')" data-bg="cristal-azul">
                        <div class="wallpaper-preview wallpaper-cristal-azul"></div>
                        <span>💎 Cristal Azul</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('nebulosa-rosa')" data-bg="nebulosa-rosa">
                        <div class="wallpaper-preview wallpaper-nebulosa-rosa"></div>
                        <span>🌸 Nebulosa Rosa</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('terra-mistica')" data-bg="terra-mistica">
                        <div class="wallpaper-preview wallpaper-terra-mistica"></div>
                        <span>🟤 Terra Mística</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('aurora-boreal')" data-bg="aurora-boreal">
                        <div class="wallpaper-preview wallpaper-aurora-boreal"></div>
                        <span>❄️ Aurora Boreal</span>
                    </div>
                    <div class="wallpaper-option" onclick="changeWallpaper('vinho-gotico')" data-bg="vinho-gotico">
                        <div class="wallpaper-preview wallpaper-vinho-gotico"></div>
                        <span>🍷 Vinho Gótico</span>
                    </div>
                </div>
           <!-- Barra de Tarefas Whimsigoth -->
        <div class="taskbar">
            <!-- Botão Iniciar -->
            <div class="btn start" id="startButton" onclick="toggleStartPanel()">
                🌟 Iniciar
            </div>

            <!-- Dock de Aplicações -->
            <div class="dock" id="dock">
                <!-- Ícones das aplicações abertas aparecerão aqui -->
            </div>

            <!-- Bandeja do Sistema -->
            <div class="tray">
                <!-- Anel do Dia -->
                <div class="day-ring" id="dayRing" title="Regência da Hora Planetária">
                    <div class="day-ring-bg">
                        <div class="day-ring-inner" id="planetarySymbol">☉</div>
                        <div class="risk-indicator risk-low" id="riskIndicator"></div>
                    </div>
                </div>

                  <!-- Chips Astrológicos Aprimorados -->
            <div class="astro-chips-container">
                <div class="astro-chip" id="moonPhaseChip" data-tooltip="Lua Minguante - Tempo de liberação e limpeza">
                    🌖 Minguante
                    <div class="chip-indicator"></div>
                </div>
                
                <div class="astro-chip critical" id="mercuryRetroChip" data-tooltip="Mercúrio Retrógrado até 15/09 - Revise comunicações">
                    ☿ R
                    <div class="chip-indicator critical"></div>
                </div>
                
                <div class="astro-chip" id="vocChip" data-tooltip="Lua Fora de Curso - Evite decisões importantes até 23:45">
                    VOC até 23:45
                    <div class="chip-indicator"></div>
                </div>
            </div>          </div>
                </div>

                <div class="sep"></div>

                <!-- Controles AFÁST! -->
                <div class="afast-controls">
                    <div class="afast-btn" id="afastToggle" title="Ligar/Desligar AFÁST!">
                        🛡️
                    </div>
                    <div class="afast-btn" id="dndToggle" title="Não Perturbar">
                        🔕
                    </div>
                    <div class="connection-indicator">
                        <div class="badge-dot badge-green" id="connectionStatus"></div>
                        <span>AstroMágick</span>
                    </div>
                </div>

                <div class="sep"></div>

                <!-- Ícone de Volume (estilo Windows ME) -->
                <div class="volume-icon" id="volumeIcon" title="Controles de Volume">
                    🔊
                </div>

                <div class="sep"></div>

                <!-- Relógio -->
                <div class="clock" id="clock" title="Clique para abrir Calendário Astrológico" onclick="toggleCalendarPanel()">
                    00:00
                </div>
            </div>
        </div>

        <!-- Painel do Menu Iniciar -->
        <div class="panel start" id="startPanel">
            <h3>🌟 Altar Digital</h3>
            <div class="grid" style="grid-template-columns: repeat(3, 1fr);">
                <div class="btn" onclick="openApp('astromagick')">🌙 AstroMágick</div>
                <div class="btn" onclick="openApp('aurora-player')">🎵 Aurora Player</div>
                <div class="btn" onclick="openApp('witch-tv')">📺 Witch.TV</div>
                <div class="btn" onclick="openApp('afast')">🗣️ AFÁST!</div>
                <div class="btn" onclick="openApp('tarot')">🔮 Tarô</div>
                <div class="btn" onclick="openApp('books')">📚 Livros</div>
            </div>
            <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid var(--borda); font-size: 0.9rem; color: var(--muted);">
                💫 "A magia está em suas mãos"
            </div>
        </div>

        <!-- Painel do Calendário Astrológico -->
        <div class="panel calendar" id="calendarPanel">
            <h3>📅 Calendário Astrológico</h3>
            <div class="cal-head">
                <button onclick="previousMonth()">‹</button>
                <span id="calendarMonth">Setembro 2025</span>
                <button onclick="nextMonth()">›</button>
            </div>
            <div class="cal-meta">
                <div>🌙 <strong>Fase Lunar:</strong> <span id="lunarPhase">Lua Crescente</span></div>
                <div>⭐ <strong>Hora Planetária:</strong> <span id="planetaryHour">☉ Sol</span></div>
                <div>🔮 <strong>Energia do Dia:</strong> <span id="dayEnergy">Expansão e Criatividade</span></div>
            </div>
            <div class="cal-days" id="calendarDays">
                <!-- Dias serão gerados dinamicamente -->
            </div>
        </div>iv>

    <!-- Toast de Notificação -->
    <div class="toast" id="notificationToast">
        <div class="title" id="toastTitle">AFÁST! Sistema</div>
        <div class="meta" id="toastMessage">Mensagem de notificação</div>
    </div>

    <!-- Popup de Volume (estilo Windows ME) -->
    <div class="volume-popup" id="volumePopup">
        <div class="volume-popup-title">🔊 Controles de Volume</div>
        
        <div class="volume-control">
            <div class="volume-label">
                <span>🎤 AFÁST! (Narradora)</span>
                <span class="volume-value" id="afastVolumeValue">75%</span>
            </div>
            <input type="range" class="volume-slider" id="afastVolumeSlider" min="0" max="100" value="75">
        </div>
        
        <div class="volume-control">
            <div class="volume-label">
                <span>🔊 Sistema</span>
                <span class="volume-value" id="systemVolumeValue">50%</span>
            </div>
            <input type="range" class="volume-slider" id="systemVolumeSlider" min="0" max="100" value="50">
        </div>
        
        <div class="volume-test-buttons">
            <button class="volume-test-btn" id="testAfastBtn">Testar AFÁST!</button>
            <button class="volume-test-btn" id="testSystemBtn">Som Sistema</button>
        </div>
    </div>

       <!-- Centro Rápido Avançado -->
    <div class="quick-center" id="quickCenter">
        <div class="quick-center-title">⚡ Centro Rápido</div>
        
        <!-- Toggles Grandes -->
        <div class="quick-toggles">
            <div class="quick-toggle active" id="afastQuickToggle" data-toggle="afast">
                <div class="quick-toggle-icon">🛡️</div>
                <div class="quick-toggle-title">AFÁST!</div>
                <div class="quick-toggle-subtitle">Assistente ativo</div>
            </div>
            
            <div class="quick-toggle" id="dndQuickToggle" data-toggle="dnd">
                <div class="quick-toggle-icon">🔕</div>
                <div class="quick-toggle-title">Não Perturbar</div>
                <div class="quick-toggle-subtitle">Silenciar alertas</div>
            </div>
            
            <div class="quick-toggle" id="quietQuickToggle" data-toggle="quiet">
                <div class="quick-toggle-icon">🌙</div>
                <div class="quick-toggle-title">Horas Silenciosas</div>
                <div class="quick-toggle-subtitle">Modo noturno</div>
            </div>
            
            <div class="quick-toggle active" id="themeQuickToggle" data-toggle="theme">
                <div class="quick-toggle-icon">☉</div>
                <div class="quick-toggle-title">Tema Solar</div>
                <div class="quick-toggle-subtitle">Planeta do dia</div>
            </div>
        </div>
        
        <!-- Mixer 4 Canais -->
        <div class="advanced-mixer">
            <div class="mixer-title">
                🎛️ Mixer de Áudio
            </div>
            
            <div class="mixer-channels">
                <div class="mixer-channel">
                    <div class="mixer-channel-label">
                        <span class="mixer-channel-icon">🎤</span>
                        <span>Narradora</span>
                        <span class="mixer-channel-value" id="narratorValue">75%</span>
                    </div>
                    <input type="range" class="mixer-channel-slider" id="narratorSlider" min="0" max="100" value="75">
                </div>
                
                <div class="mixer-channel">
                    <div class="mixer-channel-label">
                        <span class="mixer-channel-icon">🎵</span>
                        <span>Música</span>
                        <span class="mixer-channel-value" id="musicValue">60%</span>
                    </div>
                    <input type="range" class="mixer-channel-slider" id="musicSlider" min="0" max="100" value="60">
                </div>
                
                <div class="mixer-channel">
                    <div class="mixer-channel-label">
                        <span class="mixer-channel-icon">🔊</span>
                        <span>SFX UI</span>
                        <span class="mixer-channel-value" id="sfxValue">50%</span>
                    </div>
                    <input type="range" class="mixer-channel-slider" id="sfxSlider" min="0" max="100" value="50">
                </div>
                
                <div class="mixer-channel">
                    <div class="mixer-channel-label">
                        <span class="mixer-channel-icon">🔮</span>
                        <span>Rituais</span>
                        <span class="mixer-channel-value" id="ritualsValue">40%</span>
                    </div>
                    <input type="range" class="mixer-channel-slider" id="ritualsSlider" min="0" max="100" value="40">
                </div>
            </div>
            
            <div class="ducking-indicator" id="duckingIndicator">
                🎤 Ducking ativo - Música reduzida durante narração
            </div>
        </div>
    </div>div>
        </div>
        
        <div class="mixer-panel">
            <div class="mixer-title">🎛️ Mixer de Áudio</div>
            <div class="mixer-channels">
                <div class="mixer-channel">
                    <div class="mixer-channel-label">
                        🎤 <span>Narradora (AFÁST!)</span>
                    </div>
                    <input type="range" id="narratorVolume" min="0" max="100" value="75">
                </div>
                <div class="mixer-channel">
                    <div class="mixer-channel-label">
                        🎵 <span>Música</span>
                    </div>
                    <input type="range" id="musicVolume" min="0" max="100" value="60">
                </div>
                <div class="mixer-channel">
                    <div class="mixer-channel-label">
                        🔊 <span>SFX UI</span>
                    </div>
                    <input type="range" id="sfxVolume" min="0" max="100" value="40">
                </div>
                <div class="mixer-channel">
                    <div class="mixer-channel-label">
                        🕯️ <span>Rituais</span>
                    </div>
                    <input type="range" id="ritualVolume" min="0" max="100" value="50">
                </div>
            </div>
        </div>
    <!-- Popovers Astrológicos Avançados -->
    <div class="astro-popover-advanced" id="advancedMercuryPopover">
        <div class="popover-header">
            <div class="popover-title">
                ☿ Mercúrio Retrógrado
            </div>
            <button class="popover-close" onclick="closeAdvancedPopover('advancedMercuryPopover')">✕</button>
        </div>
        
        <!-- Timeline Interativa -->
        <div class="astro-timeline">
            <div class="timeline-header">
                <div class="timeline-title">📅 Próximos Eventos</div>
                <div class="timeline-nav">
                    <button class="timeline-nav-btn" onclick="navigateTimeline(-1)">‹</button>
                    <button class="timeline-nav-btn" onclick="navigateTimeline(1)">›</button>
                </div>
            </div>
            
            <div class="timeline-container">
                <div class="timeline-track">
                    <div class="timeline-event">
                        <div class="timeline-marker critical"></div>
                        <div class="timeline-date">Hoje</div>
                        <div class="timeline-description">☿ Retrógrado Ativo</div>
                    </div>
                    
                    <div class="timeline-event">
                        <div class="timeline-marker"></div>
                        <div class="timeline-date">15/09</div>
                        <div class="timeline-description">☿ Mercúrio Direto</div>
                    </div>
                    
                    <div class="timeline-event">
                        <div class="timeline-marker"></div>
                        <div class="timeline-date">04/10</div>
                        <div class="timeline-description">☿ Próximo Retrógrado</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ações Rápidas -->
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="createReminder('mercury')">
                <span class="quick-action-icon">⏰</span>
                Criar Lembrete
            </button>
            
            <button class="quick-action-btn" onclick="shareEvent('mercury')">
                <span class="quick-action-icon">📤</span>
                Compartilhar
            </button>
            
            <button class="quick-action-btn" onclick="exportToCalendar('mercury')">
                <span class="quick-action-icon">📅</span>
                Adicionar ao Calendário
            </button>
            
            <button class="quick-action-btn" onclick="setCustomAlert('mercury')">
                <span class="quick-action-icon">🔔</span>
                Alerta Personalizado
            </button>
        </div>
        
        <!-- Visualizações Avançadas -->
        <div class="astro-visualization">
            <div class="viz-title">
                📊 Intensidade Astrológica
            </div>
            
            <div class="intensity-bar">
                <div class="intensity-label">Comunicação</div>
                <div class="intensity-track">
                    <div class="intensity-fill high"></div>
                </div>
                <div class="intensity-value">85%</div>
            </div>
            
            <div class="intensity-bar">
                <div class="intensity-label">Tecnologia</div>
                <div class="intensity-track">
                    <div class="intensity-fill high"></div>
                </div>
                <div class="intensity-value">90%</div>
            </div>
            
            <div class="intensity-bar">
                <div class="intensity-label">Viagens</div>
                <div class="intensity-track">
                    <div class="intensity-fill medium"></div>
                </div>
                <div class="intensity-value">70%</div>
            </div>
            
            <div class="intensity-bar">
                <div class="intensity-label">Contratos</div>
                <div class="intensity-track">
                    <div class="intensity-fill high"></div>
                </div>
                <div class="intensity-value">95%</div>
            </div>
        </div>
        
        <!-- Sistema de Notificações -->
        <div class="notification-settings">
            <div class="notification-title">
                🔔 Configurar Alertas
            </div>
            
            <div class="notification-options">
                <div class="notification-option" onclick="toggleNotification(this, '1h')">
                    <div class="notification-checkbox"></div>
                    <div class="notification-label">1 hora antes</div>
                </div>
                
                <div class="notification-option" onclick="toggleNotification(this, '6h')">
                    <div class="notification-checkbox checked"></div>
                    <div class="notification-label">6 horas antes</div>
                </div>
                
                <div class="notification-option" onclick="toggleNotification(this, '1d')">
                    <div class="notification-checkbox checked"></div>
                    <div class="notification-label">1 dia antes</div>
                </div>
                
                <div class="notification-option" onclick="toggleNotification(this, 'custom')">
                    <div class="notification-checkbox"></div>
                    <div class="notification-label">Personalizado</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Popover Avançado para Lua -->
    <div class="astro-popover-advanced" id="advancedMoonPopover">
        <div class="popover-header">
            <div class="popover-title">
                🌖 Lua Minguante
            </div>
            <button class="popover-close" onclick="closeAdvancedPopover('advancedMoonPopover')">✕</button>
        </div>
        
        <div class="astro-timeline">
            <div class="timeline-header">
                <div class="timeline-title">🌙 Fases Lunares</div>
            </div>
            
            <div class="timeline-container">
                <div class="timeline-track">
                    <div class="timeline-event">
                        <div class="timeline-marker"></div>
                        <div class="timeline-date">Hoje</div>
                        <div class="timeline-description">🌖 Minguante</div>
                    </div>
                    
                    <div class="timeline-event">
                        <div class="timeline-marker"></div>
                        <div class="timeline-date">15/09</div>
                        <div class="timeline-description">🌗 Quarto Minguante</div>
                    </div>
                    
                    <div class="timeline-event">
                        <div class="timeline-marker"></div>
                        <div class="timeline-date">28/09</div>
                        <div class="timeline-description">🌑 Lua Nova</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="astro-visualization">
            <div class="viz-title">
                🌙 Energia Lunar
            </div>
            
            <div class="intensity-bar">
                <div class="intensity-label">Liberação</div>
                <div class="intensity-track">
                    <div class="intensity-fill high"></div>
                </div>
                <div class="intensity-value">88%</div>
            </div>
            
            <div class="intensity-bar">
                <div class="intensity-label">Intuição</div>
                <div class="intensity-track">
                    <div class="intensity-fill medium"></div>
                </div>
                <div class="intensity-value">65%</div>
            </div>
            
            <div class="intensity-bar">
                <div class="intensity-label">Limpeza</div>
                <div class="intensity-track">
                    <div class="intensity-fill high"></div>
                </div>
                <div class="intensity-value">92%</div>
            </div>
        </div>
    </div>
    <div class="command-palette" id="commandPalette">
        <input type="text" class="command-input" id="commandInput" placeholder="Digite um comando... (/banir, /ver lua, /voc)">
        <div class="command-results" id="commandResults">
            <!-- Resultados da pesquisa aparecerão aqui -->
        </div>
    </div>

    <!-- Popover Universal -->
    <div class="popover" id="universalPopover">
        <div class="popover-title" id="popoverTitle">Título</div>
        <div class="popover-content" id="popoverContent">
            <div class="popover-events" id="popoverEvents">
                <!-- Eventos aparecerão aqui -->
            </div>
            <button class="export-ics-btn" id="exportIcsBtn">📅 Exportar para Calendário (.ics)</button>
        </div>
    </div>
    </div>

    <!-- Calendário Astrológico -->
    <div class="astro-calendar" id="astro-calendar">
        <div class="calendar-header">
            Calendário Astrológico - <span id="calendar-month">Setembro 2025</span>
        </div>
        <div class="calendar-content">
            <div class="planetary-hour-info" id="planetary-hour-info">
                <strong>Hora Planetária Atual:</strong><br>
                <span id="current-planetary-hour">☉ Sol - Hora da Vitalidade</span>
            </div>
            <div class="calendar-grid" id="calendar-grid">
                <!-- Dias da semana -->
                <div style="font-weight: bold; background: #d0d0d0;">Dom</div>
                <div style="font-weight: bold; background: #d0d0d0;">Seg</div>
                <div style="font-weight: bold; background: #d0d0d0;">Ter</div>
                <div style="font-weight: bold; background: #d0d0d0;">Qua</div>
                <div style="font-weight: bold; background: #d0d0d0;">Qui</div>
                <div style="font-weight: bold; background: #d0d0d0;">Sex</div>
                <div style="font-weight: bold; background: #d0d0d0;">Sáb</div>
                <!-- Dias do mês serão gerados dinamicamente -->
            </div>
            <div id="astro-events">
                <strong>Eventos Astrológicos:</strong><br>
                <small>🌑 Lua Nova: 28/09<br>
                ☿ Mercúrio Retrógrado: 04/10<br>
                🌕 Lua Cheia: 14/10</small>
            </div>
        </div>
    </div>

    <!-- Janela AstroMágick Expandida -->
    <div class="window" id="astromagick-window">
        <div class="window-header">
            <span class="window-title">🌙 AstroMágick - Portal Astrológico Completo</span>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('astromagick-window')">_</button>
                <button class="window-btn" onclick="closeWindow('astromagick-window')">×</button>
            </div>
        </div>
        <div class="window-content">
            <!-- Sistema de Abas -->
            <div class="astro-tabs">
                <button class="astro-tab active" onclick="switchAstroTab('positions')">📊 Posições</button>
                <button class="astro-tab" onclick="switchAstroTab('lunar')">🌙 Lunar</button>
                <button class="astro-tab" onclick="switchAstroTab('transits')">⚡ Trânsitos</button>
                <button class="astro-tab" onclick="switchAstroTab('aspects')">🔮 Aspectos</button>
                <button class="astro-tab" onclick="switchAstroTab('alerts')">🚨 Alertas</button>
            </div>

            <!-- Conteúdo das Abas -->
            <div class="astro-tab-content">
                <!-- Aba Posições -->
                <div id="positions-tab" class="astro-tab-panel active">
                    <h3>📊 Posições Planetárias</h3>
                    <div class="planets-grid">
                        <div class="planet-item">☉ <strong>Sol:</strong> Virgem 18°23'</div>
                        <div class="planet-item">☽ <strong>Lua:</strong> Peixes 12°45'</div>
                        <div class="planet-item">☿ <strong>Mercúrio:</strong> Virgem 25°12'</div>
                        <div class="planet-item">♀ <strong>Vênus:</strong> Libra 3°08'</div>
                        <div class="planet-item">♂ <strong>Marte:</strong> Câncer 28°33'</div>
                        <div class="planet-item">♃ <strong>Júpiter:</strong> Gêmeos 15°27'</div>
                        <div class="planet-item">♄ <strong>Saturno:</strong> Peixes 19°41'</div>
                        <div class="planet-item">♅ <strong>Urano:</strong> Touro 27°15'</div>
                        <div class="planet-item">♆ <strong>Netuno:</strong> Peixes 29°52'</div>
                        <div class="planet-item">♇ <strong>Plutão:</strong> Capricórnio 29°38'</div>
                    </div>
                </div>

                <!-- Aba Lunar -->
                <div id="lunar-tab" class="astro-tab-panel">
                    <h3>🌙 Informações Lunares</h3>
                    <div class="lunar-info">
                        <div class="lunar-phase">
                            <h4>Fase Atual</h4>
                            <div class="phase-display">🌖 <strong>Gibosa Minguante</strong></div>
                            <div class="illumination">87% iluminada</div>
                        </div>
                        <div class="lunar-calendar">
                            <h4>Próximas Fases</h4>
                            <div class="phase-item">🌗 <strong>Quarto Minguante:</strong> 15/09 às 22:33</div>
                            <div class="phase-item">🌑 <strong>Lua Nova:</strong> 28/09 às 20:53</div>
                            <div class="phase-item">🌓 <strong>Quarto Crescente:</strong> 06/10 às 15:47</div>
                            <div class="phase-item">🌕 <strong>Lua Cheia:</strong> 14/10 às 18:08</div>
                        </div>
                        <div class="lunar-energy">
                            <h4>Energia Lunar</h4>
                            <p><strong>"Liberação e Purificação"</strong></p>
                            <p>Momento ideal para soltar o que não serve mais e fazer limpezas energéticas.</p>
                        </div>
                    </div>
                </div>

                <!-- Aba Trânsitos -->
                <div id="transits-tab" class="astro-tab-panel">
                    <h3>⚡ Trânsitos Importantes</h3>
                    <div class="transits-list">
                        <div class="transit-item favorable">☿ <strong>Mercúrio em Virgem</strong> - Comunicação precisa e detalhista (até 26/09)</div>
                        <div class="transit-item attention">♀ <strong>Vênus entrando em Libra</strong> - Harmonia nos relacionamentos (11/09 a 07/10)</div>
                        <div class="transit-item favorable">♂ <strong>Marte em Câncer</strong> - Energia emocional e proteção familiar</div>
                        <div class="transit-item attention">♃ <strong>Júpiter em Gêmeos</strong> - Expansão através do conhecimento</div>
                        <div class="transit-item favorable">♄ <strong>Saturno em Peixes</strong> - Estruturação da espiritualidade</div>
                    </div>
                </div>

                <!-- Aba Aspectos -->
                <div id="aspects-tab" class="astro-tab-panel">
                    <h3>🔮 Aspectos Astrológicos</h3>
                    <div class="aspects-list">
                        <div class="aspect-item harmonious">△ <strong>Sol trígono Júpiter</strong> - Otimismo e expansão, energia positiva para crescimento</div>
                        <div class="aspect-item tense">□ <strong>Marte quadratura Saturno</strong> - Tensão entre ação e disciplina, paciência necessária</div>
                        <div class="aspect-item harmonious">△ <strong>Lua trígono Urano</strong> - Intuição e inovação, insights revolucionários</div>
                        <div class="aspect-item tense">☍ <strong>Mercúrio oposição Netuno</strong> - Confusão mental possível, clareza necessária</div>
                        <div class="aspect-item neutral">⚹ <strong>Vênus sextil Netuno</strong> - Inspiração artística e romântica, criatividade elevada</div>
                    </div>
                </div>

                <!-- Aba Alertas -->
                <div id="alerts-tab" class="astro-tab-panel">
                    <h3>🚨 Sistema de Alertas Astrológicos</h3>
                    <div class="alerts-section">
                        <div class="alert-item critical">🌑 <strong>ECLIPSE LUNAR</strong> - Próximo eclipse em 28/09, prepare-se para mudanças importantes</div>
                        <div class="alert-item attention">☿ <strong>MERCÚRIO RETRÓGRADO</strong> - Aproximando-se em 04/10, cuidado com comunicações e tecnologia</div>
                        <div class="alert-item attention">♀ <strong>VÊNUS RETRÓGRADA</strong> - Revisão de relacionamentos e valores (12/10 a 21/11)</div>
                        <div class="alert-item favorable">🌕 <strong>LUA CHEIA FAVORÁVEL</strong> - 14/10 em Áries, energia poderosa para novos projetos</div>
                    </div>
                    
                    <div class="alert-settings">
                        <h4>⚙️ Configurações de Alerta AFÁST!</h4>
                        <div class="alert-config">
                            <label><input type="checkbox" checked> Notificações AFÁST!</label>
                        </div>
                        <div class="setting-item">
                            <label><input type="checkbox" checked> Alertas de Retrogradação</label>
                        </div>
                        <div class="setting-item">
                            <label><input type="checkbox" checked> Eclipses e Eventos Raros</label>
                        </div>
                        <div class="setting-item">
                            <label><input type="checkbox"> Aspectos Diários</label>
                        </div>
                        <div class="setting-item">
                            <label><input type="checkbox"> Mudanças de Signo</label>
                        </div>
                        <div class="setting-item">
                            <label><input type="checkbox"> Fases Lunares</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botões de Ação -->
            <div class="astro-actions">
                <button class="astro-btn primary" onclick="openCompleteApp()">🔮 Abrir Aplicação Completa</button>
                <button class="astro-btn secondary" onclick="updateAstroData()">🔄 Atualizar Dados</button>
            </div>
        </div>
    </div>

    <!-- Janela Aurora Player -->
    <div class="window aurora-player" id="aurora-player-window">
        <div class="window-header">
            <span class="window-title">🎵 Aurora Player - Reprodutor Místico</span>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('aurora-player-window')">_</button>
                <button class="window-btn" onclick="closeWindow('aurora-player-window')">×</button>
            </div>
        </div>
        <div class="player-content">
            <!-- Display do Player -->
            <div class="player-display">
                <div class="track-info" id="current-track">♪ Aurora Sagrada - Moonlight Serenade ♪</div>
                <div class="time-info" id="track-time">00:00 / 03:45</div>
            </div>

            <!-- Controles -->
            <div class="player-controls">
                <button class="control-btn" id="prev-btn" onclick="auroraPlayer.previousTrack()">⏮</button>
                <button class="control-btn" id="play-btn" onclick="auroraPlayer.togglePlay()">▶</button>
                <button class="control-btn" id="next-btn" onclick="auroraPlayer.nextTrack()">⏭</button>
                <button class="control-btn" id="shuffle-btn" onclick="auroraPlayer.toggleShuffle()">🔀</button>
                <button class="control-btn" id="repeat-btn" onclick="auroraPlayer.toggleRepeat()">🔁</button>
            </div>

            <!-- Volume -->
            <div class="volume-section">
                <span>🔊</span>
                <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="75">
                <span id="volume-display">75%</span>
            </div>

            <!-- Playlist -->
            <div class="playlist-section">
                <h4 style="margin: 0 0 10px 0; font-size: 12px;">📜 Playlist Mística</h4>
                <div id="playlist-container">
                    <div class="playlist-item active" data-track="0">🌙 Moonlight Serenade - Aurora Sagrada</div>
                    <div class="playlist-item" data-track="1">⭐ Stellar Dreams - Aurora Sagrada</div>
                    <div class="playlist-item" data-track="2">💎 Crystal Meditation - Aurora Sagrada</div>
                    <div class="playlist-item" data-track="3">🌲 Forest Whispers - Aurora Sagrada</div>
                    <div class="playlist-item" data-track="4">🌌 Cosmic Dance - Aurora Sagrada</div>
                    <div class="playlist-item" data-track="5">🔥 Phoenix Rising - Aurora Sagrada</div>
                </div>
            </div>

            <!-- Painel Administrativo -->
            <div class="admin-section">
                <h4 style="margin: 0 0 10px 0; font-size: 12px;">🔧 Painel Administrativo</h4>
                <button class="admin-btn" onclick="auroraPlayer.addTrack()">➕ Adicionar</button>
                <button class="admin-btn" onclick="auroraPlayer.removeTrack()">➖ Remover</button>
                <button class="admin-btn" onclick="auroraPlayer.editPlaylist()">✏️ Editar</button>
                <button class="admin-btn" onclick="auroraPlayer.savePlaylist()">💾 Salvar</button>
            </div>
        </div>
    </div>

    <!-- Janela Witch.TV -->
    <div class="window witch-tv" id="witch-tv-window">
        <div class="window-header">
            <span class="window-title">📺 Witch.TV - Streaming Místico</span>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('witch-tv-window')">_</button>
                <button class="window-btn" onclick="closeWindow('witch-tv-window')">×</button>
            </div>
        </div>
        <div class="window-content">
            <div class="tv-screen" id="tv-screen">
                <div class="tv-static"></div>
                <div class="tv-content" id="tv-content">
                    🌙 Canal Lunar - Meditações Noturnas 🌙
                </div>
            </div>
            <div class="channel-list">
                <h4 style="margin: 0 0 10px 0; font-size: 12px;">📡 Canais Místicos</h4>
                <div class="channel-item active" data-channel="0">
                    <span>🌙 Canal Lunar</span>
                    <span>AO VIVO</span>
                </div>
                <div class="channel-item" data-channel="1">
                    <span>🔮 Oráculos & Profecias</span>
                    <span>24h</span>
                </div>
                <div class="channel-item" data-channel="2">
                    <span>🌿 Herbalismo Sagrado</span>
                    <span>HD</span>
                </div>
                <div class="channel-item" data-channel="3">
                    <span>⭐ Astrologia Avançada</span>
                    <span>PREMIUM</span>
                </div>
                <div class="channel-item" data-channel="4">
                    <span>🧙‍♀️ Escola de Magia</span>
                    <span>NOVO</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Janela Tarô -->
    <div class="window tarot-app" id="tarot-window">
        <div class="window-header">
            <span class="window-title">🔮 Tarô Místico - Consulta das Cartas</span>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('tarot-window')">_</button>
                <button class="window-btn" onclick="closeWindow('tarot-window')">×</button>
            </div>
        </div>
        <div class="window-content">
            <div class="tarot-spread" id="tarot-spread">
                <div class="tarot-card" data-card="0">🂠</div>
                <div class="tarot-card" data-card="1">🂠</div>
                <div class="tarot-card" data-card="2">🂠</div>
            </div>
            <div class="tarot-reading" id="tarot-reading">
                <h4>🔮 Consulta de Três Cartas</h4>
                <p>Clique nas cartas para revelar sua leitura sobre Passado, Presente e Futuro.</p>
                <p><strong>Concentre-se em sua pergunta...</strong></p>
            </div>
        </div>
    </div>

    <!-- Janela Livros Interativos -->
    <div class="window books-app" id="books-window">
        <div class="window-header">
            <span class="window-title">📚 Biblioteca Mística - Livros Interativos</span>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('books-window')">_</button>
                <button class="window-btn" onclick="closeWindow('books-window')">×</button>
            </div>
        </div>
        <div class="window-content">
            <div class="book-shelf">
                <div class="book-spine" data-book="0">Grimório das Sombras</div>
                <div class="book-spine" data-book="1">Herbário Sagrado</div>
                <div class="book-spine" data-book="2">Cristais & Energias</div>
                <div class="book-spine" data-book="3">Rituais Lunares</div>
                <div class="book-spine" data-book="4">Alquimia Moderna</div>
                <div class="book-spine" data-book="5">Runas Antigas</div>
                <div class="book-spine" data-book="6">Chakras & Auras</div>
                <div class="book-spine" data-book="7">Magia Elemental</div>
            </div>
            <div class="book-content" id="book-content">
                <h4>📖 Biblioteca Mística</h4>
                <p>Bem-vindo à biblioteca de conhecimentos esotéricos!</p>
                <p>Clique em qualquer livro da estante para começar sua jornada de aprendizado místico.</p>
                <p><em>Cada livro contém sabedoria ancestral e práticas modernas.</em></p>
            </div>
        </div>
    </div>

    <!-- Janela AFAST! -->
    <div class="window afast-app" id="afast-window">
        <div class="window-header">
            <span class="window-title">🗣️ AFAST! - Assistente de Fala Avançado</span>
            <div class="window-controls">
                <button class="window-btn" onclick="minimizeWindow('afast-window')">_</button>
                <button class="window-btn" onclick="closeWindow('afast-window')">×</button>
            </div>
        </div>
        <div class="window-content">
            <div class="speech-area" id="speech-area">
                > AFÁST! v2.0 - Sistema de Reconhecimento de Voz Iniciado
                > Bem vindo ao AFÁST!
                > Aguardando comando de voz...
                > Digite 'help' para ver comandos disponíveis
            </div>
            <div class="speech-controls">
                <button class="speech-btn" id="record-btn" onclick="afastApp.toggleRecording()">🎤 Gravar</button>
                <button class="speech-btn" onclick="afastApp.playback()">🔊 Reproduzir</button>
                <button class="speech-btn" onclick="afastApp.clearLog()">🗑️ Limpar</button>
                <button class="speech-btn" onclick="afastApp.showHelp()">❓ Ajuda</button>
            </div>
        </div>
    </div>

    <script>
        // === NOTIFICATION CONTROLLER PARA AFÁST! ===
        class NotificationController {
            constructor() {
                this.enabled = true;
                this.doNotDisturb = false;
                this.connected = false;
                this.lastEvents = new Map();
                this.cooldowns = new Map();
                this.categoryLimits = {
                    'moon-phase': 60000,      // 1 minuto
                    'planet-ingress': 300000, // 5 minutos
                    'retrograde': 3600000,    // 1 hora
                    'void-of-course': 1800000, // 30 minutos
                    'eclipse': 86400000,      // 24 horas
                    'aspect': 600000          // 10 minutos
                };
                this.initializeControls();
            }

            initializeControls() {
                const afastToggle = document.getElementById('afastToggle');
                const dndToggle = document.getElementById('dndToggle');
                const connectionStatus = document.getElementById('connectionStatus');

                if (afastToggle) afastToggle.addEventListener('click', () => this.toggleEnabled());
                if (dndToggle) dndToggle.addEventListener('click', () => this.toggleDoNotDisturb());

                this.updateUI();
            }

            toggleEnabled() {
                this.enabled = !this.enabled;
                this.updateUI();
                this.showToast(
                    'AFÁST! Sistema',
                    `Sistema ${this.enabled ? 'ATIVADO' : 'DESATIVADO'}`,
                    'system'
                );
            }

            toggleDoNotDisturb() {
                this.doNotDisturb = !this.doNotDisturb;
                this.updateUI();
                this.showToast(
                    'AFÁST! Sistema',
                    `Modo ${this.doNotDisturb ? 'NÃO PERTURBAR ativado' : 'NORMAL ativado'}`,
                    'system'
                );
            }

            updateUI() {
                const afastToggle = document.getElementById('afastToggle');
                const dndToggle = document.getElementById('dndToggle');
                const connectionStatus = document.getElementById('connectionStatus');

                if (afastToggle) afastToggle.classList.toggle('active', this.enabled);
                if (dndToggle) dndToggle.classList.toggle('active', this.doNotDisturb);
                
                if (connectionStatus) {
                    connectionStatus.className = `badge-dot ${this.connected ? 'badge-green' : 'badge-red'}`;
                }
            }

            connect() {
                this.connected = true;
                this.updateUI();
                this.showToast('AstroMágick', 'Conexão estabelecida', 'system');
            }

            disconnect() {
                this.connected = false;
                this.updateUI();
                this.showToast('AstroMágick', 'Conexão perdida', 'system');
            }

            canNotify(type, eventKey) {
                if (!this.enabled || !this.connected) return false;

                const now = Date.now();
                const cooldownKey = `${type}-${eventKey}`;
                const lastTime = this.cooldowns.get(cooldownKey) || 0;
                const limit = this.categoryLimits[type] || 60000;

                return (now - lastTime) >= limit;
            }

            emit(event) {
                const { type, severity, message, planet, phase, sign } = event;
                const eventKey = planet || phase || sign || 'general';

                if (!this.canNotify(type, eventKey)) return;

                this.cooldowns.set(`${type}-${eventKey}`, Date.now());

                let title = 'AFÁST! Alerta';
                let alertMessage = message;

                // Determinar tipo de alerta baseado na severidade
                if (severity === 'critical') {
                    title = 'UMA AMEAÇA FOI DETECTADA';
                } else if (type === 'moon-phase') {
                    title = 'MUDANÇA LUNAR DETECTADA';
                } else if (type === 'planet-ingress') {
                    title = 'INGRESSO PLANETÁRIO DETECTADO';
                } else if (type === 'aspect') {
                    title = 'ASPECTO ASTROLÓGICO ATIVO';
                }

                this.showToast(title, alertMessage, severity);
                this.playNotificationSound(severity);
            }

            showToast(title, message, severity = 'info') {
                const toast = document.getElementById('notificationToast');
                const toastTitle = document.getElementById('toastTitle');
                const toastMessage = document.getElementById('toastMessage');

                if (toast && toastTitle && toastMessage) {
                    toastTitle.textContent = title;
                    toastMessage.textContent = message;

                    toast.classList.add('show');

                    setTimeout(() => {
                        toast.classList.remove('show');
                    }, 4000);
                }
            }

            playNotificationSound(severity) {
                if (this.doNotDisturb) return;

                const afastVolumeEl = document.getElementById('afastVolume');
                const afastVolume = afastVolumeEl ? afastVolumeEl.value / 100 : 0.75;
                
                try {
                    const utterance = new SpeechSynthesisUtterance();
                    utterance.text = severity === 'critical' ? 'Uma ameaça foi detectada' : 'Alerta astrológico';
                    utterance.lang = 'pt-BR'; // Forçar português brasileiro
                    utterance.rate = 0.8;
                    utterance.pitch = 1.2;
                    utterance.volume = afastVolume;
                    
                    // Aguardar vozes carregarem
                    const speakWithVoice = () => {
                        const voices = speechSynthesis.getVoices();
                        
                        // Procurar voz feminina em português
                        const femaleVoice = voices.find(voice => 
                            (voice.lang.includes('pt') || voice.lang.includes('BR')) &&
                            (voice.name.toLowerCase().includes('female') || 
                             voice.name.toLowerCase().includes('feminino') ||
                             voice.name.toLowerCase().includes('woman') ||
                             voice.name.toLowerCase().includes('mulher') ||
                             voice.gender === 'female')
                        );
                        
                        // Se não encontrar feminina, usar qualquer voz em português
                        const portugueseVoice = femaleVoice || voices.find(voice => 
                            voice.lang.includes('pt') || voice.lang.includes('BR')
                        );
                        
                        if (portugueseVoice) {
                            utterance.voice = portugueseVoice;
                            console.log('Usando voz:', portugueseVoice.name, portugueseVoice.lang);
                        } else {
                            console.log('Nenhuma voz em português encontrada, usando padrão');
                        }
                        
                        speechSynthesis.speak(utterance);
                    };
                    
                    // Se as vozes já estão carregadas
                    if (speechSynthesis.getVoices().length > 0) {
                        speakWithVoice();
                    } else {
                        // Aguardar carregamento das vozes
                        speechSynthesis.addEventListener('voiceschanged', speakWithVoice, { once: true });
                    }
                    
                } catch (error) {
                    console.log('Erro na síntese de voz:', error);
                    // Fallback para beep sintético
                    this.playBeep(severity === 'critical' ? 800 : 600, afastVolume);
                }
            }

            playBeep(frequency, volume) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    oscillator.frequency.value = frequency;
                    oscillator.type = 'sine';
                    gainNode.gain.value = volume * 0.3;

                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                } catch (error) {
                    console.log('Audio não disponível');
                }
            }
        }

        // === INTEGRAÇÃO COM ASTROMÁGICK ===
        const ASTRO = new NotificationController();

        // Helpers para teste
        const TEST_AF = {
            retro: () => ASTRO.emit({
                type: 'retrograde',
                severity: 'critical',
                planet: 'Mercúrio',
                message: 'Mercúrio está retrógrado. Comunicação exige cautela.'
            }),
            voc: () => ASTRO.emit({
                type: 'void-of-course',
                severity: 'critical',
                message: 'Lua fora de curso até 23:45. Evite decisões importantes.'
            }),
            ingress: () => ASTRO.emit({
                type: 'planet-ingress',
                planet: 'Vênus',
                sign: 'Escorpião',
                message: 'Vênus ingressou em Escorpião. Paixões intensas emergem.'
            }),
            phase: () => ASTRO.emit({
                type: 'moon-phase',
                phase: 'Lua Cheia',
                message: 'Lua Cheia desperta revelações e plenitude.'
            })
        };

        // === SISTEMA PRINCIPAL ===
        class AuroraOS {
            constructor() {
                this.windows = new Map();
                this.zIndex = 1000;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateClock();
                this.updateAstroInfo();
                setInterval(() => this.updateClock(), 1000);
                
                // Conectar AFÁST! após inicialização
                setTimeout(() => {
                    ASTRO.connect();
                }, 2000);
            }

            setupEventListeners() {
                // Boot screen
                document.getElementById('boot-screen').addEventListener('click', () => this.startBoot());
                
                // Desktop icons
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    icon.addEventListener('dblclick', (e) => {
                        const app = e.currentTarget.dataset.app;
                        this.openApp(app);
                    });
                });
            }

            startBoot() {
                const bootScreen = document.getElementById('boot-screen');
                const desktop = document.getElementById('desktop');
                const progressFill = document.getElementById('boot-progress');
                const statusText = document.getElementById('boot-status');
                
                // Iniciar sons nostálgicos
                this.playBootSounds();
                
                // Mensagens de status do Windows ME
                const bootMessages = [
                    'Inicializando sistema...',
                    'Carregando drivers de dispositivo...',
                    'Verificando memória...',
                    'Inicializando serviços místicos...',
                    'Carregando interface gráfica...',
                    'Conectando com planos astrais...',
                    'Ativando proteções mágicas...',
                    'Sistema pronto!'
                ];
                
                let progress = 0;
                let messageIndex = 0;
                
                const bootInterval = setInterval(() => {
                    progress += Math.random() * 12 + 3; // Progresso mais realista
                    progressFill.style.width = Math.min(progress, 100) + '%';
                    
                    // Atualizar mensagem de status
                    if (messageIndex < bootMessages.length && progress > (messageIndex + 1) * 12.5) {
                        statusText.textContent = bootMessages[messageIndex];
                        messageIndex++;
                    }
                    
                    // Adicionar ruídos de TV antiga ocasionalmente
                    if (Math.random() < 0.2) {
                        this.playTVStatic();
                    }
                    
                    if (progress >= 100) {
                        clearInterval(bootInterval);
                        statusText.textContent = 'Sistema pronto!';
                        setTimeout(() => {
                            bootScreen.style.display = 'none';
                            desktop.classList.add('active');
                            // Som de conclusão
                            this.playBootComplete();
                            // Sistema MSN já inicializado globalmente
                            console.log('🌟 Desktop carregado com sucesso!');
                        }, 1500);
                    }
                }, 300);
            }
            
            // Função para reproduzir sons de boot nostálgicos
            playBootSounds() {
                // Som de dial-up da internet
                this.playDialUpSound();
                
                // Ruído de TV antiga
                setTimeout(() => this.playTVStatic(), 500);
                setTimeout(() => this.playTVStatic(), 1500);
                setTimeout(() => this.playTVStatic(), 2500);
            }
            
            // Som de dial-up sintetizado
            playDialUpSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // Sequência de tons do dial-up
                    const dialUpSequence = [
                        { freq: 2100, duration: 0.3 },
                        { freq: 1800, duration: 0.2 },
                        { freq: 1200, duration: 0.4 },
                        { freq: 2400, duration: 0.3 },
                        { freq: 1650, duration: 0.5 },
                        { freq: 300, duration: 0.2 },
                        { freq: 3000, duration: 0.3 }
                    ];
                    
                    let currentTime = audioContext.currentTime;
                    
                    dialUpSequence.forEach((tone, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(tone.freq, currentTime);
                        oscillator.type = 'square';
                        
                        gainNode.gain.setValueAtTime(0, currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.1, currentTime + 0.01);
                        gainNode.gain.linearRampToValueAtTime(0, currentTime + tone.duration);
                        
                        oscillator.start(currentTime);
                        oscillator.stop(currentTime + tone.duration);
                        
                        currentTime += tone.duration + 0.1;
                    });
                } catch (e) {
                    console.log('Áudio não suportado:', e);
                }
            }
            
            // Som de TV antiga com ruído
            playTVStatic() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const bufferSize = audioContext.sampleRate * 0.1; // 0.1 segundos
                    const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                    const data = buffer.getChannelData(0);
                    
                    // Gerar ruído branco
                    for (let i = 0; i < bufferSize; i++) {
                        data[i] = (Math.random() * 2 - 1) * 0.05; // Volume baixo
                    }
                    
                    const source = audioContext.createBufferSource();
                    const gainNode = audioContext.createGain();
                    
                    source.buffer = buffer;
                    source.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    gainNode.gain.setValueAtTime(0.02, audioContext.currentTime);
                    
                    source.start();
                } catch (e) {
                    console.log('Áudio não suportado:', e);
                }
            }
            
            // Som de conclusão do boot
            playBootComplete() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // Acorde de conclusão (estilo Windows)
                    const notes = [523.25, 659.25, 783.99, 1046.50]; // C5, E5, G5, C6
                    
                    notes.forEach((freq, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                        oscillator.type = 'sine';
                        
                        const startTime = audioContext.currentTime + (index * 0.1);
                        
                        gainNode.gain.setValueAtTime(0, startTime);
                        gainNode.gain.linearRampToValueAtTime(0.1, startTime + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + 1);
                        
                        oscillator.start(startTime);
                        oscillator.stop(startTime + 1);
                    });
                } catch (e) {
                    console.log('Áudio não suportado:', e);
                }
            }

            updateClock() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                document.getElementById('clock').textContent = timeString;
                
                // Atualizar hora planetária
                this.updatePlanetaryHour(now);
            }

            updatePlanetaryHour(now) {
                // Planetas e seus símbolos
                const planets = [
                    { name: 'Sol', symbol: '☉', description: 'Hora da Vitalidade e Liderança' },
                    { name: 'Vênus', symbol: '♀', description: 'Hora do Amor e Beleza' },
                    { name: 'Mercúrio', symbol: '☿', description: 'Hora da Comunicação' },
                    { name: 'Lua', symbol: '☽', description: 'Hora da Intuição' },
                    { name: 'Saturno', symbol: '♄', description: 'Hora da Disciplina' },
                    { name: 'Júpiter', symbol: '♃', description: 'Hora da Expansão' },
                    { name: 'Marte', symbol: '♂', description: 'Hora da Ação' }
                ];

                // Sequência planetária para dias da semana (começando domingo)
                const daySequences = [
                    [0, 1, 2, 3, 4, 5, 6], // Domingo - Sol
                    [3, 4, 5, 6, 0, 1, 2], // Segunda - Lua
                    [6, 0, 1, 2, 3, 4, 5], // Terça - Marte
                    [2, 3, 4, 5, 6, 0, 1], // Quarta - Mercúrio
                    [5, 6, 0, 1, 2, 3, 4], // Quinta - Júpiter
                    [1, 2, 3, 4, 5, 6, 0], // Sexta - Vênus
                    [4, 5, 6, 0, 1, 2, 3]  // Sábado - Saturno
                ];

                const dayOfWeek = now.getDay();
                const hour = now.getHours();
                
                // Calcular hora planetária (simplificado - cada planeta rege ~3.4 horas)
                const planetaryHourIndex = Math.floor(hour / 3.43) % 7;
                const sequence = daySequences[dayOfWeek];
                const currentPlanetIndex = sequence[planetaryHourIndex];
                const currentPlanet = planets[currentPlanetIndex];

                // Atualizar ícone na barra de tarefas
                const planetaryIcon = document.getElementById('planetary-icon');
                if (planetaryIcon) {
                    planetaryIcon.textContent = currentPlanet.symbol;
                    planetaryIcon.title = `${currentPlanet.name} - ${currentPlanet.description}`;
                }

                // Atualizar informação no calendário
                const planetaryHourInfo = document.getElementById('current-planetary-hour');
                if (planetaryHourInfo) {
                    planetaryHourInfo.textContent = `${currentPlanet.symbol} ${currentPlanet.name} - ${currentPlanet.description}`;
                }

                // Verificar se é uma hora desfavorável (Saturno ou Marte)
                if (currentPlanet.name === 'Saturno' || currentPlanet.name === 'Marte') {
                    // Enviar notificação de ameaça astrológica
                    if (window.msnSystem && Math.random() < 0.3) { // 30% de chance
                        setTimeout(() => {
                            window.msnSystem.showThreatAlert(
                                'Hora Planetária Desfavorável',
                                `Hora de ${currentPlanet.name} - Evite decisões importantes`
                            );
                        }, 1000);
                    }
                }
            }

            updateAstroInfo() {
                const now = new Date();
                
                // Data atual
                const currentDateEl = document.getElementById('current-date');
                if (currentDateEl) {
                    currentDateEl.textContent = now.toLocaleDateString('pt-BR');
                }
                
                // Signo solar (simplificado)
                const solarSign = this.getSolarSign(now);
                const solarSignEl = document.getElementById('solar-sign');
                if (solarSignEl) {
                    solarSignEl.textContent = solarSign;
                }
                
                // Fase lunar (simplificada)
                const lunarPhase = this.getLunarPhase(now);
                const lunarPhaseEl = document.getElementById('lunar-phase');
                if (lunarPhaseEl) {
                    lunarPhaseEl.textContent = lunarPhase;
                }
                
                // Deusa do dia
                const goddess = this.getGoddessOfDay(now);
                const goddessEl = document.getElementById('goddess-day');
                if (goddessEl) {
                    goddessEl.textContent = goddess;
                }
            }

            getSolarSign(date) {
                const month = date.getMonth() + 1;
                const day = date.getDate();
                
                const signs = [
                    'Capricórnio', 'Aquário', 'Peixes', 'Áries', 'Touro', 'Gêmeos',
                    'Câncer', 'Leão', 'Virgem', 'Libra', 'Escorpião', 'Sagitário'
                ];
                
                // Simplificado - baseado no mês
                return signs[month - 1];
            }

            getLunarPhase(date) {
                // Cálculo mais preciso da fase lunar
                // Baseado no ciclo lunar de 29.53 dias
                const lunarCycle = 29.53058867; // dias
                
                // Data de referência para lua nova conhecida (1 de janeiro de 2000)
                const referenceDate = new Date(2000, 0, 6, 18, 14); // 6 de janeiro de 2000, 18:14 UTC
                
                // Diferença em milissegundos
                const diffMs = date.getTime() - referenceDate.getTime();
                const diffDays = diffMs / (1000 * 60 * 60 * 24);
                
                // Posição no ciclo lunar (0-1)
                const lunarAge = (diffDays % lunarCycle) / lunarCycle;
                
                // Determinar fase baseada na idade lunar
                if (lunarAge < 0.0625) return 'Nova';
                else if (lunarAge < 0.1875) return 'Crescente';
                else if (lunarAge < 0.3125) return 'Quarto Crescente';
                else if (lunarAge < 0.4375) return 'Gibosa Crescente';
                else if (lunarAge < 0.5625) return 'Cheia';
                else if (lunarAge < 0.6875) return 'Gibosa Minguante';
                else if (lunarAge < 0.8125) return 'Quarto Minguante';
                else if (lunarAge < 0.9375) return 'Minguante';
                else return 'Nova';
            }

            getGoddessOfDay(date) {
                const goddesses = [
                    'Brigid', 'Ísis', 'Hécate', 'Atena', 'Artemis', 'Afrodite',
                    'Perséfone', 'Deméter', 'Freya', 'Diana', 'Cerridwen', 'Kali'
                ];
                const month = date.getMonth();
                return goddesses[month];
            }

            openApp(appName) {
                switch(appName) {
                    case 'astromagick':
                        this.openWindow('astromagick-window');
                        this.loadDetailedAstroInfo();
                        break;
                    case 'aurora-player':
                        this.openWindow('aurora-player-window');
                        if (!window.auroraPlayer) {
                            window.auroraPlayer = new AuroraPlayer();
                        }
                        break;
                    case 'witch-tv':
                        this.openWindow('witch-tv-window');
                        if (!window.witchTV) {
                            window.witchTV = new WitchTV();
                        }
                        break;
                    case 'afast':
                        this.openWindow('afast-window');
                        if (!window.afastApp) {
                            window.afastApp = new AFASTApp();
                        }
                        break;
                    case 'tarot':
                        this.openWindow('tarot-window');
                        if (!window.tarotApp) {
                            window.tarotApp = new TarotApp();
                        }
                        break;
                    case 'books':
                        this.openWindow('books-window');
                        if (!window.booksApp) {
                            window.booksApp = new BooksApp();
                        }
                        break;
                }
            }

            openWindow(windowId) {
                const window = document.getElementById(windowId);
                window.classList.add('active');
                window.style.zIndex = ++this.zIndex;
                
                // Posicionar janela
                window.style.left = '100px';
                window.style.top = '100px';
            }

            loadDetailedAstroInfo() {
                const content = document.getElementById('detailed-content');
                if (!content) {
                    console.log('Elemento detailed-content não encontrado');
                    return;
                }
                
                const now = new Date();
                
                content.innerHTML = `
                    <p><strong>Data:</strong> ${now.toLocaleDateString('pt-BR')}</p>
                    <p><strong>Signo Solar:</strong> ${this.getSolarSign(now)}</p>
                    <p><strong>Fase Lunar:</strong> ${this.getLunarPhase(now)}</p>
                    <p><strong>Deusa do Dia:</strong> ${this.getGoddessOfDay(now)}</p>
                    <br>
                    <p><strong>Energia do Dia:</strong> Transformação e renovação espiritual</p>
                    <p><strong>Cristais Recomendados:</strong> Ametista, Quartzo Rosa, Selenita</p>
                    <p><strong>Cores Místicas:</strong> Roxo, Dourado, Prateado</p>
                `;
            }
        }

        // === AURORA PLAYER ===
        class AuroraPlayer {
            constructor() {
                this.playlist = [
                    { title: "Moonlight Serenade", artist: "Aurora Sagrada", duration: "03:45" },
                    { title: "Stellar Dreams", artist: "Aurora Sagrada", duration: "04:12" },
                    { title: "Crystal Meditation", artist: "Aurora Sagrada", duration: "05:30" },
                    { title: "Forest Whispers", artist: "Aurora Sagrada", duration: "03:58" },
                    { title: "Cosmic Dance", artist: "Aurora Sagrada", duration: "04:25" },
                    { title: "Phoenix Rising", artist: "Aurora Sagrada", duration: "06:15" }
                ];
                this.currentTrack = 0;
                this.isPlaying = false;
                this.isShuffled = false;
                this.isRepeating = false;
                this.volume = 75;
                this.currentTime = 0;
                this.init();
            }

            init() {
                this.updateDisplay();
                this.setupEventListeners();
                this.startTimeSimulation();
            }

            setupEventListeners() {
                // Volume slider
                const volumeSlider = document.getElementById('volume-slider');
                if (volumeSlider) {
                    volumeSlider.addEventListener('input', (e) => {
                        this.volume = e.target.value;
                        document.getElementById('volume-display').textContent = this.volume + '%';
                    });
                }

                // Playlist items
                document.querySelectorAll('.playlist-item').forEach((item, index) => {
                    item.addEventListener('click', () => {
                        this.selectTrack(index);
                    });
                });
            }

            togglePlay() {
                this.isPlaying = !this.isPlaying;
                const playBtn = document.getElementById('play-btn');
                playBtn.textContent = this.isPlaying ? '⏸' : '▶';
                
                if (this.isPlaying) {
                    console.log('🎵 Reproduzindo:', this.playlist[this.currentTrack].title);
                } else {
                    console.log('⏸ Pausado');
                }
            }

            previousTrack() {
                this.currentTrack = this.currentTrack > 0 ? this.currentTrack - 1 : this.playlist.length - 1;
                this.updateDisplay();
                this.resetTime();
            }

            nextTrack() {
                if (this.isShuffled) {
                    this.currentTrack = Math.floor(Math.random() * this.playlist.length);
                } else {
                    this.currentTrack = (this.currentTrack + 1) % this.playlist.length;
                }
                this.updateDisplay();
                this.resetTime();
            }

            selectTrack(index) {
                this.currentTrack = index;
                this.updateDisplay();
                this.resetTime();
                
                // Atualizar playlist visual
                document.querySelectorAll('.playlist-item').forEach((item, i) => {
                    item.classList.toggle('active', i === index);
                });
            }

            toggleShuffle() {
                this.isShuffled = !this.isShuffled;
                const shuffleBtn = document.getElementById('shuffle-btn');
                shuffleBtn.style.background = this.isShuffled ? 
                    'linear-gradient(180deg, #ffff00 0%, #ffa500 100%)' : 
                    'linear-gradient(180deg, #c0c0c0 0%, #808080 100%)';
                console.log('🔀 Shuffle:', this.isShuffled ? 'Ativado' : 'Desativado');
            }

            toggleRepeat() {
                this.isRepeating = !this.isRepeating;
                const repeatBtn = document.getElementById('repeat-btn');
                repeatBtn.style.background = this.isRepeating ? 
                    'linear-gradient(180deg, #ffff00 0%, #ffa500 100%)' : 
                    'linear-gradient(180deg, #c0c0c0 0%, #808080 100%)';
                console.log('🔁 Repeat:', this.isRepeating ? 'Ativado' : 'Desativado');
            }

            updateDisplay() {
                const track = this.playlist[this.currentTrack];
                document.getElementById('current-track').textContent = 
                    `♪ ${track.artist} - ${track.title} ♪`;
            }

            resetTime() {
                this.currentTime = 0;
                this.updateTimeDisplay();
            }

            updateTimeDisplay() {
                const track = this.playlist[this.currentTrack];
                const currentMin = Math.floor(this.currentTime / 60);
                const currentSec = Math.floor(this.currentTime % 60);
                const timeString = `${currentMin.toString().padStart(2, '0')}:${currentSec.toString().padStart(2, '0')} / ${track.duration}`;
                document.getElementById('track-time').textContent = timeString;
            }

            startTimeSimulation() {
                setInterval(() => {
                    if (this.isPlaying) {
                        this.currentTime += 1;
                        this.updateTimeDisplay();
                        
                        // Simular fim da música
                        const trackDuration = this.playlist[this.currentTrack].duration.split(':');
                        const totalSeconds = parseInt(trackDuration[0]) * 60 + parseInt(trackDuration[1]);
                        
                        if (this.currentTime >= totalSeconds) {
                            if (this.isRepeating) {
                                this.resetTime();
                            } else {
                                this.nextTrack();
                            }
                        }
                    }
                }, 1000);
            }

            // Funções administrativas
            addTrack() {
                const title = prompt('Nome da música:');
                const artist = prompt('Artista:') || 'Aurora Sagrada';
                const duration = prompt('Duração (mm:ss):') || '04:00';
                
                if (title) {
                    this.playlist.push({ title, artist, duration });
                    this.refreshPlaylist();
                    alert('🎵 Música adicionada com sucesso!');
                }
            }

            removeTrack() {
                if (this.playlist.length > 1) {
                    const index = prompt(`Remover música (0-${this.playlist.length - 1}):`);
                    if (index !== null && index >= 0 && index < this.playlist.length) {
                        this.playlist.splice(index, 1);
                        if (this.currentTrack >= this.playlist.length) {
                            this.currentTrack = 0;
                        }
                        this.refreshPlaylist();
                        this.updateDisplay();
                        alert('🗑️ Música removida!');
                    }
                } else {
                    alert('❌ Não é possível remover a última música!');
                }
            }

            editPlaylist() {
                alert('✏️ Editor de playlist - Funcionalidade em desenvolvimento!');
            }

            savePlaylist() {
                const playlistData = JSON.stringify(this.playlist, null, 2);
                console.log('💾 Playlist salva:', playlistData);
                alert('💾 Playlist salva com sucesso!');
            }

            refreshPlaylist() {
                const container = document.getElementById('playlist-container');
                container.innerHTML = '';
                
                this.playlist.forEach((track, index) => {
                    const item = document.createElement('div');
                    item.className = 'playlist-item';
                    if (index === this.currentTrack) item.classList.add('active');
                    item.dataset.track = index;
                    item.textContent = `🎵 ${track.title} - ${track.artist}`;
                    item.addEventListener('click', () => this.selectTrack(index));
                    container.appendChild(item);
                });
            }
        }

        // === WITCH.TV ===
        class WitchTV {
            constructor() {
                this.channels = [
                    { name: "🌙 Canal Lunar", content: "Meditações Noturnas", status: "AO VIVO" },
                    { name: "🔮 Oráculos & Profecias", content: "Consultas Místicas", status: "24h" },
                    { name: "🌿 Herbalismo Sagrado", content: "Plantas Medicinais", status: "HD" },
                    { name: "⭐ Astrologia Avançada", content: "Mapas Astrais", status: "PREMIUM" },
                    { name: "🧙‍♀️ Escola de Magia", content: "Curso Básico", status: "NOVO" }
                ];
                this.currentChannel = 0;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.updateChannel();
            }

            setupEventListeners() {
                document.querySelectorAll('.channel-item').forEach((item, index) => {
                    item.addEventListener('click', () => {
                        this.switchChannel(index);
                    });
                });
            }

            switchChannel(channelIndex) {
                this.currentChannel = channelIndex;
                this.updateChannel();
                
                // Atualizar lista visual
                document.querySelectorAll('.channel-item').forEach((item, i) => {
                    item.classList.toggle('active', i === channelIndex);
                });
            }

            updateChannel() {
                const channel = this.channels[this.currentChannel];
                const tvContent = document.getElementById('tv-content');
                tvContent.textContent = `${channel.name} - ${channel.content}`;
                console.log('📺 Mudando para:', channel.name);
            }
        }

        // === TARÔ APP ===
        class TarotApp {
            constructor() {
                this.cards = [
                    { name: "O Mago", meaning: "Poder pessoal, manifestação, recursos disponíveis" },
                    { name: "A Sacerdotisa", meaning: "Intuição, mistério, conhecimento oculto" },
                    { name: "A Imperatriz", meaning: "Fertilidade, criatividade, abundância" },
                    { name: "O Imperador", meaning: "Autoridade, estrutura, controle" },
                    { name: "O Hierofante", meaning: "Tradição, conformidade, moralidade" },
                    { name: "Os Amantes", meaning: "Amor, harmonia, relacionamentos" },
                    { name: "O Carro", meaning: "Controle, determinação, direção" },
                    { name: "A Força", meaning: "Força interior, bravura, compaixão" },
                    { name: "O Eremita", meaning: "Busca interior, introspecção, orientação" },
                    { name: "A Roda da Fortuna", meaning: "Boa sorte, karma, ciclos de vida" }
                ];
                this.selectedCards = [];
                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.querySelectorAll('.tarot-card').forEach((card, index) => {
                    card.addEventListener('click', () => {
                        this.revealCard(index);
                    });
                });
            }

            revealCard(cardIndex) {
                if (this.selectedCards[cardIndex]) return;

                const randomCard = this.cards[Math.floor(Math.random() * this.cards.length)];
                this.selectedCards[cardIndex] = randomCard;

                const cardElement = document.querySelector(`[data-card="${cardIndex}"]`);
                cardElement.classList.add('revealed');
                cardElement.textContent = randomCard.name;

                this.updateReading();
            }

            updateReading() {
                const positions = ['Passado', 'Presente', 'Futuro'];
                const reading = document.getElementById('tarot-reading');
                
                let content = '<h4>🔮 Sua Leitura</h4>';
                
                this.selectedCards.forEach((card, index) => {
                    if (card) {
                        content += `<p><strong>${positions[index]}:</strong> ${card.name}</p>`;
                        content += `<p><em>${card.meaning}</em></p>`;
                    }
                });

                if (this.selectedCards.filter(c => c).length === 0) {
                    content += '<p>Clique nas cartas para revelar sua leitura sobre Passado, Presente e Futuro.</p>';
                }

                reading.innerHTML = content;
            }
        }

        // === LIVROS APP ===
        class BooksApp {
            constructor() {
                this.books = [
                    {
                        title: "Grimório das Sombras",
                        content: "Este antigo grimório contém feitiços e rituais das tradições sombrias. Aprenda sobre proteção, banimento e trabalho com energias densas de forma segura e responsável."
                    },
                    {
                        title: "Herbário Sagrado",
                        content: "Guia completo das plantas sagradas e suas propriedades mágicas. Descubra como usar ervas para cura, proteção, amor e prosperidade em seus rituais."
                    },
                    {
                        title: "Cristais & Energias",
                        content: "Manual prático sobre cristais e pedras preciosas. Aprenda a programar, limpar e usar cristais para amplificar suas intenções e equilibrar chakras."
                    },
                    {
                        title: "Rituais Lunares",
                        content: "Conecte-se com os ciclos lunares através de rituais poderosos. Cada fase da lua oferece oportunidades únicas para manifestação e transformação."
                    },
                    {
                        title: "Alquimia Moderna",
                        content: "A arte da transformação aplicada à vida moderna. Descubra como os princípios alquímicos podem ser usados para crescimento pessoal e espiritual."
                    },
                    {
                        title: "Runas Antigas",
                        content: "Sistema divinatório nórdico com 24 runas. Aprenda o significado de cada símbolo e como usar as runas para orientação e autoconhecimento."
                    },
                    {
                        title: "Chakras & Auras",
                        content: "Guia completo do sistema energético humano. Técnicas para equilibrar chakras, limpar a aura e desenvolver sensibilidade energética."
                    },
                    {
                        title: "Magia Elemental",
                        content: "Trabalhe com os quatro elementos: Terra, Água, Fogo e Ar. Aprenda rituais elementais e como invocar as energias da natureza."
                    }
                ];
                this.init();
            }

            init() {
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.querySelectorAll('.book-spine').forEach((spine, index) => {
                    spine.addEventListener('click', () => {
                        this.openBook(index);
                    });
                });
            }

            openBook(bookIndex) {
                const book = this.books[bookIndex];
                const content = document.getElementById('book-content');
                
                content.innerHTML = `
                    <h4>📖 ${book.title}</h4>
                    <p>${book.content}</p>
                    <br>
                    <p><em>Este é apenas um resumo. O livro completo contém exercícios práticos, rituais detalhados e muito mais conhecimento esotérico.</em></p>
                    <br>
                    <p><strong>Clique em outro livro para continuar explorando a biblioteca!</strong></p>
                `;
                
                console.log('📚 Abrindo livro:', book.title);
            }
        }

        // === AFAST! APP ===
        class AFASTApp {
            constructor() {
                this.isRecording = false;
                this.speechLog = [];
                this.init();
            }

            init() {
                this.addToLog('> AFÁST! v2.0 - Sistema de Reconhecimento de Voz Iniciado');
                this.addToLog('> Bem vindo ao AFÁST!');
                this.addToLog('> Aguardando comando de voz...');
                this.addToLog('> Digite "help" para ver comandos disponíveis');
            }

            toggleRecording() {
                this.isRecording = !this.isRecording;
                const recordBtn = document.getElementById('record-btn');
                
                if (this.isRecording) {
                    recordBtn.classList.add('recording');
                    recordBtn.textContent = '⏹️ Parar';
                    this.addToLog('> 🎤 GRAVANDO... Fale agora!');
                    
                    // Simular reconhecimento de voz
                    setTimeout(() => {
                        if (this.isRecording) {
                            this.addToLog('> Reconhecido: "Olá, AFAST!"');
                            this.addToLog('> Resposta: Olá! Como posso ajudá-lo hoje?');
                        }
                    }, 3000);
                } else {
                    recordBtn.classList.remove('recording');
                    recordBtn.textContent = '🎤 Gravar';
                    this.addToLog('> ⏹️ Gravação finalizada');
                }
            }

            playback() {
                this.addToLog('> 🔊 Reproduzindo última gravação...');
                this.addToLog('> "Olá, AFAST! Como você está?"');
            }

            clearLog() {
                const speechArea = document.getElementById('speech-area');
                speechArea.textContent = '';
                this.speechLog = [];
                this.addToLog('> Log limpo - Sistema pronto');
            }

            showHelp() {
                this.addToLog('> === COMANDOS DISPONÍVEIS ===');
                this.addToLog('> 🎤 Gravar - Iniciar/parar gravação de voz');
                this.addToLog('> 🔊 Reproduzir - Tocar última gravação');
                this.addToLog('> 🗑️ Limpar - Limpar histórico');
                this.addToLog('> ❓ Ajuda - Mostrar esta ajuda');
                this.addToLog('> ========================');
            }

            addToLog(message) {
                const speechArea = document.getElementById('speech-area');
                this.speechLog.push(message);
                speechArea.textContent = this.speechLog.join('\n');
                speechArea.scrollTop = speechArea.scrollHeight;
                
                // Reproduzir áudio para mensagens específicas
                this.playAudioForMessage(message);
            }
            
            playAudioForMessage(message) {
                // Tentar reproduzir áudio específico primeiro
                let audioFile = null;
                
                if (message.includes('Bem vindo ao AFÁST!')) {
                    audioFile = 'audio/bem-vindo-afast.wav';
                } else if (message.includes('Uma ameaça foi detectada')) {
                    audioFile = 'audio/ameaca-detectada.wav';
                }
                
                if (audioFile) {
                    const audio = new Audio(audioFile);
                    audio.volume = 0.7;
                    audio.play().catch(e => {
                        console.log('Erro ao reproduzir áudio específico:', e);
                        // Fallback para síntese de voz
                        this.synthesizeVoice(message);
                    });
                } else {
                    // Usar síntese de voz para outras mensagens
                    this.synthesizeVoice(message);
                }
            }
            
            synthesizeVoice(message) {
                try {
                    // Usar Web Speech API para síntese de voz
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance();
                        
                        // Limpar texto para síntese
                        let cleanText = message.replace(/[>🎤🔊🗑️❓⏹️]/g, '').trim();
                        
                        // Traduzir algumas mensagens específicas
                        if (cleanText.includes('AFÁSTE')) {
                            cleanText = cleanText.replace('AFÁSTE', 'A-F-A-S-T-E');
                        }
                        
                        utterance.text = cleanText;
                        utterance.lang = 'pt-BR';
                        utterance.rate = 0.9;
                        utterance.pitch = 1.1;
                        utterance.volume = 0.8;
                        
                        // Tentar encontrar voz em português
                        const voices = speechSynthesis.getVoices();
                        const ptVoice = voices.find(voice => 
                            voice.lang.includes('pt') || voice.lang.includes('BR')
                        );
                        
                        if (ptVoice) {
                            utterance.voice = ptVoice;
                        }
                        
                        speechSynthesis.speak(utterance);
                    } else {
                        // Fallback para beep sintético
                        this.playNotificationBeep();
                    }
                } catch (e) {
                    console.log('Erro na síntese de voz:', e);
                    this.playNotificationBeep();
                }
            }
            
            playNotificationBeep() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } catch (e) {
                    console.log('Erro ao reproduzir beep:', e);
                }
            }
        }

        // Funções globais para janelas
        function closeWindow(windowId) {
            document.getElementById(windowId).classList.remove('active');
        }

        function minimizeWindow(windowId) {
            document.getElementById(windowId).classList.remove('active');
        }

        // Funções AstroMágick Expandido
        function switchAstroTab(tabName) {
            // Remover classe active de todas as abas
            document.querySelectorAll('.astro-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.astro-tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });

            // Ativar aba selecionada
            document.querySelector(`[onclick="switchAstroTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // Mostrar notificação
            showNotification(`🌟 Navegando para aba: ${getTabTitle(tabName)}`);
        }

        function getTabTitle(tabName) {
            const titles = {
                'positions': 'Posições Planetárias',
                'lunar': 'Informações Lunares',
                'transits': 'Trânsitos Importantes',
                'aspects': 'Aspectos Astrológicos',
                'alerts': 'Sistema de Alertas'
            };
            return titles[tabName] || tabName;
        }

        function openCompleteApp() {
            if (confirm('🔮 Deseja abrir a aplicação AstroMágick completa em uma nova janela?')) {
                // Aqui você pode colocar o link para sua ferramenta completa
                showNotification('🔮 Redirecionando para aplicação completa...');
                // window.open('https://seu-site.com/astromagick-completo', '_blank');
            }
        }

        function updateAstroData() {
            showNotification('🔄 Atualizando dados astrológicos...');
            
            // Simular atualização
            setTimeout(() => {
                showNotification('✅ Dados astrológicos atualizados com sucesso!');
                
                // Simular detecção de ameaça astrológica (30% de chance)
                const threatDetected = Math.random() < 0.3;
                
                // Enviar notificação para AFÁSTE se estiver ativo
                if (window.afastApp) {
                    window.afastApp.addToLog('🌟 ALERTA ASTROLÓGICO: Dados atualizados!');
                    window.afastApp.addToLog('🔮 Novas informações planetárias disponíveis.');
                    
                    if (threatDetected) {
                        setTimeout(() => {
                            window.afastApp.addToLog('🚨 Uma ameaça foi detectada');
                            window.afastApp.addToLog('⚠️ Eclipse lunar aproximando-se em 18 dias');
                            window.afastApp.addToLog('🔴 Recomenda-se cautela e preparação espiritual');
                            showNotification('🚨 AFÁSTE: Uma ameaça foi detectada!');
                        }, 2000);
                    }
                }
            }, 1500);
        }

        function detectAstronomicalThreat() {
            if (window.afastApp) {
                window.afastApp.addToLog('🚨 Uma ameaça foi detectada');
                window.afastApp.addToLog('⚠️ Mercúrio retrógrado iniciando em 24 dias');
                window.afastApp.addToLog('🔴 Cuidado com comunicações e tecnologia');
                showNotification('🚨 AFÁSTE: Uma ameaça foi detectada!');
            }
        }

        function showNotification(message) {
            // Criar elemento de notificação
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(180deg, var(--dourado) 0%, #e6a000 100%);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                font-weight: bold;
                border: 2px outset #f0aa53;
                animation: slideIn 0.3s ease-out;
            `;

            // Adicionar animação CSS
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(notification);

            // Remover após 3 segundos
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            window.auroraOS = new AuroraOS();
            
            // Criar orbes flutuantes na tela de boot
            createBootOrbs();
            
            // Inicializar AFÁSTE para notificações (mesmo sem janela aberta)
            if (!window.afastApp) {
                window.afastApp = new AFASTApp();
            }
            
            // Configurar botão Iniciar
            const startButton = document.getElementById('start-button');
            if (startButton) {
                startButton.addEventListener('click', () => {
                    showMysticStartMenu();
                });
            }
            
            // Configurar clique no relógio para abrir calendário astrológico
            const clock = document.getElementById('clock');
            if (clock) {
                clock.addEventListener('click', () => {
                    openAstrologicalCalendar();
                });
                clock.style.cursor = 'pointer';
            }
            
            console.log('🌟 Aurora OS inicializado com sucesso!');
        });
        
        // Função para mostrar menu Iniciar
        function showStartMenu() {
            const apps = [
                { name: 'AstroMágick', id: 'astromagick', icon: '🌙' },
                { name: 'Aurora Player', id: 'aurora-player', icon: '🎵' },
                { name: 'Witch.TV', id: 'witch-tv', icon: '📺' },
                { name: 'AFÁSTE', id: 'afast', icon: '🗣️' },
                { name: 'Tarô Místico', id: 'tarot', icon: '🔮' },
                { name: 'Livros Interativos', id: 'books', icon: '📚' }
            ];
            
            let menuHTML = '<div style="position: fixed; bottom: 60px; left: 10px; background: #c0c0c0; border: 2px outset #c0c0c0; padding: 10px; z-index: 10000; min-width: 200px;">';
            menuHTML += '<div style="font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #808080; padding-bottom: 5px;">🌟 Aplicações Místicas</div>';
            
            apps.forEach(app => {
                menuHTML += `<div style="padding: 5px; cursor: pointer; hover: background: #0000ff; color: white;" onclick="window.auroraOS.openApp('${app.id}'); closeStartMenu();">${app.icon} ${app.name}</div>`;
            });
            
            menuHTML += '<div style="border-top: 1px solid #808080; margin-top: 10px; padding-top: 5px;">';
            menuHTML += '<div style="padding: 5px; cursor: pointer;" onclick="closeStartMenu();">❌ Fechar</div>';
            menuHTML += '</div></div>';
            
            // Remover menu existente se houver
            const existingMenu = document.getElementById('start-menu');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            // Adicionar novo menu
            const menuDiv = document.createElement('div');
            menuDiv.id = 'start-menu';
            menuDiv.innerHTML = menuHTML;
            document.body.appendChild(menuDiv);
        }
        
        // Função para fechar menu Iniciar
        function closeStartMenu() {
            const menu = document.getElementById('start-menu');
            if (menu) {
                menu.remove();
            }
        }
        
        // Função para abrir calendário astrológico
        function openAstrologicalCalendar() {
            const calendar = document.getElementById('astro-calendar');
            if (calendar.style.display === 'block') {
                calendar.style.display = 'none';
            } else {
                calendar.style.display = 'block';
                generateCalendarDays();
            }
        }

        // Função para gerar dias do calendário com indicadores astrológicos
        function generateCalendarDays() {
            const grid = document.getElementById('calendar-grid');
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            
            // Limpar dias existentes (manter cabeçalhos)
            const headers = grid.querySelectorAll('div[style*="font-weight: bold"]');
            grid.innerHTML = '';
            headers.forEach(header => grid.appendChild(header));
            
            // Primeiro dia do mês e quantos dias tem
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Adicionar dias vazios no início
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                grid.appendChild(emptyDay);
            }
            
            // Adicionar dias do mês
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                if (day === now.getDate()) {
                    dayElement.classList.add('today');
                }
                
                // Número do dia
                const dayNumber = document.createElement('div');
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);
                
                // Indicador astrológico baseado no dia
                const astroIndicator = document.createElement('div');
                astroIndicator.className = 'astro-indicator';
                
                // Eventos especiais
                if (day === 28 && month === 8) { // 28 de setembro
                    astroIndicator.textContent = '🌑';
                    astroIndicator.title = 'Lua Nova';
                } else if (day === 4 && month === 9) { // 4 de outubro
                    astroIndicator.textContent = '☿';
                    astroIndicator.title = 'Mercúrio Retrógrado';
                } else if (day === 14 && month === 9) { // 14 de outubro
                    astroIndicator.textContent = '🌕';
                    astroIndicator.title = 'Lua Cheia';
                } else {
                    // Indicador baseado na fase lunar aproximada
                    const lunarPhase = (day % 29.5) / 29.5;
                    if (lunarPhase < 0.125 || lunarPhase > 0.875) {
                        astroIndicator.textContent = '🌑';
                    } else if (lunarPhase < 0.375) {
                        astroIndicator.textContent = '🌓';
                    } else if (lunarPhase < 0.625) {
                        astroIndicator.textContent = '🌕';
                    } else {
                        astroIndicator.textContent = '🌗';
                    }
                }
                
                dayElement.appendChild(astroIndicator);
                grid.appendChild(dayElement);
                
                // Evento de clique para mostrar detalhes do dia
                dayElement.addEventListener('click', () => {
                    showDayDetails(day, month, year);
                });
            }
        }

        // Função para mostrar detalhes astrológicos do dia
        function showDayDetails(day, month, year) {
            const date = new Date(year, month, day);
            const dayName = date.toLocaleDateString('pt-BR', { weekday: 'long' });
            
            alert(`${day}/${month + 1}/${year} - ${dayName}\n\nInfluências Astrológicas:\n• Energia do dia baseada na Lua\n• Hora planetária variável\n• Consulte o AstroMágick para detalhes completos`);
                // === SISTEMA AFÁST! EXPANDIDO ===
        const afastNotifications = {
            // Eventos críticos - usam "Uma ameaça foi detectada"
            critical: [
                {
                    type: 'retrograde',
                    alert: 'Uma ameaça foi detectada.',
                    explanation: 'Mercúrio está retrógrado. Comunicação e tecnologia exigem cautela.',
                    icon: '☿',
                    protection: 'Firewall Planetário',
                    ritual: 'banimento'
                },
                {
                    type: 'retrograde',
                    alert: 'Uma ameaça foi detectada.',
                    explanation: 'Vênus retrógrada revisa afetos, desejos e valores.',
                    icon: '♀',
                    protection: 'Escudo do Coração',
                    ritual: 'purificacao'
                },
                {
                    type: 'void-moon',
                    alert: 'Uma ameaça foi detectada.',
                    explanation: 'A Lua está fora de curso até 23h45. Evite decisões definitivas.',
                    icon: '🌑',
                    protection: 'Escudo Lunar',
                    ritual: 'pausa'
                },
                {
                    type: 'eclipse',
                    alert: 'Um eclipse foi detectado.',
                    explanation: 'A sombra abre portais de transformação.',
                    icon: '🌑',
                    protection: 'Véu do Eclipse',
                    ritual: 'portal'
                },
                {
                    type: 'tense-aspect',
                    alert: 'Uma ameaça foi detectada.',
                    explanation: 'Conflito astral ativo. Aspectos tensos em formação.',
                    icon: '⚡',
                    protection: 'Armadura Astral',
                    ritual: 'equilibrio'
                }
            ],
            
            // Eventos neutros/positivos
            neutral: [
                {
                    type: 'lunar-phase',
                    alert: 'Uma mudança lunar foi detectada.',
                    explanation: 'A Lua agora é Nova. Tempo de começos e intenções.',
                    icon: '🌑',
                    ritual: 'manifestacao'
                },
                {
                    type: 'lunar-phase',
                    alert: 'A Lua alterou sua face.',
                    explanation: 'A Lua Cheia desperta revelações e plenitude.',
                    icon: '🌕',
                    ritual: 'gratidao'
                },
                {
                    type: 'planetary-ingress',
                    alert: 'Um ingresso planetário foi detectado.',
                    explanation: 'O Sol entrou em Virgem. Organização e clareza ganham força.',
                    icon: '☉',
                    ritual: 'organizacao'
                },
                {
                    type: 'harmonic-aspect',
                    alert: 'Uma oportunidade foi detectada.',
                    explanation: 'Alinhamento favorável em curso. Aspectos harmônicos ativos.',
                    icon: '✨',
                    ritual: 'aproveitamento'
                }
            ]
        };

        // Modos de Proteção AFÁST!
        const protectionModes = {
            'Escudo Lunar': {
                description: 'Proteção durante fases lunares instáveis',
                color: '#silver',
                effect: 'Pausa decisões importantes'
            },
            'Firewall Planetário': {
                description: 'Proteção durante retrogradações',
                color: '#red',
                effect: 'Backup automático de projetos'
            },
            'Véu do Eclipse': {
                description: 'Defesas especiais em eclipses',
                color: '#purple',
                effect: 'Portal de transformação ativo'
            },
            'Armadura Astral': {
                description: 'Proteção contra aspectos tensos',
                color: '#gold',
                effect: 'Neutraliza conflitos astrais'
            }
        };

        // Rituais Digitais AFÁST!
        const digitalRituals = {
            banimento: {
                name: 'Ritual de Banimento',
                description: 'Remove energias negativas',
                steps: ['Acender vela virtual', 'Traçar pentáculo', 'Recitar banimento'],
                duration: 3000
            },
            purificacao: {
                name: 'Ritual de Purificação',
                description: 'Limpa energias do coração',
                steps: ['Água lustral virtual', 'Cristal de quartzo', 'Mantra de amor'],
                duration: 4000
            },
            portal: {
                name: 'Abertura de Portal',
                description: 'Ativa transformações profundas',
                steps: ['Círculo mágico', 'Invocação lunar', 'Portal astral'],
                duration: 5000
            },
            manifestacao: {
                name: 'Ritual de Manifestação',
                description: 'Potencializa intenções',
                steps: ['Vela dourada', 'Visualização', 'Decreto de poder'],
                duration: 3500
            }
        };

        // Função expandida para falar com voz feminina estilo AVAST
        function speakAFASTAlert(alert, explanation, isUrgent = false) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                
                // Configurar voz feminina grave e autoritária
                const alertUtterance = new SpeechSynthesisUtterance(alert);
                alertUtterance.rate = isUrgent ? 0.5 : 0.6; // Mais lenta se urgente
                alertUtterance.pitch = 0.7; // Tom grave e firme
                alertUtterance.volume = 1.0;
                
                const explanationUtterance = new SpeechSynthesisUtterance(explanation);
                explanationUtterance.rate = 0.8; // Mais suave na explicação
                explanationUtterance.pitch = 0.9; // Tom mais suave
                explanationUtterance.volume = 0.8;
                
                // Tentar encontrar voz feminina em português
                const voices = speechSynthesis.getVoices();
                const femaleVoice = voices.find(voice => 
                    voice.lang.includes('pt') && (
                        voice.name.toLowerCase().includes('female') ||
                        voice.name.toLowerCase().includes('feminina') ||
                        voice.name.toLowerCase().includes('woman')
                    )
                ) || voices.find(voice => voice.lang.includes('pt')) || voices[0];
                
                if (femaleVoice) {
                    alertUtterance.voice = femaleVoice;
                    explanationUtterance.voice = femaleVoice;
                }
                
                // Falar alerta primeiro (autoritário)
                speechSynthesis.speak(alertUtterance);
                
                // Depois explicação (suave)
                alertUtterance.onend = () => {
                    setTimeout(() => {
                        speechSynthesis.speak(explanationUtterance);
                    }, 800); // Pausa dramática
                };
            }
        }

        // Função para ativar modo de proteção
        function activateProtection(protectionName) {
            const protection = protectionModes[protectionName];
            if (protection) {
                // Mostrar notificação de ativação
                msnSystem.showAstrologicalAlert(
                    `🛡️ ${protectionName} Ativado`,
                    protection.description
                );
                
                // Efeito visual no desktop
                const desktop = document.getElementById('desktop');
                desktop.style.boxShadow = `inset 0 0 50px ${protection.color}40`;
                
                // Salvar estado de proteção
                localStorage.setItem('afast-protection', protectionName);
                
                // Falar confirmação
                speakAFASTAlert(
                    `${protectionName} ativado.`,
                    protection.effect,
                    false
                );
            }
        }

        // Função para executar ritual digital
        function executeDigitalRitual(ritualType) {
            const ritual = digitalRituals[ritualType];
            if (!ritual) return;
            
            // Criar janela de ritual
            const ritualWindow = document.createElement('div');
            ritualWindow.className = 'ritual-window';
            ritualWindow.innerHTML = `
                <div class="ritual-header">
                    <span>🔮 ${ritual.name}</span>
                    <button onclick="this.parentElement.parentElement.remove()">×</button>
                </div>
                <div class="ritual-content">
                    <div class="ritual-circle">
                        <div class="ritual-symbol">✦</div>
                    </div>
                    <div class="ritual-steps">
                        ${ritual.steps.map((step, i) => 
                            `<div class="ritual-step" id="step-${i}">${step}</div>`
                        ).join('')}
                    </div>
                    <div class="ritual-progress">
                        <div class="ritual-progress-bar"></div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(ritualWindow);
            
            // Animar ritual
            let currentStep = 0;
            const stepInterval = ritual.duration / ritual.steps.length;
            
            const ritualAnimation = setInterval(() => {
                if (currentStep < ritual.steps.length) {
                    document.getElementById(`step-${currentStep}`).classList.add('active');
                    currentStep++;
                } else {
                    clearInterval(ritualAnimation);
                    // Ritual completo
                    setTimeout(() => {
                        ritualWindow.remove();
                        msnSystem.showAstrologicalAlert(
                            '✨ Ritual Completo',
                            `${ritual.name} executado com sucesso`
                        );
                    }, 1000);
                }
            }, stepInterval);
        }

        // Função expandida para mostrar notificação AFÁST!
        function showAFASTNotification(notification) {
            // Mostrar notificação visual MSN
            msnSystem.showAstrologicalAlert(
                `${notification.icon} AFÁST! Sistema`,
                `${notification.alert} ${notification.explanation}`
            );
            
            // Reproduzir alerta de voz
            setTimeout(() => {
                const isUrgent = notification.alert.includes('ameaça');
                speakAFASTAlert(notification.alert, notification.explanation, isUrgent);
            }, 1000);
            
            // Ativar proteção se necessário
            if (notification.protection) {
                setTimeout(() => {
                    activateProtection(notification.protection);
                }, 3000);
            }
            
            // Oferecer ritual se disponível
            if (notification.ritual) {
                setTimeout(() => {
                    msnSystem.showAstrologicalAlert(
                        '🔮 Ritual Disponível',
                        `Clique para executar: ${digitalRituals[notification.ritual]?.name || 'Ritual Místico'}`
                    );
                }, 5000);
            }
        }

        // Sistema de alertas astrológicos automáticos
        function startAFASTAlerts() {
            // Alerta de boas-vindas
            setTimeout(() => {
                const welcomeAlert = {
                    alert: 'Sistema AFÁST ativado.',
                    explanation: 'Monitoramento astrológico em funcionamento.',
                    icon: '🗣️'
                };
                showAFASTNotification(welcomeAlert);
            }, 5000);
            
            // Alertas periódicos baseados em eventos astrológicos
            setInterval(() => {
                const now = new Date();
                const hour = now.getHours();
                const minute = now.getMinutes();
                
                // Verificar eventos críticos em horários específicos
                if (hour === 12 && minute === 0) { // Meio-dia
                    const criticalAlert = afastNotifications.critical[
                        Math.floor(Math.random() * afastNotifications.critical.length)
                    ];
                    showAFASTNotification(criticalAlert);
                }
                
                // Verificar eventos neutros em outros horários
                if (hour === 18 && minute === 0) { // 18h
                    const neutralAlert = afastNotifications.neutral[
                        Math.floor(Math.random() * afastNotifications.neutral.length)
                    ];
                    showAFASTNotification(neutralAlert);
                }
                
                // Alertas aleatórios baseados em aspectos astrológicos
                if (Math.random() < 0.1) { // 10% de chance a cada verificação
                    const allAlerts = [...afastNotifications.critical, ...afastNotifications.neutral];
                    const randomAlert = allAlerts[Math.floor(Math.random() * allAlerts.length)];
                    showAFASTNotification(randomAlert);
                }
                
            }, 60000); // Verificar a cada minuto
        }

        // === ALTAR DIGITAL - MENU INICIAR MÍSTICO ===
        
        // Frases oraculares aleatórias
        const oracularPhrases = [
            "Hoje a Lua te observa em silêncio.",
            "Cuidado com as palavras, Mercúrio está atento.",
            "A chama da vontade é tua defesa.",
            "Os astros sussurram segredos ao vento.",
            "Tua intuição é mais forte que qualquer carta.",
            "O cosmos conspira a teu favor.",
            "Cada escolha ecoa nas esferas celestes.",
            "A magia flui onde a mente se aquieta.",
            "Saturno ensina através da paciência.",
            "Vênus desperta o que o coração deseja."
        ];

        // Comandos mágicos da Caixa de Feitiços
        const magicCommands = {
            '/banir': () => executeDigitalRitual('banimento'),
            '/purificar': () => executeDigitalRitual('purificacao'),
            '/harmonia': () => executeDigitalRitual('equilibrio'),
            '/ver lua': () => showLunarInfo(),
            '/protecao': () => activateProtection('Armadura Astral'),
            '/portal': () => executeDigitalRitual('portal'),
            '/manifestar': () => executeDigitalRitual('manifestacao'),
            '/abracadabra': () => createStarRain(),
            '/susto': () => afastThreatAlert(),
            '/111': () => showSynchronicity(),
            '/ouroboros': () => showOuroboros(),
            '/witch': () => showPixelWitch()
        };

        // Função para mostrar Menu Iniciar Místico
        function showMysticStartMenu() {
            // Remover menu anterior se existir
            const existingMenu = document.getElementById('mystic-start-menu');
            if (existingMenu) {
                existingMenu.remove();
                return;
            }

            // Criar menu místico
            const menu = document.createElement('div');
            menu.id = 'mystic-start-menu';
            menu.className = 'mystic-start-menu';
            
            // Frase oracular aleatória
            const randomPhrase = oracularPhrases[Math.floor(Math.random() * oracularPhrases.length)];
            
            menu.innerHTML = `
                <div class="mystic-menu-header">
                    <div class="oracle-phrase">"${randomPhrase}"</div>
                </div>
                
                <div class="mystic-menu-content">
                    <!-- Painel de Alertas AFÁST! -->
                    <div class="afast-alerts-panel">
                        <div class="panel-title">🛡️ Alertas Ativos</div>
                        <div class="alert-item">☿ Mercúrio retrógrado em curso</div>
                        <div class="alert-item">🌑 Lua fora de curso até 19h45</div>
                        <button class="defense-button" onclick="activateProtection('Armadura Astral')">
                            <span class="pentacle">⭐</span> Defesa Rápida
                        </button>
                    </div>
                    
                    <!-- Caixa de Feitiços Rápidos -->
                    <div class="spell-box">
                        <div class="panel-title">🔮 Caixa de Feitiços</div>
                        <input type="text" id="spell-input" placeholder="Digite comando mágico..." 
                               onkeypress="handleSpellCommand(event)">
                        <div class="spell-hints">
                            /banir • /harmonia • /ver lua • /protecao
                        </div>
                    </div>
                    
                    <!-- Agenda Astromágicka -->
                    <div class="astro-agenda">
                        <div class="panel-title">🌙 Agenda Astromágicka</div>
                        <div class="agenda-item">🌕 Fase: ${getCurrentMoonPhase()}</div>
                        <div class="agenda-item">⚡ Hora: ${getCurrentPlanetaryHour()}</div>
                        <div class="agenda-item">🜁 Elemento: ${getCurrentElement()}</div>
                        <div class="agenda-item">🏰 Mansão: ${getCurrentLunarMansion()}</div>
                    </div>
                    
                    <!-- Atalhos Personalizados -->
                    <div class="mystic-shortcuts">
                        <div class="panel-title">✨ Altar Pessoal</div>
                        <div class="shortcuts-grid">
                            <div class="mystic-shortcut" onclick="window.auroraOS.openApp('astromagick')">
                                <div class="shortcut-icon">🌟</div>
                                <div class="shortcut-label">AstroMágick</div>
                            </div>
                            <div class="mystic-shortcut" onclick="window.auroraOS.openApp('tarot')">
                                <div class="shortcut-icon">🔮</div>
                                <div class="shortcut-label">Tarô Místico</div>
                            </div>
                            <div class="mystic-shortcut" onclick="window.auroraOS.openApp('witch-tv')">
                                <div class="shortcut-icon">📺</div>
                                <div class="shortcut-label">Witch.TV</div>
                            </div>
                            <div class="mystic-shortcut" onclick="window.auroraOS.openApp('afast')">
                                <div class="shortcut-icon">🗣️</div>
                                <div class="shortcut-label">AFÁST!</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mapa Rápido -->
                    <div class="quick-map">
                        <button class="map-button" onclick="openQuickAstroMap()">
                            <div class="cosmic-radar">🌌</div>
                            Mapa Cósmico
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(menu);
            
            // Tocar música mística de fundo
            playMysticAmbient();
            
            // Fechar menu ao clicar fora
            setTimeout(() => {
                document.addEventListener('click', closeMysticMenuOnOutsideClick);
            }, 100);
        }

        // Função para processar comandos mágicos
        function handleSpellCommand(event) {
            if (event.key === 'Enter') {
                const command = event.target.value.toLowerCase().trim();
                event.target.value = '';
                
                if (magicCommands[command]) {
                    // Efeito visual de execução
                    showSpellEffect();
                    // Executar comando
                    setTimeout(() => {
                        magicCommands[command]();
                    }, 500);
                } else {
                    // Comando não reconhecido
                    msnSystem.showAstrologicalAlert(
                        '🔮 Feitiço Desconhecido',
                        `Comando "${command}" não encontrado no grimório`
                    );
                }
            }
        }

        // Efeitos visuais para comandos
        function showSpellEffect() {
            const effect = document.createElement('div');
            effect.className = 'spell-effect';
            effect.innerHTML = '✨';
            effect.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 50px;
                color: #ffd700;
                z-index: 10000;
                animation: spellCast 1s ease-out forwards;
                pointer-events: none;
            `;
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 1000);
        }

        // Easter Eggs
        function createStarRain() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.innerHTML = '⭐';
                    star.style.cssText = `
                        position: fixed;
                        top: -50px;
                        left: ${Math.random() * window.innerWidth}px;
                        font-size: 20px;
                        z-index: 9999;
                        animation: starFall 3s linear forwards;
                        pointer-events: none;
                    `;
                    document.body.appendChild(star);
                    setTimeout(() => star.remove(), 3000);
                }, i * 100);
            }
        }

        function afastThreatAlert() {
            speakAFASTAlert(
                'Uma ameaça foi detectada.',
                'A vibração é densa. Proteção recomendada.',
                true
            );
        }

        function showSynchronicity() {
            msnSystem.showAstrologicalAlert(
                '✨ Sincronicidade Detectada',
                'O caminho está aberto. Os sinais se alinham.'
            );
        }

        // Funções auxiliares para agenda
        function getCurrentMoonPhase() {
            const phases = ['Nova', 'Crescente', 'Cheia', 'Minguante'];
            return phases[Math.floor(Math.random() * phases.length)];
        }

        function getCurrentPlanetaryHour() {
            const planets = ['☉ Sol', '☽ Lua', '♂ Marte', '☿ Mercúrio', '♃ Júpiter', '♀ Vênus', '♄ Saturno'];
            return planets[Math.floor(Math.random() * planets.length)];
        }

        function getCurrentElement() {
            const elements = ['🔥 Fogo', '💨 Ar', '💧 Água', '🌍 Terra'];
            return elements[Math.floor(Math.random() * elements.length)];
        }

        function getCurrentLunarMansion() {
            return `${Math.floor(Math.random() * 28) + 1}ª Mansão`;
        }

        // Música ambiente
        function playMysticAmbient() {
            // Implementar sons místicos baseados no contexto astrológico
            console.log('🎵 Tocando ambiente místico...');
        }

        // Fechar menu ao clicar fora
        function closeMysticMenuOnOutsideClick(event) {
            const menu = document.getElementById('mystic-start-menu');
            const startButton = document.getElementById('start-button');
            
            if (menu && !menu.contains(event.target) && !startButton.contains(event.target)) {
                menu.remove();
                document.removeEventListener('click', closeMysticMenuOnOutsideClick);
            }
        }
            }

            showThreatAlert(title, message) {
                this.createNotification('🚨', title, message, 'threat');
                this.speakThreatMessage();
            }

            showPlanetaryAlert(title, message) {
                this.createNotification('🪐', title, message, 'planetary');
                this.speakMessage(message);
            }

            showLunarAlert(title, message) {
                this.createNotification('🌙', title, message, 'lunar');
                this.speakMessage(message);
            }

            showAstrologicalAlert(title, message) {
                this.createNotification('⚠️', title, message, 'astrological');
                this.speakMessage(message);
            }

            createNotification(icon, title, message, type) {
                const notification = document.createElement('div');
                notification.className = 'msn-notification';
                notification.id = `msn-${this.nextId++}`;
                
                const now = new Date();
                const timeString = now.toLocaleTimeString('pt-BR', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });

                notification.innerHTML = `
                    <div class="msn-header">
                        <span class="msn-icon">${icon}</span>
                        <span class="msn-title">AFÁST! - Sistema de Alertas</span>
                        <button class="msn-close" onclick="this.parentElement.parentElement.remove()">×</button>
                    </div>
                    <div class="msn-content">
                        <div class="msn-message-title">${title}</div>
                        <div class="msn-message">${message}</div>
                        <div class="msn-time">${timeString}</div>
                    </div>
                `;

                // Estilo da notificação
                notification.style.cssText = `
                    position: fixed;
                    bottom: 60px;
                    right: 20px;
                    width: 300px;
                    background: linear-gradient(180deg, #c0c0c0 0%, #808080 100%);
                    border: 2px outset #c0c0c0;
                    font-family: 'MS Sans Serif', sans-serif;
                    font-size: 11px;
                    z-index: 10001;
                    animation: msnSlideUp 0.5s ease-out;
                    box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
                `;

                // Adicionar estilos internos
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes msnSlideUp {
                        from { transform: translateY(100%); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    .msn-header {
                        background: linear-gradient(180deg, #4169e1 0%, #0000cd 100%);
                        color: white;
                        padding: 4px 8px;
                        display: flex;
                        align-items: center;
                        font-weight: bold;
                    }
                    .msn-icon {
                        margin-right: 8px;
                        font-size: 14px;
                    }
                    .msn-title {
                        flex: 1;
                        font-size: 11px;
                    }
                    .msn-close {
                        background: none;
                        border: none;
                        color: white;
                        font-size: 14px;
                        cursor: pointer;
                        padding: 0 4px;
                    }
                    .msn-content {
                        padding: 8px;
                        background: #f0f0f0;
                    }
                    .msn-message-title {
                        font-weight: bold;
                        margin-bottom: 4px;
                        color: #000080;
                    }
                    .msn-message {
                        margin-bottom: 6px;
                        line-height: 1.3;
                    }
                    .msn-time {
                        font-size: 9px;
                        color: #666;
                        text-align: right;
                    }
                `;
                
                if (!document.querySelector('#msn-styles')) {
                    style.id = 'msn-styles';
                    document.head.appendChild(style);
                }

                document.body.appendChild(notification);

                // Auto-remover após 8 segundos
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.animation = 'msnSlideUp 0.3s ease-in reverse';
                        setTimeout(() => notification.remove(), 300);
                    }
                }, 8000);

                // Reposicionar outras notificações
                this.repositionNotifications();
            }

            repositionNotifications() {
                const notifications = document.querySelectorAll('.msn-notification');
                notifications.forEach((notification, index) => {
                    notification.style.bottom = `${60 + (index * 120)}px`;
                });
            }

            speakThreatMessage() {
                this.speakMessage('UMA AMEAÇA FOI DETECTADA', true);
            }

            speakMessage(text, isThreat = false) {
                try {
                    // Tentar síntese de voz feminina
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(text);
                        
                        // Configurar voz feminina robótica
                        const voices = speechSynthesis.getVoices();
                        const femaleVoice = voices.find(voice => 
                            voice.name.includes('Female') || 
                            voice.name.includes('female') ||
                            voice.name.includes('Feminino') ||
                            voice.gender === 'female'
                        );
                        
                        if (femaleVoice) {
                            utterance.voice = femaleVoice;
                        }
                        
                        // Configurações para voz robótica feminina
                        utterance.rate = 0.8;  // Mais lenta
                        utterance.pitch = 1.2; // Mais aguda (feminina)
                        utterance.volume = 0.8;
                        utterance.lang = 'pt-BR';
                        
                        speechSynthesis.speak(utterance);
                    } else {
                        // Fallback: beeps robóticos
                        this.playRoboticBeeps(isThreat);
                    }
                } catch (e) {
                    console.log('Erro na síntese de voz:', e);
                    this.playRoboticBeeps(isThreat);
                }
            }

            playRoboticBeeps(isThreat = false) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const frequencies = isThreat ? [800, 600, 800, 600] : [600, 800, 1000];
                    
                    frequencies.forEach((freq, index) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                        oscillator.type = 'square'; // Som robótico
                        
                        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                        gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                        
                        oscillator.start(audioContext.currentTime + (index * 0.3));
                        oscillator.stop(audioContext.currentTime + (index * 0.3) + 0.2);
                    });
                } catch (e) {
                    console.log('Áudio não suportado:', e);
                }
            }
        }

        // Inicializar sistema MSN
        window.msnSystem = new MSNNotificationSystem();

        // === FUNÇÃO GLOBAL OPENAPP ===
        window.openApp = function(appName) {
            console.log('🌟 Abrindo aplicação:', appName);
            const windowId = appName + '-window';
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.classList.add('active');
                windowElement.style.zIndex = 1001 + Math.floor(Math.random() * 100);
                windowElement.style.left = (100 + Math.random() * 200) + 'px';
                windowElement.style.top = (100 + Math.random() * 200) + 'px';
                console.log('✅ Janela aberta:', windowId);
                
                // Inicializar aplicação específica se necessário
                switch(appName) {
                    case 'aurora-player':
                        if (!window.auroraPlayer) {
                            window.auroraPlayer = new AuroraPlayer();
                        }
                        break;
                    case 'witch-tv':
                        if (!window.witchTV) {
                            window.witchTV = new WitchTV();
                        }
                        break;
                    case 'afast':
                        if (!window.afastApp) {
                            window.afastApp = new AFASTApp();
                        }
                        break;
                    case 'tarot':
                        if (!window.tarotApp) {
                            window.tarotApp = new TarotApp();
                        }
                        break;
                    case 'books':
                        if (!window.booksApp) {
                            window.booksApp = new BooksApp();
                        }
                        break;
                }
            } else {
                console.log('❌ Janela não encontrada:', windowId);
            }
        };

        // === FUNÇÕES GLOBAIS DE JANELA ===
        window.closeWindow = function(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.classList.remove('active');
            }
        };

        window.minimizeWindow = function(windowId) {
            const windowElement = document.getElementById(windowId);
            if (windowElement) {
                windowElement.style.display = 'none';
                // Adicionar à taskbar se necessário
            }
        };

        // === SISTEMA DE MODO XL E DENSIDADE ===
        window.setDisplayMode = function(mode) {
            document.body.className = document.body.className.replace(/size-\w+/g, '');
            if (mode !== 'normal') {
                document.body.classList.add(`size-${mode}`);
            }
            localStorage.setItem('aurora-display-mode', mode);
        };

        window.setDensity = function(density) {
            document.body.className = document.body.className.replace(/density-\w+/g, '');
            document.body.classList.add(`density-${density}`);
            localStorage.setItem('aurora-density', density);
        };

        // === CENTRO RÁPIDO ===
        window.toggleQuickCenter = function() {
            const quickCenter = document.getElementById('quickCenter');
            quickCenter.classList.toggle('show');
        };

        // === PALETA DE COMANDOS ===
        window.showCommandPalette = function() {
            const palette = document.getElementById('commandPalette');
            const input = document.getElementById('commandInput');
            palette.classList.add('show');
            input.focus();
        };

        window.hideCommandPalette = function() {
            const palette = document.getElementById('commandPalette');
            palette.classList.remove('show');
        };

        // === SISTEMA DE POPOVERS ===
        window.showPopover = function(element, title, content, events = []) {
            const popover = document.getElementById('universalPopover');
            const popoverTitle = document.getElementById('popoverTitle');
            const popoverEvents = document.getElementById('popoverEvents');
            
            popoverTitle.textContent = title;
            
            // Limpar eventos anteriores
            popoverEvents.innerHTML = '';
            
            // Adicionar eventos
            events.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'popover-event';
                eventDiv.innerHTML = `
                    <div class="popover-event-time">${event.time}</div>
                    <div class="popover-event-desc">${event.description}</div>
                `;
                popoverEvents.appendChild(eventDiv);
            });
            
            // Posicionar popover
            const rect = element.getBoundingClientRect();
            popover.style.left = `${rect.left}px`;
            popover.style.bottom = `${window.innerHeight - rect.top + 10}px`;
            
            popover.classList.add('show');
        };

        window.hidePopover = function() {
            const popover = document.getElementById('universalPopover');
            popover.classList.remove('show');
        };

        // === TIMER DA HORA PLANETÁRIA ===
        window.setHoraPlanetaria = function({inicio, fim, planeta, simbolo}) {
            const planetarySymbol = document.getElementById('planetarySymbol');
            const dayRing = document.getElementById('dayRing');
            
            if (planetarySymbol) {
                planetarySymbol.textContent = simbolo || '☉';
            }
            
            const total = new Date(fim) - new Date(inicio);
            
            const updateTimer = () => {
                const rest = new Date(fim) - Date.now();
                const pct = Math.max(0, Math.min(1, 1 - (rest / total)));
                
                if (dayRing) {
                    dayRing.querySelector('.day-ring-bg').style.setProperty('--pct', pct);
                }
                
                if (rest <= 0) {
                    clearInterval(timerInterval);
                    // Emitir evento de mudança de hora planetária
                    if (window.ASTRO) {
                        ASTRO.emit({
                            type: 'planetary-hour-change',
                            message: `Hora planetária mudou para ${planeta}`
                        });
                    }
                }
            };
            
            const timerInterval = setInterval(updateTimer, 1000);
            updateTimer(); // Executar imediatamente
        };

        // === SISTEMA DE CHIPS VIVOS ===
        window.updateAstroChip = function(chipId, data) {
            const chip = document.getElementById(chipId);
            if (!chip) return;
            
            const span = chip.querySelector('span');
            if (span) {
                span.textContent = data.text;
            }
            
            // Atualizar classes baseado na severidade
            chip.classList.remove('critical');
            if (data.critical) {
                chip.classList.add('critical');
            }
            
            // Atualizar tooltip
            chip.title = data.tooltip || '';
        };

        // === COMANDOS MÁGICOS ===
        const magicCommands = {
            '/banir': () => {
                msnSystem.showNotification('🛡️ AFÁST! Proteção', 'Energias negativas banidas do ambiente', 'protection');
            },
            '/ver lua': () => {
                const moonPhase = getCurrentMoonPhase();
                msnSystem.showNotification('🌙 Fase Lunar', `Lua atual: ${moonPhase}`, 'lunar');
            },
            '/voc': () => {
                msnSystem.showNotification('🌙 Lua Fora de Curso', 'Evite decisões importantes até a próxima mudança', 'warning');
            },
            '/ritual': () => {
                msnSystem.showNotification('🕯️ Ritual Ativado', 'Ambiente preparado para práticas místicas', 'ritual');
            },
            '/proteção': () => {
                msnSystem.showNotification('🛡️ Escudo Energético', 'Proteção espiritual ativada', 'protection');
            }
        };

        // === SISTEMA DE MIXER DE ÁUDIO ===
        const audioMixer = {
            channels: {
                narrator: 75,
                music: 60,
                sfx: 40,
                ritual: 50
            },
            
            setVolume(channel, volume) {
                this.channels[channel] = volume;
                localStorage.setItem('aurora-mixer', JSON.stringify(this.channels));
                
                // Aplicar ducking automático se necessário
                if (channel === 'narrator' && volume > 0) {
                    this.applyDucking();
                }
            },
            
            applyDucking() {
                // Reduzir música quando narradora está falando
                const musicSlider = document.getElementById('musicVolume');
                if (musicSlider) {
                    const originalVolume = this.channels.music;
                    musicSlider.value = originalVolume * 0.3; // Reduzir para 30%
                    
                    setTimeout(() => {
                        musicSlider.value = originalVolume; // Restaurar após 3 segundos
                    }, 3000);
                }
            },
            
            loadSettings() {
                const saved = localStorage.getItem('aurora-mixer');
                if (saved) {
                    this.channels = JSON.parse(saved);
                    
                    // Aplicar aos sliders
                    Object.keys(this.channels).forEach(channel => {
                        const slider = document.getElementById(`${channel}Volume`);
                        if (slider) {
                            slider.value = this.channels[channel];
                        }
                    });
                }
            }
        };

        // === EVENTOS DE PRÓXIMOS 24H (MOCK DATA) ===
        window.getNext24HourEvents = function() {
            return [
                {
                    time: '14:30',
                    description: '🌙 Lua entra em Áries - Energia de iniciativa'
                },
                {
                    time: '18:45',
                    description: '♀ Vênus sextil Júpiter - Harmonia e abundância'
                },
                {
                    time: '22:15',
                    description: '☿ Mercúrio trígono Saturno - Comunicação estruturada'
                },
                {
                    time: '02:30',
                    description: '🌙 Lua fora de curso até 08:20'
                }
            ];
        };

        // === SISTEMA DE VOLUME ESTILO WINDOWS ME ===
        window.toggleVolumePopup = function() {
            const popup = document.getElementById('volumePopup');
            popup.classList.toggle('show');
        };

        window.hideVolumePopup = function() {
            const popup = document.getElementById('volumePopup');
            popup.classList.remove('show');
        };

        // === CONTROLES DE VOLUME ===
        const volumeSystem = {
            afast: 75,
            system: 50,
            
            updateVolume(channel, value) {
                this[channel] = value;
                localStorage.setItem('aurora-volumes', JSON.stringify({
                    afast: this.afast,
                    system: this.system
                }));
                
                // Atualizar display
                const valueDisplay = document.getElementById(`${channel}VolumeValue`);
                if (valueDisplay) {
                    valueDisplay.textContent = `${value}%`;
                }
                
                // Atualizar ícone baseado no volume
                this.updateVolumeIcon();
            },
            
            updateVolumeIcon() {
                const icon = document.getElementById('volumeIcon');
                const maxVolume = Math.max(this.afast, this.system);
                
                if (maxVolume === 0) {
                    icon.textContent = '🔇'; // Mudo
                } else if (maxVolume < 30) {
                    icon.textContent = '🔈'; // Baixo
                } else if (maxVolume < 70) {
                    icon.textContent = '🔉'; // Médio
                } else {
                    icon.textContent = '🔊'; // Alto
                }
            },
            
            testAfast() {
                if (window.msnSystem) {
                    msnSystem.showNotification(
                        '🎤 Teste AFÁST!',
                        `Volume da narradora: ${this.afast}%. Bem-vindo ao Aurora OS!`,
                        'test'
                    );
                    
                    // Síntese de voz
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(
                            `Teste do AFÁST! Volume em ${this.afast} por cento.`
                        );
                        utterance.lang = 'pt-BR';
                        utterance.rate = 0.9;
                        utterance.pitch = 1.1;
                        utterance.volume = this.afast / 100;
                        speechSynthesis.speak(utterance);
                    }
                }
            },
            
            testSystem() {
                if (window.msnSystem) {
                    msnSystem.showNotification(
                        '🔊 Teste Sistema',
                        `Volume do sistema: ${this.system}%. Som de teste reproduzido.`,
                        'test'
                    );
                }
                
                // Simular som do sistema (beep)
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    gainNode.gain.value = (this.system / 100) * 0.1;
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                } catch (e) {
                    console.log('Audio context não disponível');
                }
            },
            
            loadSettings() {
                const saved = localStorage.getItem('aurora-volumes');
                if (saved) {
                    const volumes = JSON.parse(saved);
                    this.afast = volumes.afast || 75;
                    this.system = volumes.system || 50;
                    
                    // Aplicar aos sliders
                    const afastSlider = document.getElementById('afastVolumeSlider');
                    const systemSlider = document.getElementById('systemVolumeSlider');
                    
                    if (afastSlider) {
                        afastSlider.value = this.afast;
                        this.updateVolume('afast', this.afast);
                    }
                    
                    if (systemSlider) {
                        systemSlider.value = this.system;
                        this.updateVolume('system', this.system);
                    }
                }
                
                this.updateVolumeIcon();
            }
        };

        // === MIXER AVANÇADO 4 CANAIS ===
        const advancedMixer = {
            channels: {
                narrator: 75,
                music: 60,
                sfx: 50,
                rituals: 40
            },
            
            originalMusicVolume: 60,
            isDucking: false,
            
            updateChannel(channel, value) {
                this.channels[channel] = value;
                
                // Atualizar display
                const valueDisplay = document.getElementById(`${channel}Value`);
                if (valueDisplay) {
                    valueDisplay.textContent = `${value}%`;
                }
                
                // Salvar configurações
                this.saveSettings();
                
                // Aplicar ducking se necessário
                if (channel === 'music') {
                    this.originalMusicVolume = value;
                }
                
                console.log(`🎛️ ${channel}: ${value}%`);
            },
            
            applyDucking() {
                if (!this.isDucking) {
                    this.isDucking = true;
                    
                    // Reduzir música para 20% do volume original
                    const duckedVolume = Math.floor(this.originalMusicVolume * 0.2);
                    const musicSlider = document.getElementById('musicSlider');
                    const musicValue = document.getElementById('musicValue');
                    
                    if (musicSlider && musicValue) {
                        musicSlider.value = duckedVolume;
                        musicValue.textContent = `${duckedVolume}%`;
                    }
                    
                    // Mostrar indicador
                    const indicator = document.getElementById('duckingIndicator');
                    if (indicator) {
                        indicator.classList.add('active');
                    }
                    
                    console.log('🎤 Ducking ativado - Música reduzida');
                }
            },
            
            removeDucking() {
                if (this.isDucking) {
                    this.isDucking = false;
                    
                    // Restaurar volume original da música
                    const musicSlider = document.getElementById('musicSlider');
                    const musicValue = document.getElementById('musicValue');
                    
                    if (musicSlider && musicValue) {
                        musicSlider.value = this.originalMusicVolume;
                        musicValue.textContent = `${this.originalMusicVolume}%`;
                    }
                    
                    // Ocultar indicador
                    const indicator = document.getElementById('duckingIndicator');
                    if (indicator) {
                        indicator.classList.remove('active');
                    }
                    
                    console.log('🎵 Ducking removido - Música restaurada');
                }
            },
            
            testNarrator() {
                // Aplicar ducking
                this.applyDucking();
                
                // Síntese de voz
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(
                        `Teste do mixer avançado. Volume da narradora em ${this.channels.narrator} por cento.`
                    );
                    utterance.lang = 'pt-BR';
                    utterance.rate = 0.9;
                    utterance.pitch = 1.1;
                    utterance.volume = this.channels.narrator / 100;
                    
                    utterance.onend = () => {
                        // Remover ducking após fala
                        setTimeout(() => this.removeDucking(), 500);
                    };
                    
                    speechSynthesis.speak(utterance);
                }
                
                // Notificação visual
                if (window.msnSystem) {
                    msnSystem.showNotification(
                        '🎤 Teste Narradora',
                        `Volume: ${this.channels.narrator}% | Ducking ativo`,
                        'test'
                    );
                }
            },
            
            saveSettings() {
                localStorage.setItem('aurora-advanced-mixer', JSON.stringify({
                    channels: this.channels,
                    originalMusicVolume: this.originalMusicVolume
                }));
            },
            
            loadSettings() {
                const saved = localStorage.getItem('aurora-advanced-mixer');
                if (saved) {
                    const settings = JSON.parse(saved);
                    this.channels = { ...this.channels, ...settings.channels };
                    this.originalMusicVolume = settings.originalMusicVolume || 60;
                    
                    // Aplicar aos sliders
                    Object.keys(this.channels).forEach(channel => {
                        const slider = document.getElementById(`${channel}Slider`);
                        const value = document.getElementById(`${channel}Value`);
                        
                        if (slider && value) {
                            slider.value = this.channels[channel];
                            value.textContent = `${this.channels[channel]}%`;
                        }
                    });
                }
            }
        };

        // === FUNÇÕES DE CONTROLE DE MODO E DENSIDADE ===
        window.setDisplayMode = function(mode) {
            document.body.className = document.body.className.replace(/size-\w+/g, '');
            document.body.classList.add(`size-${mode}`);
            localStorage.setItem('aurora-display-mode', mode);
            console.log(`📐 Modo de exibição: ${mode}`);
        };

        window.setDensity = function(density) {
            document.body.className = document.body.className.replace(/density-\w+/g, '');
            document.body.classList.add(`density-${density}`);
            localStorage.setItem('aurora-density', density);
            console.log(`📏 Densidade: ${density}`);
        };

        window.toggleQuickCenter = function() {
            const quickCenter = document.getElementById('quickCenter');
            if (quickCenter) {
                quickCenter.classList.toggle('show');
                console.log('⚡ Centro Rápido alternado');
            }
        };

        // === EXPORT ICS ===
        window.exportToICS = function(events) {
            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Aurora OS//MysticSoft//PT',
                'CALSCALE:GREGORIAN',
                ...events.map(event => [
                    'BEGIN:VEVENT',
                    `DTSTART:${new Date().toISOString().replace(/[-:]/g, '').split('.')[0]}Z`,
                    `SUMMARY:${event.description}`,
                    `DESCRIPTION:Evento astrológico do Aurora OS • MysticSoft`,
                    'END:VEVENT'
                ]).flat(),
                'END:VCALENDAR'
            ].join('\r\n');
            
            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'eventos-astrologicos.ics';
            a.click();
            URL.revokeObjectURL(url);
        };

        // Configurar eventos quando DOM estiver pronto
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar modo XL e densidade
            const savedMode = localStorage.getItem('aurora-display-mode');
            const savedDensity = localStorage.getItem('aurora-density');
            
            if (savedMode) setDisplayMode(savedMode);
            if (savedDensity) setDensity(savedDensity);
            else setDensity('spacious'); // Padrão espaçoso
            
            // Ativar modo XL e densidade espaçosa por padrão
            setDisplayMode('xl');
            setDensity('spacious');
            
            // Carregar configurações do mixer avançado
            advancedMixer.loadSettings();
            
            // === EVENT LISTENERS PARA MIXER AVANÇADO ===
            // Sliders do mixer
            document.getElementById('narratorSlider')?.addEventListener('input', function() {
                advancedMixer.updateChannel('narrator', parseInt(this.value));
            });
            
            document.getElementById('musicSlider')?.addEventListener('input', function() {
                advancedMixer.updateChannel('music', parseInt(this.value));
            });
            
            document.getElementById('sfxSlider')?.addEventListener('input', function() {
                advancedMixer.updateChannel('sfx', parseInt(this.value));
            });
            
            document.getElementById('ritualsSlider')?.addEventListener('input', function() {
                advancedMixer.updateChannel('rituals', parseInt(this.value));
            });
            
            // Toggles do Centro Rápido
            document.querySelectorAll('.quick-toggle').forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const toggleType = this.dataset.toggle;
                    
                    // Toggle visual
                    this.classList.toggle('active');
                    
                    switch(toggleType) {
                        case 'afast':
                            console.log('🛡️ AFÁST! alternado');
                            break;
                        case 'dnd':
                            console.log('🔕 Não Perturbar alternado');
                            break;
                        case 'quiet':
                            console.log('🌙 Horas Silenciosas alternado');
                            break;
                        case 'theme':
                            console.log('☉ Tema alternado');
                            break;
                    }
                });
            });
            
            // === EVENT LISTENERS PARA POPUP DE VOLUME ===
            document.getElementById('volumeIcon')?.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleVolumePopup();
            });
            
            // Fechar popup ao clicar fora
            document.addEventListener('click', function(e) {
                const popup = document.getElementById('volumePopup');
                const icon = document.getElementById('volumeIcon');
                
                if (popup && !popup.contains(e.target) && e.target !== icon) {
                    hideVolumePopup();
                }
            });
            
            // Sliders de volume
            document.getElementById('afastVolumeSlider')?.addEventListener('input', function() {
                volumeSystem.updateVolume('afast', parseInt(this.value));
            });
            
            document.getElementById('systemVolumeSlider')?.addEventListener('input', function() {
                volumeSystem.updateVolume('system', parseInt(this.value));
            });
            
            // Botões de teste
            document.getElementById('testAfastBtn')?.addEventListener('click', function() {
                volumeSystem.testAfast();
            });
            
            document.getElementById('testSystemBtn')?.addEventListener('click', function() {
                volumeSystem.testSystem();
            });
            
            // Carregar configurações de volume
            volumeSystem.loadSettings();
            
            // === EVENT LISTENERS PARA CHIPS VIVOS ===
            document.getElementById('moonPhaseChip')?.addEventListener('click', function(e) {
                const events = getNext24HourEvents().filter(event => 
                    event.description.includes('🌙')
                );
                showPopover(this, '🌙 Eventos Lunares', '', events);
            });
            
            document.getElementById('mercuryChip')?.addEventListener('click', function(e) {
                const events = [
                    { time: 'Até 15/09', description: '☿ Mercúrio Retrógrado em Virgem' },
                    { time: '15/09', description: '☿ Mercúrio direto - Comunicação normalizada' }
                ];
                showPopover(this, '☿ Mercúrio Retrógrado', '', events);
            });
            
            document.getElementById('vocChip')?.addEventListener('click', function(e) {
                const events = [
                    { time: '23:45', description: '🌙 Fim da Lua Fora de Curso' },
                    { time: '23:46', description: '🌙 Lua entra em Áries' }
                ];
                showPopover(this, '🌙 Lua Fora de Curso', '', events);
            });
            
            // === EVENT LISTENERS PARA CENTRO RÁPIDO ===
            document.getElementById('dayRing')?.addEventListener('click', function(e) {
                toggleQuickCenter();
            });
            
            // Toggles do Centro Rápido
            document.querySelectorAll('.quick-toggle').forEach(toggle => {
                toggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const toggleType = this.dataset.toggle;
                    
                    switch(toggleType) {
                        case 'afast':
                            // Toggle AFÁST!
                            break;
                        case 'dnd':
                            // Toggle Não Perturbar
                            break;
                        case 'quiet':
                            // Toggle Horas Silenciosas
                            break;
                        case 'theme':
                            // Toggle Tema
                            break;
                    }
                });
            });
            
            // === EVENT LISTENERS PARA MIXER ===
            document.querySelectorAll('.mixer-channel input[type="range"]').forEach(slider => {
                slider.addEventListener('input', function() {
                    const channel = this.id.replace('Volume', '');
                    audioMixer.setVolume(channel, parseInt(this.value));
                });
            });
            
            // === EVENT LISTENERS PARA PALETA DE COMANDOS ===
            document.addEventListener('keydown', function(e) {
                // Ctrl+K para abrir paleta de comandos
                if (e.ctrlKey && e.key === 'k') {
                    e.preventDefault();
                    showCommandPalette();
                }
                
                // Esc para fechar popovers e paleta
                if (e.key === 'Escape') {
                    hideCommandPalette();
                    hidePopover();
                    
                    // Fechar Centro Rápido
                    const quickCenter = document.getElementById('quickCenter');
                    quickCenter?.classList.remove('show');
                }
            });
            
            // Processar comandos na paleta
            document.getElementById('commandInput')?.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const command = this.value.toLowerCase().trim();
                    this.value = '';
                    
                    if (magicCommands[command]) {
                        magicCommands[command]();
                        hideCommandPalette();
                    } else {
                        // Buscar aplicações
                        if (command.includes('astro')) {
                            openApp('astromagick');
                            hideCommandPalette();
                        } else if (command.includes('player') || command.includes('música')) {
                            openApp('aurora-player');
                            hideCommandPalette();
                        } else if (command.includes('tv') || command.includes('witch')) {
                            openApp('witch-tv');
                            hideCommandPalette();
                        }
                    }
                }
            });
            
            // === SISTEMA DE VOLUME ESTILO WINDOWS ME ===
        window.toggleVolumePopup = function() {
            const popup = document.getElementById('volumePopup');
            popup.classList.toggle('show');
        };

        window.hideVolumePopup = function() {
            const popup = document.getElementById('volumePopup');
            popup.classList.remove('show');
        };

        // === CONTROLES DE VOLUME ===
        const volumeSystem = {
            afast: 75,
            system: 50,
            
            updateVolume(channel, value) {
                this[channel] = value;
                localStorage.setItem('aurora-volumes', JSON.stringify({
                    afast: this.afast,
                    system: this.system
                }));
                
                // Atualizar display
                const valueDisplay = document.getElementById(`${channel}VolumeValue`);
                if (valueDisplay) {
                    valueDisplay.textContent = `${value}%`;
                }
                
                // Atualizar ícone baseado no volume
                this.updateVolumeIcon();
            },
            
            updateVolumeIcon() {
                const icon = document.getElementById('volumeIcon');
                const maxVolume = Math.max(this.afast, this.system);
                
                if (maxVolume === 0) {
                    icon.textContent = '🔇'; // Mudo
                } else if (maxVolume < 30) {
                    icon.textContent = '🔈'; // Baixo
                } else if (maxVolume < 70) {
                    icon.textContent = '🔉'; // Médio
                } else {
                    icon.textContent = '🔊'; // Alto
                }
            },
            
            testAfast() {
                if (window.msnSystem) {
                    msnSystem.showNotification(
                        '🎤 Teste AFÁST!',
                        `Volume da narradora: ${this.afast}%. Bem-vindo ao Aurora OS!`,
                        'test'
                    );
                    
                    // Síntese de voz
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(
                            `Teste do AFÁST! Volume em ${this.afast} por cento.`
                        );
                        utterance.lang = 'pt-BR';
                        utterance.rate = 0.9;
                        utterance.pitch = 1.1;
                        utterance.volume = this.afast / 100;
                        speechSynthesis.speak(utterance);
                    }
                }
            },
            
            testSystem() {
                if (window.msnSystem) {
                    msnSystem.showNotification(
                        '🔊 Teste Sistema',
                        `Volume do sistema: ${this.system}%. Som de teste reproduzido.`,
                        'test'
                    );
                }
                
                // Simular som do sistema (beep)
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    gainNode.gain.value = (this.system / 100) * 0.1;
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
                } catch (e) {
                    console.log('Audio context não disponível');
                }
            },
            
            loadSettings() {
                const saved = localStorage.getItem('aurora-volumes');
                if (saved) {
                    const volumes = JSON.parse(saved);
                    this.afast = volumes.afast || 75;
                    this.system = volumes.system || 50;
                    
                    // Aplicar aos sliders
                    const afastSlider = document.getElementById('afastVolumeSlider');
                    const systemSlider = document.getElementById('systemVolumeSlider');
                    
                    if (afastSlider) {
                        afastSlider.value = this.afast;
                        this.updateVolume('afast', this.afast);
                    }
                    
                    if (systemSlider) {
                        systemSlider.value = this.system;
                        this.updateVolume('system', this.system);
                    }
                }
                
                this.updateVolumeIcon();
            }
        };

        // === MIXER AVANÇADO 4 CANAIS ===
        const advancedMixer = {
            channels: {
                narrator: 75,
                music: 60,
                sfx: 50,
                rituals: 40
            },
            
            originalMusicVolume: 60,
            isDucking: false,
            
            updateChannel(channel, value) {
                this.channels[channel] = value;
                
                // Atualizar display
                const valueDisplay = document.getElementById(`${channel}Value`);
                if (valueDisplay) {
                    valueDisplay.textContent = `${value}%`;
                }
                
                // Salvar configurações
                this.saveSettings();
                
                // Aplicar ducking se necessário
                if (channel === 'music') {
                    this.originalMusicVolume = value;
                }
                
                console.log(`🎛️ ${channel}: ${value}%`);
            },
            
            applyDucking() {
                if (!this.isDucking) {
                    this.isDucking = true;
                    
                    // Reduzir música para 20% do volume original
                    const duckedVolume = Math.floor(this.originalMusicVolume * 0.2);
                    const musicSlider = document.getElementById('musicSlider');
                    const musicValue = document.getElementById('musicValue');
                    
                    if (musicSlider && musicValue) {
                        musicSlider.value = duckedVolume;
                        musicValue.textContent = `${duckedVolume}%`;
                    }
                    
                    // Mostrar indicador
                    const indicator = document.getElementById('duckingIndicator');
                    if (indicator) {
                        indicator.classList.add('active');
                    }
                    
                    console.log('🎤 Ducking ativado - Música reduzida');
                }
            },
            
            removeDucking() {
                if (this.isDucking) {
                    this.isDucking = false;
                    
                    // Restaurar volume original da música
                    const musicSlider = document.getElementById('musicSlider');
                    const musicValue = document.getElementById('musicValue');
                    
                    if (musicSlider && musicValue) {
                        musicSlider.value = this.originalMusicVolume;
                        musicValue.textContent = `${this.originalMusicVolume}%`;
                    }
                    
                    // Ocultar indicador
                    const indicator = document.getElementById('duckingIndicator');
                    if (indicator) {
                        indicator.classList.remove('active');
                    }
                    
                    console.log('🎵 Ducking removido - Música restaurada');
                }
            },
            
            testNarrator() {
                // Aplicar ducking
                this.applyDucking();
                
                // Síntese de voz
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(
                        `Teste do mixer avançado. Volume da narradora em ${this.channels.narrator} por cento.`
                    );
                    utterance.lang = 'pt-BR';
                    utterance.rate = 0.9;
                    utterance.pitch = 1.1;
                    utterance.volume = this.channels.narrator / 100;
                    
                    utterance.onend = () => {
                        // Remover ducking após fala
                        setTimeout(() => this.removeDucking(), 500);
                    };
                    
                    speechSynthesis.speak(utterance);
                }
                
                // Notificação visual
                if (window.msnSystem) {
                    msnSystem.showNotification(
                        '🎤 Teste Narradora',
                        `Volume: ${this.channels.narrator}% | Ducking ativo`,
                        'test'
                    );
                }
            },
            
            saveSettings() {
                localStorage.setItem('aurora-advanced-mixer', JSON.stringify({
                    channels: this.channels,
                    originalMusicVolume: this.originalMusicVolume
                }));
            },
            
            loadSettings() {
                const saved = localStorage.getItem('aurora-advanced-mixer');
                if (saved) {
                    const settings = JSON.parse(saved);
                    this.channels = { ...this.channels, ...settings.channels };
                    this.originalMusicVolume = settings.originalMusicVolume || 60;
                    
                    // Aplicar aos sliders
                    Object.keys(this.channels).forEach(channel => {
                        const slider = document.getElementById(`${channel}Slider`);
                        const value = document.getElementById(`${channel}Value`);
                        
                        if (slider && value) {
                            slider.value = this.channels[channel];
                            value.textContent = `${this.channels[channel]}%`;
                        }
                    });
                }
            }
        };

        // === FUNÇÕES DE CONTROLE DE MODO E DENSIDADE ===
        window.setDisplayMode = function(mode) {
            document.body.className = document.body.className.replace(/size-\w+/g, '');
            document.body.classList.add(`size-${mode}`);
            localStorage.setItem('aurora-display-mode', mode);
            console.log(`📐 Modo de exibição: ${mode}`);
        };

        window.setDensity = function(density) {
            document.body.className = document.body.className.replace(/density-\w+/g, '');
            document.body.classList.add(`density-${density}`);
            localStorage.setItem('aurora-density', density);
            console.log(`📏 Densidade: ${density}`);
        };

        window.toggleQuickCenter = function() {
            const quickCenter = document.getElementById('quickCenter');
            if (quickCenter) {
                quickCenter.classList.toggle('show');
                console.log('⚡ Centro Rápido alternado');
            }
        };

        // === EXPORT ICS ===
            document.getElementById('exportIcsBtn')?.addEventListener('click', function() {
                const events = getNext24HourEvents();
                exportToICS(events);
                hidePopover();
            });
            
            // === INICIALIZAR HORA PLANETÁRIA ===
            const now = new Date();
            const endOfHour = new Date(now.getTime() + (60 * 60 * 1000)); // +1 hora
            
            setHoraPlanetaria({
                inicio: now.toISOString(),
                fim: endOfHour.toISOString(),
                planeta: 'Sol',
                simbolo: '☉'
            });
            
            // === ATUALIZAR CHIPS COM DADOS DINÂMICOS ===
            setTimeout(() => {
                updateAstroChip('moonPhaseChip', {
                    text: 'Minguante',
                    tooltip: 'Lua Minguante - Tempo de liberação e limpeza'
                });
                
                updateAstroChip('mercuryChip', {
                    text: 'R',
                    critical: true,
                    tooltip: 'Mercúrio Retrógrado até 15/09 - Revise comunicações'
                });
                
                updateAstroChip('vocChip', {
                    text: 'até 23:45',
                    tooltip: 'Lua Fora de Curso - Evite decisões importantes'
                });
            }, 1000);
            
            // === TESTE DE FUNCIONALIDADES ===
            window.TEST_ADVANCED = {
                xl: () => setDisplayMode('xl'),
                density: (type) => setDensity(type),
                quickCenter: () => toggleQuickCenter(),
                palette: () => showCommandPalette(),
                hour: () => {
                    const now = new Date();
                    const end = new Date(now.getTime() + 10000); // 10 segundos para teste
                    setHoraPlanetaria({
                        inicio: now.toISOString(),
                        fim: end.toISOString(),
                        planeta: 'Mercúrio',
                        simbolo: '☿'
                    });
                },
                mixer: () => audioMixer.applyDucking()
            };
            
            console.log('🌟 Aurora OS • MysticSoft - Funcionalidades Avançadas Carregadas!');
            console.log('📋 Testes disponíveis:', Object.keys(window.TEST_ADVANCED));
        });
            console.log('🌟 Inicializando Aurora OS...');
            
            // Inicializar sistema principal
            if (typeof AuroraOS !== 'undefined') {
                window.auroraOS = new AuroraOS();
            }
            
            // Inicializar sistema AFÁST! de alertas
            setTimeout(() => {
                startAFASTAlerts();
            }, 8000); // Iniciar após 8 segundos
            
            // Configurar botão Iniciar
            const startButton = document.getElementById('start-button');
            if (startButton) {
                startButton.addEventListener('click', () => {
                    showMysticStartMenu();
                });
            }
            
            // Configurar clique no relógio para abrir calendário astrológico
            const clock = document.getElementById('clock');
            if (clock) {
                clock.addEventListener('click', () => {
                    openAstrologicalCalendar();
                });
                clock.style.cursor = 'pointer';
            }
            
            // Configurar clique no ícone planetário
            const planetaryIcon = document.getElementById('planetary-icon');
            if (planetaryIcon) {
                planetaryIcon.addEventListener('click', () => {
                    openAstrologicalCalendar();
                });
            }
            
            console.log('🌟 Aurora OS inicializado com sucesso!');
            
            // Inicializar AFÁST! para notificações (mesmo sem janela aberta)
            setTimeout(() => {
                if (typeof AFASTApp !== 'undefined') {
                    window.afastApp = new AFASTApp();
                }
                
                // Mostrar notificação de boas-vindas
                setTimeout(() => {
                    window.msnSystem.showAstrologicalAlert(
                        'Sistema AFÁST! Ativado',
                        'Monitoramento astrológico iniciado com sucesso.'
                    );
                }, 2000);
                
                // Simular alertas astrológicos periódicos
                setInterval(() => {
                    const alerts = [
                        {
                            title: 'Mercúrio Retrógrado Detectado',
                            message: 'Cuidado com comunicações e tecnologia.',
                            type: 'planetary'
                        },
                        {
                            title: 'Lua Cheia Aproximando',
                            message: 'Energia intensa nas próximas 48 horas.',
                            type: 'lunar'
                        },
                        {
                            title: 'Aspecto Tenso Marte-Saturno',
                            message: 'Evite conflitos e seja paciente.',
                            type: 'threat'
                        },
                        {
                            title: 'Vênus em Trígono com Júpiter',
                            message: 'Momento favorável para relacionamentos.',
                            type: 'astrological'
                        }
                    ];
                    
                    if (Math.random() < 0.4) { // 40% de chance a cada intervalo
                        const alert = alerts[Math.floor(Math.random() * alerts.length)];
                        
                        switch(alert.type) {
                            case 'planetary':
                                msnSystem.showPlanetaryAlert(alert.title, alert.message);
                                break;
                            case 'lunar':
                                msnSystem.showLunarAlert(alert.title, alert.message);
                                break;
                            case 'threat':
                                msnSystem.showThreatAlert(alert.title, alert.message);
                                break;
                            default:
                                msnSystem.showAstrologicalAlert(alert.title, alert.message);
                        }
                    }
                }, 25000); // A cada 25 segundos
            }, 3000);
        });

        // === FUNÇÕES DE WALLPAPER ===
        function showDesktopMenu(event) {
            event.preventDefault();
            const menu = document.getElementById('desktop-context-menu');
            menu.style.display = 'block';
            menu.style.left = event.clientX + 'px';
            menu.style.top = event.clientY + 'px';
            
            // Fechar menu ao clicar fora
            document.addEventListener('click', hideDesktopMenu);
        }

        function hideDesktopMenu() {
            document.getElementById('desktop-context-menu').style.display = 'none';
            document.removeEventListener('click', hideDesktopMenu);
        }

        function showWallpaperMenu() {
            hideDesktopMenu();
            document.getElementById('wallpaper-menu').style.display = 'block';
        }

        function closeWallpaperMenu() {
            document.getElementById('wallpaper-menu').style.display = 'none';
        }

        function changeWallpaper(wallpaperType) {
            const desktop = document.getElementById('desktop');
            
            // Remover classes de wallpaper existentes
            const wallpaperClasses = [
                'wallpaper-azul-mistico', 'wallpaper-roxo-cosmico', 'wallpaper-aurora-verde',
                'wallpaper-por-do-sol', 'wallpaper-espaco-profundo', 'wallpaper-prata-lunar',
                'wallpaper-fogo-mistico', 'wallpaper-oceano-profundo', 'wallpaper-floresta-encantada',
                'wallpaper-ametista', 'wallpaper-ouro-alquimico', 'wallpaper-cristal-azul',
                'wallpaper-nebulosa-rosa', 'wallpaper-terra-mistica', 'wallpaper-aurora-boreal',
                'wallpaper-vinho-gotico'
            ];
            
            wallpaperClasses.forEach(cls => desktop.classList.remove(cls));
            
            // Adicionar nova classe de wallpaper
            desktop.classList.add(`wallpaper-${wallpaperType}`);
            
            // Salvar preferência no localStorage
            localStorage.setItem('aurora-wallpaper', wallpaperType);
            
            // Fechar menu
            closeWallpaperModal();
            
            // Mostrar notificação
            showNotification('🖼️ Plano de fundo alterado com sucesso!');
        }

        function showDesktopProperties() {
            hideDesktopMenu();
            showNotification('⚙️ Propriedades do Desktop - Em desenvolvimento');
        }

        function refreshDesktop() {
            hideDesktopMenu();
            showNotification('🔄 Desktop atualizado');
        }

        // Carregar wallpaper salvo
        function loadSavedWallpaper() {
            const savedWallpaper = localStorage.getItem('aurora-wallpaper');
            if (savedWallpaper) {
                changeWallpaper(savedWallpaper);
            }
        }

        // === INTEGRAÇÃO AVANÇADA POPOVERS + AFÁST! ===
        
        // Sistema de Narração Inteligente
        class AFASTAstroNarrator {
            constructor() {
                this.isNarrating = false;
                this.currentContext = null;
                this.voiceSettings = {
                    rate: 0.9,
                    pitch: 1.1,
                    volume: 0.8
                };
                this.eventPhrases = {
                    mercury: {
                        opening: "Mercúrio Retrógrado detectado. Analisando impactos astrológicos...",
                        warning: "Atenção: Alto risco para comunicações e tecnologia.",
                        advice: "Recomendo revisar contratos e fazer backup de dados importantes.",
                        timeline: "Mercúrio retorna ao movimento direto em 15 de setembro."
                    },
                    moon: {
                        opening: "Fase Lunar Minguante ativa. Energia de liberação em curso...",
                        advice: "Momento ideal para limpeza energética e liberação de padrões antigos.",
                        timeline: "Lua Nova aproximando-se em 28 de setembro para novos começos."
                    },
                    voc: {
                        opening: "Lua Fora de Curso detectada. Período de cautela ativado...",
                        warning: "Evite tomar decisões importantes até às 23:45.",
                        advice: "Use este tempo para reflexão e planejamento."
                    }
                };
            }
            
            async narratePopoverOpening(eventType) {
                if (this.isNarrating) return;
                
                this.isNarrating = true;
                this.currentContext = eventType;
                
                const phrases = this.eventPhrases[eventType];
                if (!phrases) return;
                
                // Reduzir volume da música (ducking)
                this.activateDucking();
                
                // Narração sequencial
                await this.speak(phrases.opening);
                await this.delay(500);
                
                if (phrases.warning) {
                    await this.speak(phrases.warning);
                    await this.delay(300);
                }
                
                if (phrases.advice) {
                    await this.speak(phrases.advice);
                    await this.delay(300);
                }
                
                if (phrases.timeline) {
                    await this.speak(phrases.timeline);
                }
                
                // Restaurar volume da música
                this.deactivateDucking();
                this.isNarrating = false;
            }
            
            async speak(text) {
                return new Promise((resolve) => {
                    if ('speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.rate = this.voiceSettings.rate;
                        utterance.pitch = this.voiceSettings.pitch;
                        utterance.volume = this.voiceSettings.volume;
                        utterance.lang = 'pt-BR';
                        
                        utterance.onend = resolve;
                        utterance.onerror = resolve;
                        
                        speechSynthesis.speak(utterance);
                    } else {
                        resolve();
                    }
                });
            }
            
            activateDucking() {
                const musicSlider = document.getElementById('musicVolume');
                const sfxSlider = document.getElementById('sfxVolume');
                
                if (musicSlider) {
                    musicSlider.dataset.originalValue = musicSlider.value;
                    musicSlider.value = Math.max(20, musicSlider.value * 0.3);
                    musicSlider.dispatchEvent(new Event('input'));
                }
                
                if (sfxSlider) {
                    sfxSlider.dataset.originalValue = sfxSlider.value;
                    sfxSlider.value = Math.max(15, sfxSlider.value * 0.2);
                    sfxSlider.dispatchEvent(new Event('input'));
                }
                
                // Mostrar indicador visual
                this.showDuckingIndicator();
            }
            
            deactivateDucking() {
                const musicSlider = document.getElementById('musicVolume');
                const sfxSlider = document.getElementById('sfxVolume');
                
                if (musicSlider && musicSlider.dataset.originalValue) {
                    musicSlider.value = musicSlider.dataset.originalValue;
                    musicSlider.dispatchEvent(new Event('input'));
                    delete musicSlider.dataset.originalValue;
                }
                
                if (sfxSlider && sfxSlider.dataset.originalValue) {
                    sfxSlider.value = sfxSlider.dataset.originalValue;
                    sfxSlider.dispatchEvent(new Event('input'));
                    delete sfxSlider.dataset.originalValue;
                }
                
                // Ocultar indicador visual
                this.hideDuckingIndicator();
            }
            
            showDuckingIndicator() {
                const indicator = document.getElementById('duckingIndicator');
                if (indicator) {
                    indicator.classList.add('active');
                    indicator.textContent = '🎤 AFÁST! narrando - Áudio reduzido';
                }
            }
            
            hideDuckingIndicator() {
                const indicator = document.getElementById('duckingIndicator');
                if (indicator) {
                    indicator.classList.remove('active');
                }
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // Sistema de Comandos de Voz
        class AFASTVoiceCommands {
            constructor(narrator) {
                this.narrator = narrator;
                this.isListening = false;
                this.recognition = null;
                this.commands = {
                    'quando termina mercúrio retrógrado': () => this.answerMercuryEnd(),
                    'quando é a próxima lua nova': () => this.answerNextNewMoon(),
                    'criar lembrete mercúrio': () => this.createMercuryReminder(),
                    'criar lembrete lua nova': () => this.createMoonReminder(),
                    'mostrar eventos astrológicos': () => this.showAstroEvents(),
                    'fechar popover': () => this.closeAllPopovers(),
                    'ativar alertas': () => this.enableAlerts(),
                    'desativar alertas': () => this.disableAlerts()
                };
                this.initSpeechRecognition();
            }
            
            initSpeechRecognition() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new webkitSpeechRecognition();
                    this.recognition.continuous = true;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'pt-BR';
                    
                    this.recognition.onresult = (event) => {
                        const command = event.results[event.results.length - 1][0].transcript.toLowerCase().trim();
                        this.processCommand(command);
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.log('Erro no reconhecimento de voz:', event.error);
                    };
                }
            }
            
            startListening() {
                if (this.recognition && !this.isListening) {
                    this.recognition.start();
                    this.isListening = true;
                    this.showListeningIndicator();
                }
            }
            
            stopListening() {
                if (this.recognition && this.isListening) {
                    this.recognition.stop();
                    this.isListening = false;
                    this.hideListeningIndicator();
                }
            }
            
            processCommand(command) {
                console.log('Comando recebido:', command);
                
                // Buscar comando correspondente
                for (const [trigger, action] of Object.entries(this.commands)) {
                    if (command.includes(trigger)) {
                        action();
                        return;
                    }
                }
                
                // Comando não reconhecido
                this.narrator.speak('Comando não reconhecido. Tente: quando termina mercúrio retrógrado, criar lembrete, ou mostrar eventos.');
            }
            
            async answerMercuryEnd() {
                await this.narrator.speak('Mercúrio Retrógrado termina em 15 de setembro às 12 horas. Comunicações voltarão ao normal gradualmente.');
                showAdvancedPopover('advancedMercuryPopover', document.getElementById('mercuryRetroChip'));
            }
            
            async answerNextNewMoon() {
                await this.narrator.speak('A próxima Lua Nova será em 28 de setembro. Momento ideal para novos começos e manifestações.');
                showAdvancedPopover('advancedMoonPopover', document.getElementById('moonPhaseChip'));
            }
            
            createMercuryReminder() {
                createReminder('mercury');
                this.narrator.speak('Lembrete criado para o fim do Mercúrio Retrógrado em 15 de setembro.');
            }
            
            createMoonReminder() {
                createReminder('moon');
                this.narrator.speak('Lembrete criado para a Lua Nova em 28 de setembro.');
            }
            
            showAstroEvents() {
                // Abrir calendário astrológico
                const calendar = document.getElementById('astroCalendar');
                if (calendar) {
                    calendar.style.display = 'block';
                }
                this.narrator.speak('Exibindo calendário astrológico com próximos eventos importantes.');
            }
            
            closeAllPopovers() {
                document.querySelectorAll('.astro-popover-advanced.show').forEach(p => p.classList.remove('show'));
                this.narrator.speak('Popovers fechados.');
            }
            
            enableAlerts() {
                localStorage.setItem('afast-alerts-enabled', 'true');
                this.narrator.speak('Alertas astrológicos ativados. Você será notificado sobre eventos importantes.');
            }
            
            disableAlerts() {
                localStorage.setItem('afast-alerts-enabled', 'false');
                this.narrator.speak('Alertas astrológicos desativados.');
            }
            
            showListeningIndicator() {
                const indicator = document.createElement('div');
                indicator.id = 'voiceListeningIndicator';
                indicator.innerHTML = '🎤 Ouvindo comandos...';
                indicator.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: rgba(240,170,83,.9);
                    color: #000;
                    padding: 10px 15px;
                    border-radius: 20px;
                    font-size: 14px;
                    z-index: 10004;
                    animation: pulse 2s infinite;
                `;
                document.body.appendChild(indicator);
            }
            
            hideListeningIndicator() {
                const indicator = document.getElementById('voiceListeningIndicator');
                if (indicator) {
                    indicator.remove();
                }
            }
        }
        
        // Sistema de IA Astrológica
        class AFASTAstroAI {
            constructor(narrator) {
                this.narrator = narrator;
                this.userProfile = this.loadUserProfile();
                this.eventHistory = this.loadEventHistory();
                this.patterns = {
                    mercury_retrograde: {
                        frequency: 3, // vezes por ano
                        duration: 21, // dias
                        impact_areas: ['communication', 'technology', 'travel', 'contracts']
                    },
                    moon_phases: {
                        frequency: 4, // por mês
                        duration: 7, // dias cada fase
                        impact_areas: ['emotions', 'intuition', 'energy', 'manifestation']
                    }
                };
            }
            
            analyzeCurrentEvents() {
                const activeEvents = this.getCurrentActiveEvents();
                const recommendations = [];
                
                activeEvents.forEach(event => {
                    const analysis = this.analyzeEvent(event);
                    recommendations.push(...analysis.recommendations);
                });
                
                return recommendations;
            }
            
            analyzeEvent(event) {
                switch(event.type) {
                    case 'mercury_retrograde':
                        return {
                            risk_level: 'high',
                            recommendations: [
                                'Faça backup de dados importantes',
                                'Revise contratos antes de assinar',
                                'Evite comprar eletrônicos',
                                'Confirme compromissos por telefone'
                            ],
                            timing_advice: 'Evite iniciar projetos de comunicação'
                        };
                    
                    case 'moon_waning':
                        return {
                            risk_level: 'low',
                            recommendations: [
                                'Pratique limpeza energética',
                                'Libere padrões antigos',
                                'Organize e descarte o desnecessário',
                                'Medite sobre o que deseja liberar'
                            ],
                            timing_advice: 'Ideal para finalizar projetos'
                        };
                    
                    case 'void_of_course':
                        return {
                            risk_level: 'medium',
                            recommendations: [
                                'Evite decisões importantes',
                                'Use o tempo para reflexão',
                                'Não inicie novos projetos',
                                'Pratique atividades contemplativas'
                            ],
                            timing_advice: 'Aguarde para ações importantes'
                        };
                    
                    default:
                        return { risk_level: 'low', recommendations: [] };
                }
            }
            
            generateProactiveAlert(event) {
                const analysis = this.analyzeEvent(event);
                const userRelevance = this.calculateUserRelevance(event);
                
                if (userRelevance > 0.7) {
                    const alert = {
                        title: `AFÁST! Alerta Preventivo`,
                        message: this.generatePersonalizedMessage(event, analysis),
                        priority: analysis.risk_level,
                        actions: analysis.recommendations.slice(0, 2)
                    };
                    
                    this.scheduleAlert(alert, event.start_time - (2 * 60 * 60 * 1000)); // 2h antes
                }
            }
            
            generatePersonalizedMessage(event, analysis) {
                const messages = {
                    mercury_retrograde: `Mercúrio Retrógrado se aproxima. Com base no seu perfil, recomendo especial atenção a ${this.getUserPriorityAreas().join(' e ')}.`,
                    moon_waning: `Lua Minguante ativa. Momento ideal para suas práticas de ${this.getUserMoonPractices().join(' e ')}.`,
                    void_of_course: `Lua Fora de Curso detectada. Evite ${this.getUserVOCRisks().join(' e ')} até o período passar.`
                };
                
                return messages[event.type] || 'Evento astrológico detectado. Mantenha-se atento.';
            }
            
            calculateUserRelevance(event) {
                // Simular cálculo baseado no perfil do usuário
                const baseRelevance = 0.5;
                const profileBonus = this.userProfile.interests.includes(event.category) ? 0.3 : 0;
                const historyBonus = this.eventHistory.filter(h => h.type === event.type).length > 0 ? 0.2 : 0;
                
                return Math.min(1.0, baseRelevance + profileBonus + historyBonus);
            }
            
            getCurrentActiveEvents() {
                // Simular eventos ativos atuais
                return [
                    { type: 'mercury_retrograde', category: 'planetary', start_time: Date.now(), end_time: Date.now() + (5 * 24 * 60 * 60 * 1000) },
                    { type: 'moon_waning', category: 'lunar', start_time: Date.now(), end_time: Date.now() + (7 * 24 * 60 * 60 * 1000) }
                ];
            }
            
            getUserPriorityAreas() {
                return this.userProfile.priority_areas || ['comunicação', 'tecnologia'];
            }
            
            getUserMoonPractices() {
                return this.userProfile.moon_practices || ['meditação', 'limpeza energética'];
            }
            
            getUserVOCRisks() {
                return this.userProfile.voc_risks || ['decisões importantes', 'novos contratos'];
            }
            
            loadUserProfile() {
                const saved = localStorage.getItem('afast-user-profile');
                return saved ? JSON.parse(saved) : {
                    interests: ['planetary', 'lunar'],
                    priority_areas: ['comunicação', 'tecnologia', 'relacionamentos'],
                    moon_practices: ['meditação', 'limpeza energética', 'journaling'],
                    voc_risks: ['decisões importantes', 'novos contratos', 'compras grandes']
                };
            }
            
            loadEventHistory() {
                const saved = localStorage.getItem('afast-event-history');
                return saved ? JSON.parse(saved) : [];
            }
            
            saveUserProfile() {
                localStorage.setItem('afast-user-profile', JSON.stringify(this.userProfile));
            }
            
            saveEventHistory() {
                localStorage.setItem('afast-event-history', JSON.stringify(this.eventHistory));
            }
            
            scheduleAlert(alert, timestamp) {
                const delay = timestamp - Date.now();
                if (delay > 0) {
                    setTimeout(() => {
                        this.narrator.speak(alert.message);
                        showAFASTNotification(alert.title, alert.message);
                    }, delay);
                }
            }
        }
        
        // Instâncias globais dos sistemas integrados
        let afastNarrator, afastVoiceCommands, afastAstroAI;
        
        // Inicialização da integração
        function initializeAFASTIntegration() {
            afastNarrator = new AFASTAstroNarrator();
            afastVoiceCommands = new AFASTVoiceCommands(afastNarrator);
            afastAstroAI = new AFASTAstroAI(afastNarrator);
            
            console.log('🔮 Integração AFÁST! + Popovers inicializada!');
            
            // Analisar eventos atuais e gerar alertas proativos
            setTimeout(() => {
                const recommendations = afastAstroAI.analyzeCurrentEvents();
                if (recommendations.length > 0) {
                    afastNarrator.speak(`Análise astrológica concluída. ${recommendations.length} recomendações disponíveis.`);
                }
            }, 5000);
        }

        // === INTEGRAÇÃO COM POPOVERS EXISTENTES ===
        function showAdvancedPopover(popoverId, chipElement) {
            // Fechar outros popovers
            document.querySelectorAll('.astro-popover-advanced').forEach(p => {
                p.classList.remove('show');
            });
            
            const popover = document.getElementById(popoverId);
            if (!popover) return;
            
            // Determinar tipo de evento para narração
            let eventType = 'mercury';
            if (popoverId.includes('Moon')) eventType = 'moon';
            if (popoverId.includes('VOC')) eventType = 'voc';
            
            // Iniciar narração automática se AFÁST! estiver disponível
            if (typeof afastNarrator !== 'undefined') {
                setTimeout(() => {
                    afastNarrator.narratePopoverOpening(eventType);
                }, 500);
            }
            
            // Posicionar popover
            const rect = chipElement.getBoundingClientRect();
            const popoverWidth = 420;
            const popoverHeight = 600;
            
            let left = rect.left + (rect.width / 2) - (popoverWidth / 2);
            let top = rect.top - popoverHeight - 10;
            
            // Ajustar se sair da tela
            if (left < 10) left = 10;
            if (left + popoverWidth > window.innerWidth - 10) {
                left = window.innerWidth - popoverWidth - 10;
            }
            if (top < 10) {
                top = rect.bottom + 10;
            }
            
            popover.style.left = left + 'px';
            popover.style.top = top + 'px';
            popover.classList.add('show');
            
            // Animar barras de intensidade
            setTimeout(() => {
                const bars = popover.querySelectorAll('.intensity-fill');
                bars.forEach(bar => {
                    const width = bar.style.width || (bar.classList.contains('high') ? '90%' : 
                                  bar.classList.contains('medium') ? '65%' : '30%');
                    bar.style.width = '0%';
                    setTimeout(() => bar.style.width = width, 100);
                });
            }, 200);
        }
        
        function closeAdvancedPopover(popoverId) {
            const popover = document.getElementById(popoverId);
            if (popover) {
                popover.classList.remove('show');
            }
        }
        
        // === TIMELINE INTERATIVA ===
        let currentTimelineIndex = 0;
        
        function navigateTimeline(direction) {
            const tracks = document.querySelectorAll('.timeline-track');
            tracks.forEach(track => {
                const events = track.querySelectorAll('.timeline-event');
                currentTimelineIndex = Math.max(0, Math.min(events.length - 3, currentTimelineIndex + direction));
                
                const offset = -currentTimelineIndex * 144; // 120px + 24px gap
                track.style.transform = `translateX(${offset}px)`;
            });
        }
        
        // === AÇÕES RÁPIDAS ===
        function createReminder(eventType) {
            const messages = {
                mercury: 'Lembrete criado: Mercúrio Retrógrado termina em 15/09',
                moon: 'Lembrete criado: Próxima Lua Nova em 28/09'
            };
            
            showAFASTNotification(messages[eventType] || 'Lembrete criado com sucesso!');
            
            // Simular vibração no mobile
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100]);
            }
        }
        
        function shareEvent(eventType) {
            const shareData = {
                mercury: {
                    title: '☿ Mercúrio Retrógrado',
                    text: 'Atenção: Mercúrio está retrógrado até 15/09. Revise comunicações e contratos!',
                    url: window.location.href
                },
                moon: {
                    title: '🌖 Lua Minguante',
                    text: 'Fase ideal para liberação e limpeza. Próxima Lua Nova em 28/09.',
                    url: window.location.href
                }
            };
            
            const data = shareData[eventType];
            if (navigator.share && data) {
                navigator.share(data).catch(console.error);
            } else {
                // Fallback para WhatsApp
                const text = encodeURIComponent(`${data.title}\n${data.text}`);
                window.open(`https://wa.me/?text=${text}`, '_blank');
            }
        }
        
        function exportToCalendar(eventType) {
            const events = {
                mercury: {
                    title: 'Mercúrio Direto',
                    date: '20250915',
                    description: 'Mercúrio sai da retrogradação. Comunicações normalizam.'
                },
                moon: {
                    title: 'Lua Nova',
                    date: '20250928',
                    description: 'Lua Nova - Ideal para novos começos e manifestações.'
                }
            };
            
            const event = events[eventType];
            if (!event) return;
            
            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Aurora OS//MysticSoft//PT',
                'BEGIN:VEVENT',
                `DTSTART:${event.date}T120000Z`,
                `DTEND:${event.date}T130000Z`,
                `SUMMARY:${event.title}`,
                `DESCRIPTION:${event.description}`,
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\n');
            
            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${event.title.replace(/\s+/g, '_')}.ics`;
            a.click();
            URL.revokeObjectURL(url);
            
            showAFASTNotification('Evento exportado para calendário!');
        }
        
        function setCustomAlert(eventType) {
            const times = ['15 minutos', '1 hora', '6 horas', '1 dia', '1 semana'];
            const time = times[Math.floor(Math.random() * times.length)];
            
            showAFASTNotification(`Alerta personalizado configurado para ${time} antes do evento.`);
        }
        
        // === SISTEMA DE NOTIFICAÇÕES ===
        function toggleNotification(element, timeframe) {
            const checkbox = element.querySelector('.notification-checkbox');
            const isChecked = checkbox.classList.contains('checked');
            
            if (isChecked) {
                checkbox.classList.remove('checked');
            } else {
                checkbox.classList.add('checked');
            }
            
            const action = isChecked ? 'removido' : 'ativado';
            const timeLabels = {
                '1h': '1 hora antes',
                '6h': '6 horas antes',
                '1d': '1 dia antes',
                'custom': 'personalizado'
            };
            
            showAFASTNotification(`Alerta ${timeLabels[timeframe]} ${action}.`);
        }
        
        // === INTEGRAÇÃO COM CHIPS EXISTENTES ===
        function setupAdvancedChipListeners() {
            // Mercúrio Retrógrado - duplo clique para popover avançado
            const mercuryChip = document.getElementById('mercuryRetroChip');
            if (mercuryChip) {
                let clickCount = 0;
                mercuryChip.addEventListener('click', (e) => {
                    clickCount++;
                    setTimeout(() => {
                        if (clickCount === 1) {
                            // Clique simples - popover básico (existente)
                            showPopover(mercuryChip, [
                                { time: '15/09', description: '☿ Mercúrio direto - Comunicação normalizada' }
                            ]);
                        } else if (clickCount === 2) {
                            // Duplo clique - popover avançado
                            showAdvancedPopover('advancedMercuryPopover', mercuryChip);
                        }
                        clickCount = 0;
                    }, 300);
                });
            }
            
            // Lua Minguante - duplo clique para popover avançado
            const moonChip = document.getElementById('moonPhaseChip');
            if (moonChip) {
                let clickCount = 0;
                moonChip.addEventListener('click', (e) => {
                    clickCount++;
                    setTimeout(() => {
                        if (clickCount === 1) {
                            // Clique simples - popover básico
                            showPopover(moonChip, [
                                { time: '15/09', description: '🌗 Quarto Minguante' },
                                { time: '28/09', description: '🌑 Lua Nova - Novos começos' }
                            ]);
                        } else if (clickCount === 2) {
                            // Duplo clique - popover avançado
                            showAdvancedPopover('advancedMoonPopover', moonChip);
                        }
                        clickCount = 0;
                    }, 300);
                });
            }
        }
        
        // === FECHAR POPOVERS AO CLICAR FORA ===
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.astro-popover-advanced') && !e.target.closest('.astro-chip')) {
                document.querySelectorAll('.astro-popover-advanced.show').forEach(popover => {
                    popover.classList.remove('show');
                });
            }
        });

        // === EXPANSÃO DO SISTEMA AURORA OS 2.0 ===
        
        // === MÓDULO DE NUMEROLOGIA AVANÇADA ===
        class NumerologyEngine {
            constructor() {
                this.numerologyMethods = {
                    pythagorean: { name: 'Pitagórica', origin: 'Grécia Antiga' },
                    chaldean: { name: 'Caldeia', origin: 'Babilônia' },
                    kabbalah: { name: 'Cabalística', origin: 'Tradição Hebraica' }
                };
                this.masterNumbers = [11, 22, 33, 44];
                this.personalNumbers = {};
            }
            
            calculateLifePath(birthDate) {
                const digits = birthDate.replace(/\D/g, '').split('').map(Number);
                let sum = digits.reduce((a, b) => a + b, 0);
                
                while (sum > 9 && !this.masterNumbers.includes(sum)) {
                    sum = sum.toString().split('').map(Number).reduce((a, b) => a + b, 0);
                }
                
                return {
                    number: sum,
                    meaning: this.getLifePathMeaning(sum),
                    challenges: this.getLifePathChallenges(sum),
                    gifts: this.getLifePathGifts(sum)
                };
            }
            
            calculatePersonalYear(birthDate) {
                const currentYear = new Date().getFullYear();
                const birthMonth = new Date(birthDate).getMonth() + 1;
                const birthDay = new Date(birthDate).getDate();
                
                let sum = currentYear + birthMonth + birthDay;
                while (sum > 9) {
                    sum = sum.toString().split('').map(Number).reduce((a, b) => a + b, 0);
                }
                
                return {
                    number: sum,
                    theme: this.getPersonalYearTheme(sum),
                    opportunities: this.getPersonalYearOpportunities(sum),
                    warnings: this.getPersonalYearWarnings(sum)
                };
            }
            
            calculateNameNumber(fullName, method = 'pythagorean') {
                const letterValues = method === 'chaldean' ? 
                    { a:1,b:2,c:3,d:4,e:5,f:8,g:3,h:5,i:1,j:1,k:2,l:3,m:4,n:5,o:7,p:8,q:1,r:2,s:3,t:9,u:6,v:6,w:6,x:5,y:1,z:7 } :
                    { a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9,j:1,k:2,l:3,m:4,n:5,o:6,p:7,q:8,r:9,s:1,t:2,u:3,v:4,w:5,x:6,y:7,z:8 };
                
                const cleanName = fullName.toLowerCase().replace(/[^a-z]/g, '');
                let sum = cleanName.split('').reduce((total, letter) => total + (letterValues[letter] || 0), 0);
                
                while (sum > 9 && !this.masterNumbers.includes(sum)) {
                    sum = sum.toString().split('').map(Number).reduce((a, b) => a + b, 0);
                }
                
                return {
                    number: sum,
                    vibration: this.getNameVibration(sum),
                    expression: this.getExpressionMeaning(sum),
                    soulUrge: this.calculateSoulUrge(fullName)
                };
            }
            
            getLifePathMeaning(number) {
                const meanings = {
                    1: 'Líder natural, pioneiro, independente e inovador',
                    2: 'Cooperativo, diplomático, sensível e harmonizador',
                    3: 'Criativo, comunicativo, otimista e expressivo',
                    4: 'Prático, organizado, trabalhador e confiável',
                    5: 'Aventureiro, livre, versátil e progressivo',
                    6: 'Cuidador, responsável, amoroso e protetor',
                    7: 'Místico, analítico, introspectivo e espiritual',
                    8: 'Ambicioso, material, poderoso e realizador',
                    9: 'Humanitário, compassivo, generoso e sábio',
                    11: 'Visionário, intuitivo, inspirador e iluminado',
                    22: 'Construtor mestre, prático-visionário, realizador de sonhos',
                    33: 'Mestre curador, professor espiritual, amor universal'
                };
                return meanings[number] || 'Número especial com energia única';
            }
            
            generateDailyNumerology() {
                const today = new Date();
                const dayNumber = this.calculateDayNumber(today);
                const personalDay = this.calculatePersonalDay(today);
                
                return {
                    universalDay: {
                        number: dayNumber,
                        energy: this.getDayEnergy(dayNumber),
                        activities: this.getDayActivities(dayNumber)
                    },
                    personalDay: {
                        number: personalDay,
                        focus: this.getPersonalDayFocus(personalDay),
                        opportunities: this.getPersonalDayOpportunities(personalDay)
                    },
                    luckyNumbers: this.generateLuckyNumbers(dayNumber, personalDay),
                    colors: this.getNumerologyColors(dayNumber),
                    crystals: this.getNumerologyCrystals(dayNumber)
                };
            }
            
            calculateDayNumber(date) {
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const year = date.getFullYear();
                
                let sum = day + month + year;
                while (sum > 9) {
                    sum = sum.toString().split('').map(Number).reduce((a, b) => a + b, 0);
                }
                return sum;
            }
            
            generateLuckyNumbers(dayNumber, personalDay) {
                const base = [dayNumber, personalDay];
                const derived = [
                    (dayNumber + personalDay) % 9 + 1,
                    (dayNumber * 2) % 9 + 1,
                    (personalDay * 3) % 9 + 1,
                    (dayNumber + personalDay + 7) % 9 + 1
                ];
                return [...new Set([...base, ...derived])].sort((a, b) => a - b);
            }
            
            getNumerologyColors(number) {
                const colors = {
                    1: ['Vermelho', 'Laranja', 'Dourado'],
                    2: ['Azul', 'Verde-água', 'Prata'],
                    3: ['Amarelo', 'Rosa', 'Lilás'],
                    4: ['Verde', 'Marrom', 'Cinza'],
                    5: ['Turquesa', 'Azul-elétrico', 'Prata'],
                    6: ['Rosa', 'Verde-esmeralda', 'Azul-royal'],
                    7: ['Roxo', 'Violeta', 'Índigo'],
                    8: ['Preto', 'Marrom-escuro', 'Dourado'],
                    9: ['Branco', 'Dourado', 'Todas as cores']
                };
                return colors[number] || ['Branco', 'Prata', 'Cristal'];
            }
        }
        
        // === MÓDULO I CHING DIGITAL ===
        class IChingOracle {
            constructor() {
                this.hexagrams = this.initializeHexagrams();
                this.trigrams = this.initializeTrigrams();
                this.consultationHistory = [];
            }
            
            castCoins() {
                // Método tradicional de 3 moedas
                const coins = Array(3).fill().map(() => Math.random() < 0.5 ? 2 : 3); // 2=cara, 3=coroa
                const sum = coins.reduce((a, b) => a + b, 0);
                
                return {
                    coins: coins,
                    sum: sum,
                    line: sum === 6 ? '---x---' : // Yin mutável
                           sum === 7 ? '-------' : // Yang
                           sum === 8 ? '--- ---' : // Yin
                           '---o---',              // Yang mutável
                    type: sum === 6 || sum === 9 ? 'mutável' : 'fixo',
                    value: sum % 2 === 0 ? 'yin' : 'yang'
                };
            }
            
            generateHexagram() {
                const lines = [];
                const changingLines = [];
                
                for (let i = 0; i < 6; i++) {
                    const cast = this.castCoins();
                    lines.push(cast);
                    if (cast.type === 'mutável') {
                        changingLines.push(i + 1);
                    }
                }
                
                const primaryHex = this.identifyHexagram(lines);
                const secondaryHex = changingLines.length > 0 ? this.transformHexagram(lines, changingLines) : null;
                
                return {
                    primary: primaryHex,
                    secondary: secondaryHex,
                    changingLines: changingLines,
                    consultation: {
                        timestamp: new Date(),
                        question: null, // Será preenchida pelo usuário
                        interpretation: this.generateInterpretation(primaryHex, secondaryHex, changingLines)
                    }
                };
            }
            
            identifyHexagram(lines) {
                const binary = lines.map(line => line.value === 'yang' ? '1' : '0').join('');
                const number = parseInt(binary, 2) + 1;
                
                return {
                    number: number,
                    name: this.hexagrams[number]?.name || 'Hexagrama Desconhecido',
                    chineseName: this.hexagrams[number]?.chinese || '',
                    meaning: this.hexagrams[number]?.meaning || '',
                    judgment: this.hexagrams[number]?.judgment || '',
                    image: this.hexagrams[number]?.image || '',
                    lines: lines,
                    upperTrigram: this.getTrigram(lines.slice(3, 6)),
                    lowerTrigram: this.getTrigram(lines.slice(0, 3))
                };
            }
            
            generateInterpretation(primary, secondary, changingLines) {
                let interpretation = {
                    situation: this.interpretSituation(primary),
                    advice: this.interpretAdvice(primary),
                    outcome: secondary ? this.interpretOutcome(secondary) : null,
                    timing: this.interpretTiming(primary, changingLines),
                    elements: this.interpretElements(primary.upperTrigram, primary.lowerTrigram)
                };
                
                if (changingLines.length > 0) {
                    interpretation.transformation = this.interpretTransformation(primary, secondary, changingLines);
                }
                
                return interpretation;
            }
            
            initializeHexagrams() {
                // Simplified hexagram database - in reality would be much more extensive
                return {
                    1: { name: 'O Criativo', chinese: '乾 Qián', meaning: 'Força criativa, iniciativa, liderança' },
                    2: { name: 'O Receptivo', chinese: '坤 Kūn', meaning: 'Receptividade, cooperação, terra' },
                    3: { name: 'Dificuldade Inicial', chinese: '屯 Zhūn', meaning: 'Crescimento através da dificuldade' },
                    4: { name: 'Loucura Juvenil', chinese: '蒙 Méng', meaning: 'Inexperiência, necessidade de orientação' },
                    5: { name: 'Espera', chinese: '需 Xū', meaning: 'Paciência, preparação, timing correto' },
                    // ... continuaria com todos os 64 hexagramas
                };
            }
            
            consultOracle(question) {
                const reading = this.generateHexagram();
                reading.consultation.question = question;
                
                this.consultationHistory.push(reading);
                
                return {
                    reading: reading,
                    guidance: this.generateGuidance(reading, question),
                    meditation: this.generateMeditation(reading),
                    followUp: this.generateFollowUp(reading)
                };
            }
        }
        
        // === MÓDULO DE RUNAS NÓRDICAS ===
        class RunicOracle {
            constructor() {
                this.runes = this.initializeRunes();
                this.spreads = this.initializeSpreads();
                this.castHistory = [];
            }
            
            initializeRunes() {
                return {
                    fehu: { name: 'Fehu', symbol: 'ᚠ', meaning: 'Gado, riqueza, abundância', element: 'fogo', deity: 'Freyr' },
                    uruz: { name: 'Uruz', symbol: 'ᚢ', meaning: 'Auroque, força bruta, vitalidade', element: 'terra', deity: 'Thor' },
                    thurisaz: { name: 'Thurisaz', symbol: 'ᚦ', meaning: 'Gigante, proteção, conflito', element: 'fogo', deity: 'Thor' },
                    ansuz: { name: 'Ansuz', symbol: 'ᚨ', meaning: 'Deus, comunicação, sabedoria', element: 'ar', deity: 'Odin' },
                    raidho: { name: 'Raidho', symbol: 'ᚱ', meaning: 'Viagem, movimento, progresso', element: 'ar', deity: 'Thor' },
                    kenaz: { name: 'Kenaz', symbol: 'ᚲ', meaning: 'Tocha, conhecimento, criatividade', element: 'fogo', deity: 'Loki' },
                    gebo: { name: 'Gebo', symbol: 'ᚷ', meaning: 'Presente, parceria, sacrifício', element: 'ar', deity: 'Odin' },
                    wunjo: { name: 'Wunjo', symbol: 'ᚹ', meaning: 'Alegria, harmonia, realização', element: 'terra', deity: 'Freyr' },
                    hagalaz: { name: 'Hagalaz', symbol: 'ᚺ', meaning: 'Granizo, destruição, mudança', element: 'água', deity: 'Hel' },
                    nauthiz: { name: 'Nauthiz', symbol: 'ᚾ', meaning: 'Necessidade, resistência, destino', element: 'fogo', deity: 'Norns' },
                    isa: { name: 'Isa', symbol: 'ᛁ', meaning: 'Gelo, pausa, concentração', element: 'água', deity: 'Skadi' },
                    jera: { name: 'Jera', symbol: 'ᛃ', meaning: 'Colheita, ciclos, recompensa', element: 'terra', deity: 'Freyr' },
                    eihwaz: { name: 'Eihwaz', symbol: 'ᛇ', meaning: 'Teixo, morte/renascimento, proteção', element: 'terra', deity: 'Odin' },
                    perthro: { name: 'Perthro', symbol: 'ᛈ', meaning: 'Mistério, destino, sorte', element: 'água', deity: 'Norns' },
                    algiz: { name: 'Algiz', symbol: 'ᛉ', meaning: 'Alce, proteção, conexão divina', element: 'ar', deity: 'Heimdall' },
                    sowilo: { name: 'Sowilo', symbol: 'ᛊ', meaning: 'Sol, sucesso, vitalidade', element: 'fogo', deity: 'Balder' },
                    tiwaz: { name: 'Tiwaz', symbol: 'ᛏ', meaning: 'Tyr, justiça, coragem', element: 'ar', deity: 'Tyr' },
                    berkano: { name: 'Berkano', symbol: 'ᛒ', meaning: 'Bétula, crescimento, feminino', element: 'terra', deity: 'Frigg' },
                    ehwaz: { name: 'Ehwaz', symbol: 'ᛖ', meaning: 'Cavalo, parceria, progresso', element: 'terra', deity: 'Sleipnir' },
                    mannaz: { name: 'Mannaz', symbol: 'ᛗ', meaning: 'Humanidade, eu, comunidade', element: 'ar', deity: 'Heimdall' },
                    laguz: { name: 'Laguz', symbol: 'ᛚ', meaning: 'Água, intuição, fluxo', element: 'água', deity: 'Njord' },
                    ingwaz: { name: 'Ingwaz', symbol: 'ᛜ', meaning: 'Ing, fertilidade, potencial', element: 'terra', deity: 'Freyr' },
                    dagaz: { name: 'Dagaz', symbol: 'ᛞ', meaning: 'Dia, despertar, transformação', element: 'fogo', deity: 'Balder' },
                    othala: { name: 'Othala', symbol: 'ᛟ', meaning: 'Herança, lar, ancestrais', element: 'terra', deity: 'Odin' },
                    wyrd: { name: 'Wyrd', symbol: '⚬', meaning: 'Destino, o desconhecido, oráculo', element: 'espírito', deity: 'Norns' }
                };
            }
            
            castSingleRune() {
                const runeNames = Object.keys(this.runes);
                const selectedRune = runeNames[Math.floor(Math.random() * runeNames.length)];
                const isReversed = Math.random() < 0.3; // 30% chance de runa invertida
                
                return {
                    rune: this.runes[selectedRune],
                    reversed: isReversed,
                    interpretation: this.interpretRune(selectedRune, isReversed),
                    guidance: this.generateRunicGuidance(selectedRune, isReversed),
                    meditation: this.generateRunicMeditation(selectedRune)
                };
            }
            
            castThreeRunes() {
                const past = this.castSingleRune();
                const present = this.castSingleRune();
                const future = this.castSingleRune();
                
                return {
                    spread: 'Três Runas - Passado, Presente, Futuro',
                    past: { ...past, position: 'Passado - Influências que moldaram a situação' },
                    present: { ...present, position: 'Presente - Situação atual e energias ativas' },
                    future: { ...future, position: 'Futuro - Tendências e possibilidades' },
                    synthesis: this.synthesizeThreeRunes(past, present, future),
                    advice: this.generateThreeRuneAdvice(past, present, future)
                };
            }
            
            interpretRune(runeName, reversed) {
                const rune = this.runes[runeName];
                const baseInterpretation = {
                    upright: this.getUprightMeaning(runeName),
                    reversed: this.getReversedMeaning(runeName)
                };
                
                return {
                    primary: reversed ? baseInterpretation.reversed : baseInterpretation.upright,
                    keywords: this.getRuneKeywords(runeName, reversed),
                    advice: this.getRuneAdvice(runeName, reversed),
                    warning: reversed ? this.getRuneWarning(runeName) : null,
                    element: rune.element,
                    deity: rune.deity,
                    associations: this.getRuneAssociations(runeName)
                };
            }
            
            generateRunicGuidance(runeName, reversed) {
                const rune = this.runes[runeName];
                const guidance = {
                    action: this.getRuneAction(runeName, reversed),
                    meditation: `Medite sobre o símbolo ${rune.symbol} e sua conexão com ${rune.deity}`,
                    ritual: this.getRuneRitual(runeName),
                    timing: this.getRuneTiming(runeName),
                    colors: this.getRuneColors(runeName),
                    stones: this.getRuneStones(runeName)
                };
                
                return guidance;
            }
        }
        
        // === MÓDULO DE CRISTALOTERAPIA PERSONALIZADA ===
        class CrystalTherapyEngine {
            constructor() {
                this.crystals = this.initializeCrystalDatabase();
                this.chakras = this.initializeChakras();
                this.ailments = this.initializeAilments();
                this.userProfile = this.loadCrystalProfile();
            }
            
            initializeCrystalDatabase() {
                return {
                    amethyst: {
                        name: 'Ametista',
                        color: 'Roxo',
                        chakra: 'Coronário',
                        element: 'Ar',
                        hardness: 7,
                        properties: ['Proteção espiritual', 'Intuição', 'Calma mental', 'Purificação'],
                        ailments: ['Insônia', 'Ansiedade', 'Vícios', 'Dores de cabeça'],
                        zodiac: ['Peixes', 'Virgem', 'Aquário', 'Capricórnio'],
                        planet: 'Netuno',
                        vibration: 3,
                        rarity: 'Comum',
                        formation: 'Ígnea',
                        care: 'Evitar sol direto, limpar com água corrente'
                    },
                    rose_quartz: {
                        name: 'Quartzo Rosa',
                        color: 'Rosa',
                        chakra: 'Cardíaco',
                        element: 'Água',
                        hardness: 7,
                        properties: ['Amor incondicional', 'Cura emocional', 'Autoestima', 'Perdão'],
                        ailments: ['Depressão', 'Mágoa', 'Baixa autoestima', 'Problemas cardíacos'],
                        zodiac: ['Touro', 'Libra', 'Escorpião'],
                        planet: 'Vênus',
                        vibration: 7,
                        rarity: 'Comum',
                        formation: 'Ígnea',
                        care: 'Limpar com água e sal, carregar na lua cheia'
                    },
                    clear_quartz: {
                        name: 'Quartzo Transparente',
                        color: 'Transparente',
                        chakra: 'Todos',
                        element: 'Todos',
                        hardness: 7,
                        properties: ['Amplificação', 'Clareza mental', 'Energia universal', 'Programabilidade'],
                        ailments: ['Fadiga', 'Confusão mental', 'Bloqueios energéticos'],
                        zodiac: ['Todos'],
                        planet: 'Sol',
                        vibration: 4,
                        rarity: 'Muito comum',
                        formation: 'Ígnea',
                        care: 'Versátil, aceita qualquer método de limpeza'
                    },
                    black_tourmaline: {
                        name: 'Turmalina Negra',
                        color: 'Preto',
                        chakra: 'Raiz',
                        element: 'Terra',
                        hardness: 7.5,
                        properties: ['Proteção psíquica', 'Aterramento', 'Transmutação', 'Escudo energético'],
                        ailments: ['Ataques psíquicos', 'Radiação EMF', 'Negatividade', 'Desconexão'],
                        zodiac: ['Escorpião', 'Capricórnio'],
                        planet: 'Saturno',
                        vibration: 3,
                        rarity: 'Comum',
                        formation: 'Metamórfica',
                        care: 'Limpar frequentemente, enterrar na terra'
                    },
                    citrine: {
                        name: 'Citrino',
                        color: 'Amarelo dourado',
                        chakra: 'Plexo Solar',
                        element: 'Fogo',
                        hardness: 7,
                        properties: ['Abundância', 'Manifestação', 'Confiança', 'Alegria'],
                        ailments: ['Depressão', 'Baixa energia', 'Problemas digestivos', 'Falta de motivação'],
                        zodiac: ['Leão', 'Gêmeos', 'Áries', 'Libra'],
                        planet: 'Sol',
                        vibration: 6,
                        rarity: 'Raro natural',
                        formation: 'Ígnea',
                        care: 'Não precisa limpeza, auto-purificante'
                    }
                    // ... continuaria com centenas de cristais
                };
            }
            
            recommendCrystalsForUser(intent, currentState) {
                const recommendations = [];
                
                // Análise baseada na intenção
                const intentCrystals = this.getCrystalsForIntent(intent);
                
                // Análise baseada no estado atual
                const stateCrystals = this.getCrystalsForState(currentState);
                
                // Análise astrológica
                const astroCrystals = this.getCrystalsForAstrology();
                
                // Combinar e priorizar recomendações
                const combined = this.combineCrystalRecommendations(intentCrystals, stateCrystals, astroCrystals);
                
                return {
                    primary: combined.slice(0, 3),
                    secondary: combined.slice(3, 6),
                    layout: this.generateCrystalLayout(combined.slice(0, 7)),
                    meditation: this.generateCrystalMeditation(combined.slice(0, 3)),
                    care: this.generateCrystalCare(combined.slice(0, 3)),
                    timing: this.generateOptimalTiming(combined.slice(0, 3))
                };
            }
            
            generateCrystalGrid(purpose, size = 'medium') {
                const gridPatterns = {
                    small: { crystals: 7, pattern: 'Flor da Vida Simples' },
                    medium: { crystals: 13, pattern: 'Estrela de Davi' },
                    large: { crystals: 19, pattern: 'Merkaba Completa' }
                };
                
                const pattern = gridPatterns[size];
                const crystals = this.selectCrystalsForPurpose(purpose, pattern.crystals);
                
                return {
                    purpose: purpose,
                    pattern: pattern.pattern,
                    centerCrystal: crystals[0],
                    innerRing: crystals.slice(1, 7),
                    outerRing: crystals.slice(7),
                    activation: this.generateGridActivation(purpose),
                    maintenance: this.generateGridMaintenance(),
                    duration: this.calculateGridDuration(purpose),
                    moonPhase: this.getOptimalMoonPhase(purpose)
                };
            }
            
            analyzeCrystalCompatibility(crystal1, crystal2) {
                const c1 = this.crystals[crystal1];
                const c2 = this.crystals[crystal2];
                
                const compatibility = {
                    elementalHarmony: this.checkElementalHarmony(c1.element, c2.element),
                    chakraAlignment: this.checkChakraAlignment(c1.chakra, c2.chakra),
                    vibrationSync: this.checkVibrationSync(c1.vibration, c2.vibration),
                    purposeOverlap: this.checkPurposeOverlap(c1.properties, c2.properties),
                    zodiacHarmony: this.checkZodiacHarmony(c1.zodiac, c2.zodiac)
                };
                
                const overallScore = this.calculateCompatibilityScore(compatibility);
                
                return {
                    score: overallScore,
                    compatibility: compatibility,
                    recommendation: this.generateCompatibilityRecommendation(overallScore, compatibility),
                    synergy: this.identifySynergy(c1, c2),
                    warnings: this.identifyWarnings(c1, c2)
                };
            }
        }
        
        // === IA ASTROLÓGICA 2.0 EXPANDIDA ===
        class AdvancedAstroAI extends AFASTAstroAI {
            constructor(narrator) {
                super(narrator);
                this.mlModel = new AstroMLModel();
                this.natalChart = new NatalChartEngine();
                this.transitEngine = new TransitEngine();
                this.astronomicalAPI = new AstronomicalDataAPI();
                this.predictionAccuracy = 0.85; // Melhora com uso
            }
            
            async generatePersonalizedForecast(timeframe = '30days') {
                const userChart = await this.natalChart.generate(this.userProfile.birthData);
                const currentTransits = await this.transitEngine.getCurrentTransits();
                const futureTransits = await this.transitEngine.getFutureTransits(timeframe);
                
                const forecast = {
                    overview: await this.mlModel.generateOverview(userChart, currentTransits),
                    dailyInsights: await this.generateDailyInsights(futureTransits, 30),
                    majorEvents: await this.identifyMajorEvents(futureTransits, userChart),
                    opportunities: await this.identifyOpportunities(futureTransits, userChart),
                    challenges: await this.identifyChallenges(futureTransits, userChart),
                    recommendations: await this.generateSmartRecommendations(userChart, futureTransits)
                };
                
                return forecast;
            }
            
            async analyzeNatalChart(birthData) {
                const chart = await this.natalChart.calculate(birthData);
                const analysis = {
                    sunSign: this.analyzeSun(chart.sun),
                    moonSign: this.analyzeMoon(chart.moon),
                    ascendant: this.analyzeAscendant(chart.ascendant),
                    planetaryPositions: this.analyzePlanets(chart.planets),
                    houses: this.analyzeHouses(chart.houses),
                    aspects: this.analyzeAspects(chart.aspects),
                    patterns: this.identifyPatterns(chart),
                    karmaNodes: this.analyzeNodes(chart.northNode, chart.southNode),
                    lifeThemes: this.extractLifeThemes(chart),
                    soulPurpose: this.calculateSoulPurpose(chart)
                };
                
                return {
                    chart: chart,
                    analysis: analysis,
                    synthesis: await this.synthesizeChart(analysis),
                    guidance: await this.generateLifeGuidance(analysis)
                };
            }
            
            async predictEventTiming(eventType, userChart) {
                const relevantTransits = await this.transitEngine.findRelevantTransits(eventType, userChart);
                const historicalData = await this.mlModel.getHistoricalPatterns(eventType);
                
                const predictions = [];
                
                for (const transit of relevantTransits) {
                    const probability = await this.mlModel.calculateProbability(transit, historicalData, userChart);
                    const timing = await this.calculateOptimalTiming(transit, userChart);
                    
                    predictions.push({
                        event: eventType,
                        transit: transit,
                        probability: probability,
                        optimalTiming: timing,
                        duration: this.calculateEventDuration(transit),
                        intensity: this.calculateEventIntensity(transit, userChart),
                        preparation: this.generatePreparationAdvice(eventType, timing)
                    });
                }
                
                return predictions.sort((a, b) => b.probability - a.probability);
            }
            
            async generateCompatibilityReport(person1Chart, person2Chart) {
                const synastry = await this.calculateSynastry(person1Chart, person2Chart);
                const composite = await this.calculateComposite(person1Chart, person2Chart);
                
                return {
                    overallCompatibility: this.calculateOverallCompatibility(synastry),
                    strengths: this.identifyRelationshipStrengths(synastry),
                    challenges: this.identifyRelationshipChallenges(synastry),
                    communication: this.analyzeCommunicationStyle(synastry),
                    emotional: this.analyzeEmotionalCompatibility(synastry),
                    physical: this.analyzePhysicalCompatibility(synastry),
                    spiritual: this.analyzeSpiritualCompatibility(synastry),
                    longTerm: this.analyzeLongTermPotential(composite),
                    advice: this.generateRelationshipAdvice(synastry, composite),
                    timing: this.identifyOptimalTimings(synastry, composite)
                };
            }
        }
        
        // === SISTEMA DE CONECTIVIDADE AVANÇADA ===
        class CloudSyncEngine {
            constructor() {
                this.syncStatus = 'disconnected';
                this.lastSync = null;
                this.cloudStorage = new CloudStorageAPI();
                this.encryptionEngine = new EncryptionEngine();
                this.conflictResolver = new ConflictResolver();
            }
            
            async initializeSync(userCredentials) {
                try {
                    await this.cloudStorage.authenticate(userCredentials);
                    this.syncStatus = 'connected';
                    
                    // Sincronização inicial
                    await this.performFullSync();
                    
                    // Configurar sincronização automática
                    this.setupAutoSync();
                    
                    return {
                        success: true,
                        message: 'Sincronização inicializada com sucesso',
                        lastSync: new Date(),
                        devicesConnected: await this.getConnectedDevices()
                    };
                } catch (error) {
                    return {
                        success: false,
                        message: 'Erro na inicialização: ' + error.message,
                        fallback: 'Modo offline ativado'
                    };
                }
            }
            
            async syncUserData() {
                const localData = {
                    profile: this.getUserProfile(),
                    preferences: this.getUserPreferences(),
                    history: this.getEventHistory(),
                    customizations: this.getCustomizations(),
                    charts: this.getSavedCharts(),
                    consultations: this.getConsultationHistory()
                };
                
                // Criptografar dados sensíveis
                const encryptedData = await this.encryptionEngine.encrypt(localData);
                
                // Upload para nuvem
                const cloudData = await this.cloudStorage.upload(encryptedData);
                
                // Verificar conflitos
                const conflicts = await this.conflictResolver.detect(localData, cloudData);
                
                if (conflicts.length > 0) {
                    return await this.resolveConflicts(conflicts);
                }
                
                this.lastSync = new Date();
                return { success: true, timestamp: this.lastSync };
            }
            
            async shareInsight(insight, recipients) {
                const shareableInsight = {
                    id: this.generateShareId(),
                    type: insight.type,
                    content: insight.content,
                    timestamp: new Date(),
                    author: this.userProfile.displayName,
                    privacy: insight.privacy || 'friends',
                    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 dias
                };
                
                // Remover dados pessoais sensíveis
                const sanitizedInsight = this.sanitizeForSharing(shareableInsight);
                
                // Enviar para destinatários
                const results = [];
                for (const recipient of recipients) {
                    const result = await this.sendInsight(sanitizedInsight, recipient);
                    results.push(result);
                }
                
                return {
                    shareId: shareableInsight.id,
                    recipients: results,
                    expiresAt: shareableInsight.expiresAt,
                    shareUrl: this.generateShareUrl(shareableInsight.id)
                };
            }
        }
        
        // === SISTEMA DE TEMAS SAZONAIS ===
        class SeasonalThemeEngine {
            constructor() {
                this.currentSeason = this.detectCurrentSeason();
                this.astronomicalEvents = new AstronomicalEventTracker();
                this.themeLibrary = this.initializeThemeLibrary();
                this.autoThemeEnabled = true;
            }
            
            detectCurrentSeason() {
                const now = new Date();
                const month = now.getMonth() + 1;
                const day = now.getDate();
                
                // Hemisfério Sul (Brasil)
                if ((month === 12 && day >= 21) || month === 1 || month === 2 || (month === 3 && day < 20)) {
                    return 'verao'; // Verão
                } else if ((month === 3 && day >= 20) || month === 4 || month === 5 || (month === 6 && day < 21)) {
                    return 'outono'; // Outono
                } else if ((month === 6 && day >= 21) || month === 7 || month === 8 || (month === 9 && day < 22)) {
                    return 'inverno'; // Inverno
                } else {
                    return 'primavera'; // Primavera
                }
            }
            
            async updateThemeForEvent(eventType) {
                const themes = {
                    'eclipse_solar': 'eclipse_solar_theme',
                    'eclipse_lunar': 'eclipse_lunar_theme',
                    'mercurio_retrogrado': 'mercury_retrograde_theme',
                    'lua_cheia': 'full_moon_theme',
                    'lua_nova': 'new_moon_theme',
                    'equinoxio': 'equinox_theme',
                    'solsticio': 'solstice_theme',
                    'chuva_meteoros': 'meteor_shower_theme'
                };
                
                const themeId = themes[eventType];
                if (themeId) {
                    await this.applyTheme(themeId);
                    
                    // Agendar retorno ao tema sazonal
                    setTimeout(() => {
                        this.applySeasonalTheme();
                    }, this.getEventDuration(eventType));
                }
            }
            
            async applyTheme(themeId) {
                const theme = this.themeLibrary[themeId];
                if (!theme) return;
                
                // Aplicar cores
                this.applyColorPalette(theme.colors);
                
                // Aplicar wallpaper
                this.applyWallpaper(theme.wallpaper);
                
                // Aplicar efeitos visuais
                this.applyVisualEffects(theme.effects);
                
                // Aplicar sons ambiente
                this.applyAmbientSounds(theme.sounds);
                
                // Salvar tema atual
                localStorage.setItem('current-theme', themeId);
                
                // Notificar mudança
                this.narrator?.speak(`Tema ${theme.name} aplicado com sucesso.`);
            }
            
            generateCustomTheme(preferences) {
                const customTheme = {
                    id: 'custom_' + Date.now(),
                    name: preferences.name || 'Tema Personalizado',
                    colors: {
                        primary: preferences.primaryColor || '#4a90e2',
                        secondary: preferences.secondaryColor || '#f5a623',
                        accent: preferences.accentColor || '#bd10e0',
                        background: preferences.backgroundColor || '#1a1a2e',
                        text: preferences.textColor || '#ffffff'
                    },
                    wallpaper: preferences.wallpaper || 'custom_gradient',
                    effects: {
                        particles: preferences.enableParticles || false,
                        animations: preferences.enableAnimations || true,
                        transitions: preferences.transitionSpeed || 'medium'
                    },
                    sounds: {
                        ambient: preferences.ambientSound || 'none',
                        notifications: preferences.notificationSound || 'crystal',
                        volume: preferences.soundVolume || 0.3
                    }
                };
                
                // Salvar tema personalizado
                this.themeLibrary[customTheme.id] = customTheme;
                this.saveThemeLibrary();
                
                return customTheme;
            }
        }
        
        // === SISTEMA DE REALIDADE AUMENTADA ===
        class ARConstellationEngine {
            constructor() {
                this.arSupported = this.checkARSupport();
                this.starCatalog = new StarCatalogAPI();
                this.deviceOrientation = new DeviceOrientationTracker();
                this.locationService = new GeolocationService();
                this.arSession = null;
            }
            
            async initializeAR() {
                if (!this.arSupported) {
                    return { success: false, message: 'AR não suportado neste dispositivo' };
                }
                
                try {
                    // Solicitar permissões
                    await this.requestPermissions();
                    
                    // Obter localização
                    const location = await this.locationService.getCurrentPosition();
                    
                    // Inicializar sessão AR
                    this.arSession = await navigator.xr.requestSession('immersive-ar');
                    
                    // Carregar catálogo de estrelas para a localização
                    const visibleStars = await this.starCatalog.getVisibleStars(location, new Date());
                    
                    return {
                        success: true,
                        session: this.arSession,
                        visibleStars: visibleStars.length,
                        location: location
                    };
                } catch (error) {
                    return {
                        success: false,
                        message: 'Erro ao inicializar AR: ' + error.message
                    };
                }
            }
            
            async renderConstellations() {
                if (!this.arSession) return;
                
                const currentTime = new Date();
                const userLocation = await this.locationService.getCurrentPosition();
                const deviceOrientation = await this.deviceOrientation.getOrientation();
                
                // Calcular posições das estrelas no céu
                const starPositions = await this.starCatalog.calculatePositions(
                    userLocation, 
                    currentTime, 
                    deviceOrientation
                );
                
                // Renderizar constelações
                const constellations = await this.starCatalog.getConstellations(starPositions);
                
                for (const constellation of constellations) {
                    await this.renderConstellation(constellation);
                }
                
                // Adicionar informações interativas
                this.addInteractiveElements(constellations);
            }
            
            async identifyPlanet(screenCoordinates) {
                const worldCoordinates = this.screenToWorld(screenCoordinates);
                const celestialCoordinates = this.worldToCelestial(worldCoordinates);
                
                const planets = await this.starCatalog.getPlanets(new Date());
                
                for (const planet of planets) {
                    const distance = this.calculateAngularDistance(
                        celestialCoordinates, 
                        planet.coordinates
                    );
                    
                    if (distance < 2) { // 2 graus de tolerância
                        return {
                            name: planet.name,
                            info: await this.getPlanetInfo(planet),
                            astrological: await this.getAstrologicalInfo(planet),
                            mythology: await this.getMythologyInfo(planet)
                        };
                    }
                }
                
                return null;
            }
        }
        
        // === INICIALIZAÇÃO DOS NOVOS MÓDULOS ===
        let numerologyEngine, iChingOracle, runicOracle, crystalTherapy;
        let advancedAstroAI, cloudSync, seasonalThemes, arConstellation;
        
        function initializeExpandedSystems() {
            // Módulos místicos
            numerologyEngine = new NumerologyEngine();
            iChingOracle = new IChingOracle();
            runicOracle = new RunicOracle();
            crystalTherapy = new CrystalTherapyEngine();
            
            // Sistemas avançados
            if (typeof afastNarrator !== 'undefined') {
                advancedAstroAI = new AdvancedAstroAI(afastNarrator);
            }
            
            cloudSync = new CloudSyncEngine();
            seasonalThemes = new SeasonalThemeEngine();
            
            // AR (se suportado)
            if (typeof navigator !== 'undefined' && navigator.xr) {
                arConstellation = new ARConstellationEngine();
            }
            
            console.log('🌟 Sistemas expandidos inicializados!');
            
            // Aplicar tema sazonal
            if (seasonalThemes) {
                seasonalThemes.applySeasonalTheme();
            }
            
            // Inicializar sincronização (se configurada)
            const savedCredentials = localStorage.getItem('cloud-credentials');
            if (savedCredentials && cloudSync) {
                cloudSync.initializeSync(JSON.parse(savedCredentials));
            }
        }

        // Carregar wallpaper ao inicializar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(loadSavedWallpaper, 1000);
            setTimeout(setupAdvancedChipListeners, 2000);
            setTimeout(initializeAFASTIntegration, 3000);
            setTimeout(initializeExpandedSystems, 4000); // Inicializar sistemas expandidos
            
            // Definir função openApp globalmente
            window.openApp = function(appName) {
                console.log('Abrindo aplicação:', appName);
                
                const apps = {
                    'astromagick': {
                        title: 'AstroMágick - Portal Astrológico',
                        content: `
                            <div style="padding: 20px; font-family: 'Cinzel Decorative', serif;">
                                <h2 style="color: #d4af37; text-align: center; margin-bottom: 20px;">🔮 AstroMágick Portal 🔮</h2>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>🌙 Fases Lunares</h3>
                                        <p>Lua Minguante - 88% de energia de liberação</p>
                                        <button onclick="showLunarCalendar()" style="background: #d4af37; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Ver Calendário</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>☿ Mercúrio Retrógrado</h3>
                                        <p>ATIVO até 15/09 - Cuidado com comunicação</p>
                                        <button onclick="showMercuryDetails()" style="background: #ff6b6b; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Detalhes</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>🪐 Trânsitos Planetários</h3>
                                        <p>Júpiter em Gêmeos - Expansão mental</p>
                                        <button onclick="showTransits()" style="background: #4ecdc4; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Ver Todos</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>⭐ Previsões Personalizadas</h3>
                                        <p>Baseadas na sua carta natal</p>
                                        <button onclick="generateForecast()" style="background: #9b59b6; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Gerar</button>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    'numerologia': {
                        title: 'Numerologia Avançada',
                        content: `
                            <div style="padding: 20px; font-family: 'Cinzel Decorative', serif;">
                                <h2 style="color: #d4af37; text-align: center; margin-bottom: 20px;">🔢 Numerologia Sagrada 🔢</h2>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>📅 Numerologia Diária</h3>
                                        <p><strong>Dia Universal:</strong> 7 - Espiritualidade</p>
                                        <p><strong>Números da Sorte:</strong> 3, 7, 11, 21</p>
                                        <p><strong>Cores:</strong> Roxo, Violeta, Índigo</p>
                                        <button onclick="generateDailyNumerology()" style="background: #9b59b6; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Atualizar</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>🎯 Caminho de Vida</h3>
                                        <p>Digite sua data de nascimento:</p>
                                        <input type="date" id="birthDate" style="width: 100%; padding: 8px; margin: 8px 0; border: 1px solid #d4af37; border-radius: 4px; background: rgba(0,0,0,0.3); color: #fff;">
                                        <button onclick="calculateLifePath()" style="background: #d4af37; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Calcular</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>📝 Número do Nome</h3>
                                        <p>Digite seu nome completo:</p>
                                        <input type="text" id="fullName" placeholder="Nome completo" style="width: 100%; padding: 8px; margin: 8px 0; border: 1px solid #d4af37; border-radius: 4px; background: rgba(0,0,0,0.3); color: #fff;">
                                        <button onclick="calculateNameNumber()" style="background: #4ecdc4; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Analisar</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>🔮 Ano Pessoal</h3>
                                        <p><strong>2025:</strong> Ano 9 - Conclusão</p>
                                        <p>Tempo de finalizar ciclos e se preparar para novos começos</p>
                                        <button onclick="showPersonalYear()" style="background: #ff6b6b; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Detalhes</button>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    'iching': {
                        title: 'I Ching - Oráculo Digital',
                        content: `
                            <div style="padding: 20px; font-family: 'Cinzel Decorative', serif;">
                                <h2 style="color: #d4af37; text-align: center; margin-bottom: 20px;">☯️ I Ching - Livro das Mutações ☯️</h2>
                                <div style="text-align: center; margin-bottom: 30px;">
                                    <p style="font-size: 18px; color: #d4af37;">Faça sua pergunta ao oráculo milenar</p>
                                    <textarea id="ichingQuestion" placeholder="Digite sua pergunta..." style="width: 80%; height: 80px; padding: 12px; margin: 12px 0; border: 1px solid #d4af37; border-radius: 8px; background: rgba(0,0,0,0.3); color: #fff; font-family: inherit; resize: vertical;"></textarea>
                                    <br>
                                    <button onclick="castIChingCoins()" style="background: #d4af37; color: #000; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px;">🪙 Lançar Moedas</button>
                                </div>
                                <div id="ichingResult" style="display: none;">
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 8px; border: 1px solid #d4af37; margin: 20px 0;">
                                        <h3 style="text-align: center; color: #d4af37;">Hexagrama Principal</h3>
                                        <div style="text-align: center; font-size: 24px; margin: 20px 0;" id="hexagramDisplay">
                                            ═══════<br>
                                            ═══════<br>
                                            ═══ ═══<br>
                                            ═══════<br>
                                            ═══ ═══<br>
                                            ═══════
                                        </div>
                                        <h4 style="text-align: center;">1. O Criativo (乾 Qián)</h4>
                                        <p><strong>Julgamento:</strong> O Criativo opera sublime sucesso, favorecendo através da perseverança.</p>
                                        <p><strong>Imagem:</strong> O movimento do céu é forte. Assim o homem superior torna-se incansável em sua atividade.</p>
                                        <p><strong>Interpretação:</strong> Este é um momento de grande potencial criativo. Suas ideias e iniciativas têm força para se manifestar.</p>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    'runas': {
                        title: 'Oráculo das Runas Nórdicas',
                        content: `
                            <div style="padding: 20px; font-family: 'Cinzel Decorative', serif;">
                                <h2 style="color: #d4af37; text-align: center; margin-bottom: 20px;">ᚱ Oráculo das Runas Nórdicas ᚱ</h2>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37; text-align: center;">
                                        <h3>🎯 Runa Única</h3>
                                        <p>Para questões diretas e orientação imediata</p>
                                        <button onclick="castSingleRune()" style="background: #d4af37; color: #000; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px;">Sortear Runa</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37; text-align: center;">
                                        <h3>🔮 Três Runas</h3>
                                        <p>Passado, Presente e Futuro</p>
                                        <button onclick="castThreeRunes()" style="background: #9b59b6; color: #fff; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px;">Tirada Completa</button>
                                    </div>
                                </div>
                                <div id="runeResult" style="display: none; margin-top: 20px;">
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <div style="text-align: center; margin-bottom: 20px;">
                                            <div style="font-size: 48px; color: #d4af37;" id="runeSymbol">ᚠ</div>
                                            <h3 id="runeName">Fehu</h3>
                                            <p id="runeElement">Elemento: Fogo | Divindade: Freyr</p>
                                        </div>
                                        <div id="runeInterpretation">
                                            <p><strong>Significado:</strong> Gado, riqueza, abundância material e espiritual</p>
                                            <p><strong>Orientação:</strong> Este é um momento favorável para novos empreendimentos e investimentos</p>
                                            <p><strong>Meditação:</strong> Medite sobre o símbolo ᚠ e sua conexão com Freyr</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    'cristais': {
                        title: 'Cristaloterapia Personalizada',
                        content: `
                            <div style="padding: 20px; font-family: 'Cinzel Decorative', serif;">
                                <h2 style="color: #d4af37; text-align: center; margin-bottom: 20px;">💎 Cristaloterapia Sagrada 💎</h2>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>🎯 Recomendação Personalizada</h3>
                                        <p>Qual sua intenção hoje?</p>
                                        <select id="crystalIntent" style="width: 100%; padding: 8px; margin: 8px 0; border: 1px solid #d4af37; border-radius: 4px; background: rgba(0,0,0,0.3); color: #fff;">
                                            <option value="protecao">Proteção Energética</option>
                                            <option value="amor">Amor e Relacionamentos</option>
                                            <option value="abundancia">Abundância e Prosperidade</option>
                                            <option value="cura">Cura Emocional</option>
                                            <option value="intuicao">Intuição e Espiritualidade</option>
                                            <option value="energia">Energia e Vitalidade</option>
                                        </select>
                                        <button onclick="recommendCrystals()" style="background: #d4af37; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Recomendar</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>🔮 Grid de Cristais</h3>
                                        <p>Crie um grid poderoso para manifestação</p>
                                        <select id="gridPurpose" style="width: 100%; padding: 8px; margin: 8px 0; border: 1px solid #d4af37; border-radius: 4px; background: rgba(0,0,0,0.3); color: #fff;">
                                            <option value="manifestacao">Manifestação</option>
                                            <option value="protecao">Proteção do Lar</option>
                                            <option value="cura">Cura e Harmonização</option>
                                            <option value="meditacao">Meditação Profunda</option>
                                        </select>
                                        <button onclick="createCrystalGrid()" style="background: #9b59b6; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Criar Grid</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>⚖️ Compatibilidade</h3>
                                        <p>Teste a harmonia entre cristais</p>
                                        <select id="crystal1" style="width: 100%; padding: 8px; margin: 4px 0; border: 1px solid #d4af37; border-radius: 4px; background: rgba(0,0,0,0.3); color: #fff;">
                                            <option value="amethyst">Ametista</option>
                                            <option value="rose_quartz">Quartzo Rosa</option>
                                            <option value="clear_quartz">Quartzo Transparente</option>
                                            <option value="black_tourmaline">Turmalina Negra</option>
                                            <option value="citrine">Citrino</option>
                                        </select>
                                        <select id="crystal2" style="width: 100%; padding: 8px; margin: 4px 0; border: 1px solid #d4af37; border-radius: 4px; background: rgba(0,0,0,0.3); color: #fff;">
                                            <option value="rose_quartz">Quartzo Rosa</option>
                                            <option value="amethyst">Ametista</option>
                                            <option value="clear_quartz">Quartzo Transparente</option>
                                            <option value="black_tourmaline">Turmalina Negra</option>
                                            <option value="citrine">Citrino</option>
                                        </select>
                                        <button onclick="testCompatibility()" style="background: #4ecdc4; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Testar</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37;">
                                        <h3>🌙 Cristal do Dia</h3>
                                        <div style="text-align: center;">
                                            <div style="font-size: 32px; margin: 10px 0;">💜</div>
                                            <h4>Ametista</h4>
                                            <p>Proteção espiritual e clareza mental</p>
                                            <p><small>Perfeita para a energia de hoje</small></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    // Aplicações originais mantidas
                    'aurora-player': {
                        title: 'Aurora Player - Música Mística',
                        content: `
                            <div style="padding: 20px;">
                                <h2 style="color: #d4af37; text-align: center;">🎵 Aurora Player 🎵</h2>
                                <div style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 8px; border: 1px solid #d4af37; margin: 20px 0;">
                                    <h3>🎼 Tocando Agora</h3>
                                    <p><strong>Música:</strong> Moonlight Sonata - Beethoven (Versão Mística)</p>
                                    <p><strong>Álbum:</strong> Classical Mysticism</p>
                                    <div style="background: #333; height: 4px; border-radius: 2px; margin: 10px 0;">
                                        <div style="background: #d4af37; height: 100%; width: 45%; border-radius: 2px;"></div>
                                    </div>
                                    <p>2:15 / 5:03</p>
                                    <div style="text-align: center; margin: 20px 0;">
                                        <button style="background: none; border: none; color: #d4af37; font-size: 24px; margin: 0 10px; cursor: pointer;">⏮️</button>
                                        <button style="background: none; border: none; color: #d4af37; font-size: 32px; margin: 0 10px; cursor: pointer;">⏸️</button>
                                        <button style="background: none; border: none; color: #d4af37; font-size: 24px; margin: 0 10px; cursor: pointer;">⏭️</button>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    'witch-tv': {
                        title: 'Witch.TV - Canal Místico',
                        content: `
                            <div style="padding: 20px;">
                                <h2 style="color: #d4af37; text-align: center;">📺 Witch.TV 📺</h2>
                                <div style="background: #000; height: 300px; border: 2px solid #d4af37; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 20px 0;">
                                    <div style="text-align: center; color: #d4af37;">
                                        <div style="font-size: 48px;">🔮</div>
                                        <p>Ao Vivo: Astrologia para Iniciantes</p>
                                        <p>com Madame Luna</p>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button style="background: #d4af37; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">🌙 Astrologia</button>
                                    <button style="background: #9b59b6; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">🃏 Tarô</button>
                                    <button style="background: #4ecdc4; color: #000; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">🔮 Cristais</button>
                                    <button style="background: #ff6b6b; color: #fff; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">🕯️ Rituais</button>
                                </div>
                            </div>
                        `
                    },
                    'afast': {
                        title: 'AFÁST! - Sistema de Proteção',
                        content: `
                            <div style="padding: 20px;">
                                <h2 style="color: #d4af37; text-align: center;">🛡️ AFÁST! Sistema 🛡️</h2>
                                <div style="background: rgba(212, 175, 55, 0.1); padding: 20px; border-radius: 8px; border: 1px solid #d4af37; margin: 20px 0;">
                                    <h3>🔊 Status do Sistema</h3>
                                    <p><strong>Status:</strong> <span style="color: #4ecdc4;">Ativo</span></p>
                                    <p><strong>Última Verificação:</strong> Agora</p>
                                    <p><strong>Alertas Hoje:</strong> 3</p>
                                    <p><strong>Voz:</strong> Feminina (Português)</p>
                                    <div style="margin: 20px 0;">
                                        <button onclick="testAFAST()" style="background: #4ecdc4; color: #000; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px;">🎤 Testar Voz</button>
                                        <button style="background: #ff6b6b; color: #fff; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px;">⏸️ Pausar</button>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    'tarot': {
                        title: 'Tarô Interativo',
                        content: `
                            <div style="padding: 20px;">
                                <h2 style="color: #d4af37; text-align: center;">🃏 Tarô Sagrado 🃏</h2>
                                <div style="text-align: center; margin: 20px 0;">
                                    <p>Faça sua pergunta e escolha uma carta...</p>
                                    <div style="display: flex; justify-content: center; gap: 10px; margin: 20px 0;">
                                        <div onclick="drawCard()" style="width: 80px; height: 120px; background: linear-gradient(45deg, #4a0e4e, #81007f); border: 2px solid #d4af37; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #d4af37; font-size: 24px;">🌟</div>
                                        <div onclick="drawCard()" style="width: 80px; height: 120px; background: linear-gradient(45deg, #4a0e4e, #81007f); border: 2px solid #d4af37; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #d4af37; font-size: 24px;">🌙</div>
                                        <div onclick="drawCard()" style="width: 80px; height: 120px; background: linear-gradient(45deg, #4a0e4e, #81007f); border: 2px solid #d4af37; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #d4af37; font-size: 24px;">⭐</div>
                                    </div>
                                </div>
                            </div>
                        `
                    },
                    'livros': {
                        title: 'Biblioteca Mística',
                        content: `
                            <div style="padding: 20px;">
                                <h2 style="color: #d4af37; text-align: center;">📚 Biblioteca Mística 📚</h2>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37; text-align: center;">
                                        <div style="font-size: 32px; margin-bottom: 10px;">📖</div>
                                        <h4>Astrologia Básica</h4>
                                        <p>Guia completo para iniciantes</p>
                                        <button style="background: #d4af37; color: #000; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Ler</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37; text-align: center;">
                                        <div style="font-size: 32px; margin-bottom: 10px;">🔮</div>
                                        <h4>Cristaloterapia</h4>
                                        <p>O poder dos cristais</p>
                                        <button style="background: #9b59b6; color: #fff; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Ler</button>
                                    </div>
                                    <div style="background: rgba(212, 175, 55, 0.1); padding: 15px; border-radius: 8px; border: 1px solid #d4af37; text-align: center;">
                                        <div style="font-size: 32px; margin-bottom: 10px;">🃏</div>
                                        <h4>Tarô Rider-Waite</h4>
                                        <p>Interpretação das cartas</p>
                                        <button style="background: #4ecdc4; color: #000; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">Ler</button>
                                    </div>
                                </div>
                            </div>
                        `
                    }
                };
                
                const app = apps[appName];
                if (app) {
                    createWindow(app.title, app.content);
                } else {
                    console.log('Aplicação não encontrada:', appName);
                }
            };
        });
    </script>
    <!-- Indicadores de Integração AFÁST! -->
    <div id="duckingIndicator" style="
        position: fixed;
        bottom: 100px;
        right: 20px;
        background: rgba(240,170,83,.9);
        color: #000;
        padding: 8px 12px;
        border-radius: 15px;
        font-size: 12px;
        z-index: 10003;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s ease;
    "></div>

    <!-- Controles de Comandos de Voz -->
    <div id="voiceControlPanel" style="
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(0,0,0,.8);
        border: 1px solid #444;
        border-radius: 10px;
        padding: 15px;
        color: #fff;
        font-size: 12px;
        z-index: 10002;
        display: none;
    ">
        <div style="margin-bottom: 10px; font-weight: bold;">🎤 Comandos de Voz AFÁST!</div>
        <div style="margin-bottom: 5px;">• "Quando termina Mercúrio Retrógrado?"</div>
        <div style="margin-bottom: 5px;">• "Criar lembrete Lua Nova"</div>
        <div style="margin-bottom: 5px;">• "Mostrar eventos astrológicos"</div>
        <div style="margin-bottom: 5px;">• "Fechar popover"</div>
        <button onclick="afastVoiceCommands.startListening()" style="
            background: #4CAF50;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 5px;
        ">🎤 Ativar</button>
        <button onclick="afastVoiceCommands.stopListening()" style="
            background: #f44336;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        ">⏹ Parar</button>
    </div>

</body>
</html>

